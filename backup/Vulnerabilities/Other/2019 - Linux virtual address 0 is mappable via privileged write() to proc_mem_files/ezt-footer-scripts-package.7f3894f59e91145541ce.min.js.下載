!function(e){var t={};function s(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,s),n.l=!0,n.exports}s.m=e,s.c=t,s.d=function(e,t,i){s.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},s.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},s.t=function(e,t){if(1&t&&(e=s(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(s.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)s.d(i,n,function(t){return e[t]}.bind(null,n));return i},s.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return s.d(t,"a",t),t},s.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},s.p="/static/dist/",s(s.s=240)}({240:function(e,t,s){"use strict";s.r(t);s(52),s(241);var i=s(51);window.AutoRefreshPrpcClient=i.a},241:function(e,t){function s(e){let t=e.localName;return e.id&&(t=t+"#"+e.id),t}window.addEventListener("copy",(function(e){const t=s(e.srcElement),i=window.getSelection().toString().length;ga("send","event",window.location.pathname,"copy",t,i)})),window.addEventListener("paste",(function(e){const t=s(e.srcElement),i=e.clipboardData.getData("text/plain"),n=i?i.length:0;ga("send","event",window.location.pathname,"paste",t,n)}))},51:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));s(93);class i{constructor(e,t){this.token=e,this.tokenExpiresSec=t,this.prpcClient=new window.chops.rpc.PrpcClient({insecure:Boolean("localhost"===location.hostname),fetchImpl:(e,t)=>(t.credentials="same-origin",fetch(e,t))})}async ensureTokenIsValid(){if(i.isTokenExpired(this.tokenExpiresSec)){const e={"X-Xsrf-Token":this.token},t={token:this.token,tokenPath:"xhr"},s=await this.prpcClient.call("monorail.Sitewide","RefreshToken",t,e);this.token=s.token,this.tokenExpiresSec=s.tokenExpiresSec}}call(e,t,s){return this.ensureTokenIsValid().then(()=>{const i={"X-Xsrf-Token":this.token};return this.prpcClient.call(e,t,s,i)})}static isTokenExpired(e){return new Date(1e3*e)<new Date}}},52:function(e,t,s){"use strict";s.d(t,"a",(function(){return g})),s.d(t,"b",(function(){return f}));const i=Object.freeze({NON_CUMULATIVE_INT:0,CUMULATIVE_INT:1,NON_CUMULATIVE_FLOAT:2,CUMULATIVE_FLOAT:3,STRING:4,BOOL:5,NON_CUMULATIVE_DISTRIBUTION:6,CUMULATIVE_DISTRIBUTION:7}),n=Object.freeze({STRING:1,INT:2,BOOL:3});class r{constructor(e="/_/jstsmon",t=null){this._reportPath=e,this._xsrfToken=t,this._metrics=new Map,this._metricValues=new Map,this._flushIntervalMs=6e4,this._flushTimer=setTimeout(()=>{this._onFlush()},this._flushIntervalMs),this._initTimeSeconds=Math.floor((new Date).getTime()/1e3),this._continueSendingMetrics=!0}_onFlush(){this.flush(),this._continueSendingMetrics?this._flushTimer=setTimeout(()=>{this._onFlush()},this._flushIntervalMs):this._flushTimer=null}disableAfterNextFlush(){this._continueSendingMetrics=!1}now(){return(new Date).getTime()}flush(){const e=this._metricValues;this._metricValues=new Map;const t=new Map;for(const[s,i]of e){let e=JSON.parse(s);if(e.fields){const t={};e.fields.forEach(e=>{t[e[0]]=e[1]}),e.fields=t}e=Object.assign(e,i),t.has(e.name)||t.set(e.name,[]),t.get(e.name).push(e)}const s=[];for(const[e,i]of t){const t=this._metrics.get(e),n=i.map(e=>{let t=e.value;return t instanceof d&&(t={sum:t.sum,count:t.count,buckets:[...t.buckets.entries()]}),{value:t,fields:e.fields,start_time:this._initTimeSeconds}}),r={};for(let[e,s]of t.info.Fields)r[e]=s;let o={MetricInfo:{Name:t.info.Name,Desription:t.info.Description,Fields:r,ValueType:t.info.ValueType},MetricMetadata:t.metadata,Cells:n};s.push(o)}0!==s.length&&this.fetchImpl(s).then(e=>e.text()).then(e=>{"Ok."!==e&&window.console.error("Non-ok response body:",e)}).catch(e=>{window.console.error("Failed to report ts_mon metrics.",e)})}fetchImpl(e){return fetch(this._reportPath,{method:"POST",credentials:"same-origin",body:JSON.stringify({metrics:e,token:this._xsrfToken})})}_metricKey(e,t){const s=[];if(t){for(const[e,i]of t)s.push([e,i]);s.sort((e,t)=>e[0]<t[0]?-1:1)}return JSON.stringify({name:e,fields:s})}_measure(e,t,s,i){const n=e.info.Fields?e.info.Fields.size:0,r=s?s.size:0;if(n!=r)throw`field count ${e.name}: ${n} != ${r}`;let o=this._metricKey(e.name,s);this._metricValues.has(o)||this._metricValues.set(o,{value:e.defaultValue()});let a=this._metricValues.get(o);i?a.value instanceof d?a.value.add(t):a.value+=t:a.value instanceof d?a.value.set(t):a.value=t,this._metricValues.set(o,a)}add(e,t,s){this._measure(e,t,s,!0)}set(e,t,s){this._measure(e,t,s,!1)}_register(e,t){if(this._metrics.has(e))throw e+" is already registered as a metric";this._metrics.set(e,t)}bool(e,t,s,n){const r=new l(this,i.BOOL,e,t,s,n);return this._register(e,r),r}counter(e,t,s,n){const r=new a(this,i.CUMULATIVE_INT,e,t,s,n);return this._register(e,r),r}cumulativeDistribution(e,t,s,n,r){const o=new c(this,i.CUMULATIVE_DISTRIBUTION,e,t,s,n,r);return this._register(e,o),o}nonCumulativeDistribution(e,t,s,n,r){const o=new u(this,i.NON_CUMULATIVE_DISTRIBUTION,e,t,s,n,r);return this._register(e,o),o}float(e,t,s,n){const r=new l(this,i.NON_CUMULATIVE_FLOAT,e,t,s,n);return this._register(e,r),r}int(e,t,s,n){const r=new l(this,i.NON_CUMULATIVE_INT,e,t,s,n);return this._register(e,r),r}string(e,t,s,n){const r=new l(this,i.STRING,e,t,s,n);return this._register(e,r),r}static stringField(e){return{Name:e,Type:n.STRING}}static intField(e){return{Name:e,Type:n.INT}}static boolField(e){return{Name:e,Type:n.BOOL}}static unitMetadata(e){return{Units:e}}static fixedWidthBucketer(e,t){return new h(e,0,null==t?100:t)}static geometricBucketer(e,t,s){return new h(0,null==e?Math.pow(10,.2):e,null==t?100:t,null==s?1:s)}}class o{constructor(e,t,s,i,n,r){this.tsMon=e,this.name=s,this.info={Name:s,Description:i,Fields:r,ValueType:t},this.metadata=n}defaultValue(){return 0}}class a extends o{add(e,t){this.tsMon.add(this,e,t)}}class l extends o{set(e,t){this.tsMon.set(this,e,t)}}class c extends a{constructor(e,t,s,i,n,o,a){super(e,t,s,i,n,o),this.bucketer=a||r.geometricBucketer()}defaultValue(){return new d(this.bucketer)}}class u extends l{constructor(e,t,s,i,n,o,a){super(e,t,s,i,n,o),this.bucketer=a||r.geometricBucketer()}defaultValue(){return new d(this.bucketer)}}class d{constructor(e){this.bucketer=e,this.sum=0,this.count=0,this.buckets=new Map}add(e){const t=this.bucketer.bucketForValue(e),s=this.buckets.get(t)||0;this.buckets.set(t,s+1),this.sum+=e,this.count++}}class h{constructor(e,t,s,i){if(this.width=e,s<0)throw new Error("Invalid numFiniteBuckets: "+s);if(0!=e&&0!=t)throw new Error("Bucketer must be created with either a width or a growth factor, not both.");if(e<0)throw new Error("Bucketer width must be > 0: "+e);if(this.width=e,this.growthFactor=t,this.numFiniteBuckets=s,this.totalBuckets=s+2,this.underflowBucket=0,this.overflowBucket=this.totalBuckets-1,this.scale=i||1,0!=this.width?this._lowerBounds=[-1/0,...this._linearBounds()]:this._lowerBounds=[-1/0,...this._exponentialBounds()],this._lowerBounds.length!=this.totalBuckets)throw new Error("lowerBounds.length != totalBuckets");this._lowerBounds.forEach((e,t)=>{if(t==this._lowerBounds.length-2)return;const s=this._lowerBounds[t+1];if(s<=e)throw new Error(`bucket boundaries must be monotonically increasing: ${e}, ${s}`)})}_linearBounds(){let e=[];for(let t=0;t<this.numFiniteBuckets+1;t++)e[t]=this.width*t;return e}_exponentialBounds(){let e=[];for(let t=0;t<this.numFiniteBuckets+1;t++)e[t]=this.scale*Math.pow(this.growthFactor,t);return e}_bisect(e,t){for(var s=0;s<e.length;s++)if(e[s]>t)return s;return e.length}bucketForValue(e){return this._bisect(this._lowerBounds,e)-1}bucketBoundaries(e){if(e<0||e>=this.totalBuckets)throw new Error(`bucket ${e} out of range`);return e==this.totalBuckets-1?[this._lowerBounds[e],1/0]:[this._lowerBounds[e],this._lowerBounds[e+1]]}}var m=s(51);new r;const _=Object.freeze({ISSUE_DETAIL_SPA:"issue_detail_spa",ISSUE_ENTRY:"issue_entry",ISSUE_LIST_SPA:"issue_list_spa"});class p extends r{constructor(){super("/_/jstsmon.do"),this.clientId=p.generateClientId(),this.disableAfterNextFlush(),this.prpcClient=new m.a(window.CS_env.token,window.CS_env.tokenExpiresSec);const e=new Map([["client_id",r.stringField("client_id")],["host_name",r.stringField("host_name")],["document_visible",r.boolField("document_visible")]]);this._userTimingMetrics=[{category:"issues",eventName:"new-issue",eventLabel:"server-time",metric:this.cumulativeDistribution("monorail/frontend/issue_create_latency","Latency between issue entry form submit and issue detail page load.",null,e)},{category:"issues",eventName:"issue-update",eventLabel:"computer-time",metric:this.cumulativeDistribution("monorail/frontend/issue_update_latency","Latency between issue update form submit and issue detail page load.",null,e)},{category:"autocomplete",eventName:"populate-options",eventLabel:"user-time",metric:this.cumulativeDistribution("monorail/frontend/autocomplete_populate_latency","Latency between page load and autocomplete options loading.",null,e)}],this.dateRangeMetric=this.counter("monorail/frontend/charts/switch_date_range","Number of times user changes date range.",null,new Map([["client_id",r.stringField("client_id")],["host_name",r.stringField("host_name")],["document_visible",r.boolField("document_visible")],["date_range",r.intField("date_range")]])),this.issueCommentsLoadMetric=this.cumulativeDistribution("monorail/frontend/issue_comments_load_latency","Time from navigation or click to issue comments loaded.",null,new Map([["client_id",r.stringField("client_id")],["host_name",r.stringField("host_name")],["template_name",r.stringField("template_name")],["document_visible",r.boolField("document_visible")],["full_app_load",r.boolField("full_app_load")]])),this.issueListLoadMetric=this.cumulativeDistribution("monorail/frontend/issue_list_load_latency","Time from navigation or click to search issues list loaded.",null,new Map([["client_id",r.stringField("client_id")],["host_name",r.stringField("host_name")],["template_name",r.stringField("template_name")],["document_visible",r.boolField("document_visible")],["full_app_load",r.boolField("full_app_load")]])),this.pageLoadMetric=this.cumulativeDistribution("frontend/dom_content_loaded","domContentLoaded performance timing.",null,new Map([["client_id",r.stringField("client_id")],["host_name",r.stringField("host_name")],["template_name",r.stringField("template_name")],["document_visible",r.boolField("document_visible")]]))}fetchImpl(e){return this.prpcClient.ensureTokenIsValid().then(()=>fetch(this._reportPath,{method:"POST",credentials:"same-origin",body:JSON.stringify({metrics:e,token:this.prpcClient.token})}))}recordUserTiming(e,t,s,i){const n=new Map([["client_id",this.clientId],["host_name",window.CS_env.app_version],["document_visible",p.isPageVisible()]]);for(const r of this._userTimingMetrics)e===r.category&&t===r.eventName&&s===r.eventLabel&&r.metric.add(i,n)}recordDateRangeChange(e){const t=new Map([["client_id",this.clientId],["host_name",window.CS_env.app_version],["document_visible",p.isPageVisible()],["date_range",e]]);this.dateRangeMetric.add(1,t)}recordPageLoadTiming(e,t=null){if(!e)return;const s=window.performance.timing,i=s.domContentLoadedEventEnd-s.navigationStart;if(new Set([_.ISSUE_DETAIL_SPA,_.ISSUE_ENTRY]).has(e)){if(null!==t&&i>t)return;const s=new Map([["client_id",this.clientId],["host_name",window.CS_env.app_version],["template_name",e],["document_visible",p.isPageVisible()]]);this.pageLoadMetric.add(i,s)}}recordIssueCommentsLoadTiming(e,t){const s=new Map([["client_id",this.clientId],["host_name",window.CS_env.app_version],["template_name",_.ISSUE_DETAIL_SPA],["document_visible",p.isPageVisible()],["full_app_load",t]]);this.issueCommentsLoadMetric.add(e,s)}recordIssueEntryTiming(e=6e4){this.recordPageLoadTiming(_.ISSUE_ENTRY,e)}recordIssueDetailSpaTiming(e=6e4){this.recordPageLoadTiming(_.ISSUE_DETAIL_SPA,e)}recordIssueListLoadTiming(e,t){const s=new Map([["client_id",this.clientId],["host_name",window.CS_env.app_version],["template_name",_.ISSUE_LIST_SPA],["document_visible",p.isPageVisible()],["full_app_load",t]]);this.issueListLoadMetric.add(e,s)}static getGlobalClient(){const e="__tsMonClient";return window.hasOwnProperty(e)||(window[e]=new p),window[e]}static generateClientId(){const e=new Uint32Array(1);return window.crypto.getRandomValues(e),e[0].toString(32)}static isPageVisible(e){return"visible"===document.visibilityState}}window.getTSMonClient=p.getGlobalClient;class g{constructor(e){this.category=e,this.tsMon=p.getGlobalClient();const t=sessionStorage[`ClientLogger.${e}.started`];this.startedEvents=t?JSON.parse(t):{}}started(e){return this.startedEvents[e]}logStart(e,t){const s=this.startedEvents[e]||{time:(new Date).getTime()};t&&(s.labels||(s.labels={}),s.labels[t]=(new Date).getTime()),this.startedEvents[e]=s,sessionStorage[`ClientLogger.${this.category}.started`]=JSON.stringify(this.startedEvents),f(this.category,e+"-start",t)}logPause(e,t){if(!t)throw"logPause called for event with no label: "+e;const s=this.startedEvents[e];if(!s)return void console.warn("logPause called for event with no logStart: "+e);if(!s.labels[t])return void console.warn(`logPause called for event label with no logStart: ${e}.${t}`);const i=(new Date).getTime()-s.labels[t];s.elapsed||(s.elapsed={},s.elapsed[t]=0),s.elapsed[t]+=i,sessionStorage[`ClientLogger.${this.category}.started`]=JSON.stringify(this.startedEvents)}logResume(e,t){if(!t)throw"logResume called for event with no label: "+e;const s=this.startedEvents[e];s?s.hasOwnProperty("elapsed")&&s.elapsed.hasOwnProperty(t)?(s.labels[t]=(new Date).getTime(),sessionStorage[`ClientLogger.${this.category}.started`]=JSON.stringify(this.startedEvents)):console.warn(`logResume called for event that was never paused:${e}.${t}`):console.warn("logResume called for event with no logStart: "+e)}logEnd(e,t,s=null){const i=this.startedEvents[e];if(i){if(t){if(!i.labels.hasOwnProperty(t))return void console.warn(`logEnd called for event + label with no logStart: ${e}/${t}`);this._sendTiming(i,e,t,s),delete i.labels[t],i.hasOwnProperty("elapsed")&&delete i.elapsed[t]}else{this._sendTiming(i,e,null,s);for(const t in i.labels)this._sendTiming(i,e,t,s);delete this.startedEvents[e]}sessionStorage[`ClientLogger.${this.category}.started`]=JSON.stringify(this.startedEvents),f(this.category,e+"-end",t)}else console.warn("logEnd called for event with no logStart: "+e)}_sendTiming(e,t,s,i=null){let n;if(s?(n=(new Date).getTime()-e.labels[s],e.elapsed&&e.elapsed[s]&&(n+=e.elapsed[s])):n=(new Date).getTime()-e.time,null!==i&&n>i)return;const r={timingCategory:this.category,timingVar:t,timingValue:n};s&&(r.timingLabel=s),ga("send","timing",r),this.tsMon.recordUserTiming(this.category,t,s,n)}}function f(e,t,s,i){ga("send","event",e,t,s,i)}window.ClientLogger=g},93:function(e,t){!function(e){const t=Object.freeze({OK:0,CANCELED:1,UNKNOWN:2,INVALID_ARGUMENT:3,DEADLINE_EXCEEDED:4,NOT_FOUND:5,ALREADY_EXISTS:6,PERMISSION_DENIED:7,RESOURCE_EXHAUSTED:8,FAILED_PRECONDITION:9,ABORTED:10,OUT_OF_RANGE:11,UNIMPLEMENTED:12,INTERNAL:13,UNAVAILABLE:14,DATA_LOSS:15,UNAUTHENTICATED:16}),s={};for(const e in t)s[t[e]]=e;function i(e){return s[e]}class n extends Error{constructor(e,t){if(super(),null===e)throw new Error("missing required argument: code");this.code=e,this.codeName=i(e),this.description=t}get message(){return`code: ${this.code} (${this.codeName}) desc: ${this.description}`}}class r extends Error{constructor(e,t){if(super(),null===e)throw new Error("missing required argument: httpStatus");this.httpStatus=e,this.description=t}get message(){return`status: ${this.httpStatus} desc: ${this.description}`}}e.chops=e.chops||{},e.chops.rpc=e.chops.rpc||{},Object.assign(e.chops.rpc,{RpcCode:t,rpcCodeToCodeName:i,PrpcClient:class{constructor(t=null){t=t||{},this.host=t.host||document.location.host,this.accessToken=t.accessToken||null,this.insecure=t.hasOwnProperty("insecure")&&Boolean(t.insecure),this.fetchImpl=t.fetchImpl||e.fetch.bind(e)}async call(e,s,i,o){if(!e)throw new TypeError("missing required argument: service");if(!s)throw new TypeError("missing required argument: method");if(!i)throw new TypeError("missing required argument: message");if(!(i instanceof Object))throw new TypeError("argument `message` must be a protobuf object");const a=`${!0===this.insecure?"http:":"https:"}//${this.host}/prpc/${e}/${s}`,l=this._requestOptions(i,o),c=await this.fetchImpl(a,l);if(!c.headers.has("X-Prpc-Grpc-Code"))throw new r(c.status,"Invalid response: no X-Prpc-Grpc-Code response header");const u=Number.parseInt(c.headers.get("X-Prpc-Grpc-Code"),10);if(Number.isNaN(u))throw new r(c.status,"Invalid X-Prpc-Grpc-Code response header");const d=await c.text();if(u!==t.OK)throw new n(u,d);if(!d.startsWith(")]}'"))throw new r(c.status,"Response body does not start with XSSI prefix: )]}'");return JSON.parse(d.substr(")]}'".length))}_requestOptions(e,t){const s={accept:"application/json","content-type":"application/json"};return t&&Object.assign(s,t),this.accessToken&&(s.authorization="Bearer "+this.accessToken),{credentials:"omit",method:"POST",headers:s,body:JSON.stringify(e)}}},ProtocolError:r,GrpcError:n})}(window)}});
//# sourceMappingURL=ezt-footer-scripts-package.7f3894f59e91145541ce.min.js.map