<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0029)http://blog.pi3.com.pl/?p=720 -->
<html xmlns="http://www.w3.org/1999/xhtml"><head profile="http://gmpg.org/xfn/11"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">





<meta name="distribution" content="global">


<meta name="robots" content="follow, all">


<meta name="language" content="en, sv">





<title>  CVE: 2020-14356 &amp; 2020-25220 : pi3 blog</title>


<meta name="generator" content="WordPress 5.8.2">


<!-- leave this for stats please -->





<link rel="Shortcut Icon" href="http://blog.pi3.com.pl/wp-content/themes/gods-and-monsters/images/favicon.ico" type="image/x-icon">


<link rel="alternate" type="application/rss+xml" title="RSS 2.0" href="http://blog.pi3.com.pl/?feed=rss2">


<link rel="alternate" type="text/xml" title="RSS .92" href="http://blog.pi3.com.pl/?feed=rss">


<link rel="alternate" type="application/atom+xml" title="Atom 0.3" href="http://blog.pi3.com.pl/?feed=atom">


<link rel="pingback" href="http://blog.pi3.com.pl/xmlrpc.php">


	<link rel="archives" title="July 2021" href="http://blog.pi3.com.pl/?m=202107">
	<link rel="archives" title="April 2021" href="http://blog.pi3.com.pl/?m=202104">
	<link rel="archives" title="January 2021" href="http://blog.pi3.com.pl/?m=202101">
	<link rel="archives" title="December 2020" href="http://blog.pi3.com.pl/?m=202012">
	<link rel="archives" title="October 2020" href="http://blog.pi3.com.pl/?m=202010">
	<link rel="archives" title="September 2020" href="http://blog.pi3.com.pl/?m=202009">
	<link rel="archives" title="June 2020" href="http://blog.pi3.com.pl/?m=202006">
	<link rel="archives" title="May 2020" href="http://blog.pi3.com.pl/?m=202005">
	<link rel="archives" title="March 2020" href="http://blog.pi3.com.pl/?m=202003">
	<link rel="archives" title="October 2019" href="http://blog.pi3.com.pl/?m=201910">
	<link rel="archives" title="July 2019" href="http://blog.pi3.com.pl/?m=201907">
	<link rel="archives" title="May 2019" href="http://blog.pi3.com.pl/?m=201905">
	<link rel="archives" title="April 2019" href="http://blog.pi3.com.pl/?m=201904">
	<link rel="archives" title="February 2019" href="http://blog.pi3.com.pl/?m=201902">
	<link rel="archives" title="August 2018" href="http://blog.pi3.com.pl/?m=201808">
	<link rel="archives" title="July 2018" href="http://blog.pi3.com.pl/?m=201807">
	<link rel="archives" title="March 2018" href="http://blog.pi3.com.pl/?m=201803">
	<link rel="archives" title="February 2018" href="http://blog.pi3.com.pl/?m=201802">
	<link rel="archives" title="January 2018" href="http://blog.pi3.com.pl/?m=201801">
	<link rel="archives" title="April 2017" href="http://blog.pi3.com.pl/?m=201704">
	<link rel="archives" title="September 2016" href="http://blog.pi3.com.pl/?m=201609">
	<link rel="archives" title="July 2015" href="http://blog.pi3.com.pl/?m=201507">
	<link rel="archives" title="February 2015" href="http://blog.pi3.com.pl/?m=201502">
	<link rel="archives" title="March 2014" href="http://blog.pi3.com.pl/?m=201403">
	<link rel="archives" title="August 2013" href="http://blog.pi3.com.pl/?m=201308">
	<link rel="archives" title="July 2013" href="http://blog.pi3.com.pl/?m=201307">
	<link rel="archives" title="May 2013" href="http://blog.pi3.com.pl/?m=201305">
	<link rel="archives" title="April 2013" href="http://blog.pi3.com.pl/?m=201304">
	<link rel="archives" title="March 2013" href="http://blog.pi3.com.pl/?m=201303">
	<link rel="archives" title="February 2013" href="http://blog.pi3.com.pl/?m=201302">
	<link rel="archives" title="October 2012" href="http://blog.pi3.com.pl/?m=201210">
	<link rel="archives" title="May 2012" href="http://blog.pi3.com.pl/?m=201205">
	<link rel="archives" title="April 2012" href="http://blog.pi3.com.pl/?m=201204">
	<link rel="archives" title="December 2011" href="http://blog.pi3.com.pl/?m=201112">
	<link rel="archives" title="September 2011" href="http://blog.pi3.com.pl/?m=201109">
	<link rel="archives" title="August 2011" href="http://blog.pi3.com.pl/?m=201108">
	<link rel="archives" title="July 2011" href="http://blog.pi3.com.pl/?m=201107">
	<link rel="archives" title="March 2011" href="http://blog.pi3.com.pl/?m=201103">
	<link rel="archives" title="November 2010" href="http://blog.pi3.com.pl/?m=201011">
	<link rel="archives" title="October 2010" href="http://blog.pi3.com.pl/?m=201010">
	<link rel="archives" title="July 2010" href="http://blog.pi3.com.pl/?m=201007">
	<link rel="archives" title="May 2010" href="http://blog.pi3.com.pl/?m=201005">
	<link rel="archives" title="March 2010" href="http://blog.pi3.com.pl/?m=201003">
	<link rel="archives" title="February 2010" href="http://blog.pi3.com.pl/?m=201002">
	<link rel="archives" title="January 2010" href="http://blog.pi3.com.pl/?m=201001">
	<link rel="archives" title="December 2009" href="http://blog.pi3.com.pl/?m=200912">
	<link rel="archives" title="November 2009" href="http://blog.pi3.com.pl/?m=200911">
	<link rel="archives" title="October 2009" href="http://blog.pi3.com.pl/?m=200910">
	<link rel="archives" title="September 2009" href="http://blog.pi3.com.pl/?m=200909">


<meta name="robots" content="max-image-preview:large">
<link rel="dns-prefetch" href="http://s.w.org/">
<link rel="alternate" type="application/rss+xml" title="pi3 blog » CVE: 2020-14356 &amp; 2020-25220 Comments Feed" href="http://blog.pi3.com.pl/?feed=rss2&amp;p=720">
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.1.0\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.1.0\/svg\/","svgExt":".svg","source":{"concatemoji":"http:\/\/blog.pi3.com.pl\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.8.2"}};
			!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode;p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(!p||!p.fillText)return!1;switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])?!1:!s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([10084,65039,8205,55357,56613],[10084,65039,8203,55357,56613])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(n=t.source||{}).concatemoji?c(n.concatemoji):n.wpemoji&&n.twemoji&&(c(n.twemoji),c(n.wpemoji)))}(window,document,window._wpemojiSettings);
		</script><script src="./2020 - The short story of 1 Linux Kernel Use-After-Free bug and 2 CVEs (CVE-2020-14356 and CVE-2020-25220)_files/wp-emoji-release.min.js.下載" type="text/javascript" defer=""></script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel="stylesheet" id="wp-block-library-css" href="./2020 - The short story of 1 Linux Kernel Use-After-Free bug and 2 CVEs (CVE-2020-14356 and CVE-2020-25220)_files/style.min.css" type="text/css" media="all">
<style id="wp-block-library-inline-css" type="text/css">
.has-text-align-justify{text-align:justify;}
</style>
<link rel="stylesheet" id="mediaelement-css" href="./2020 - The short story of 1 Linux Kernel Use-After-Free bug and 2 CVEs (CVE-2020-14356 and CVE-2020-25220)_files/mediaelementplayer-legacy.min.css" type="text/css" media="all">
<link rel="stylesheet" id="wp-mediaelement-css" href="./2020 - The short story of 1 Linux Kernel Use-After-Free bug and 2 CVEs (CVE-2020-14356 and CVE-2020-25220)_files/wp-mediaelement.min.css" type="text/css" media="all">
<link rel="stylesheet" id="cptch_stylesheet-css" href="./2020 - The short story of 1 Linux Kernel Use-After-Free bug and 2 CVEs (CVE-2020-14356 and CVE-2020-25220)_files/front_end_style.css" type="text/css" media="all">
<link rel="stylesheet" id="dashicons-css" href="./2020 - The short story of 1 Linux Kernel Use-After-Free bug and 2 CVEs (CVE-2020-14356 and CVE-2020-25220)_files/dashicons.min.css" type="text/css" media="all">
<link rel="stylesheet" id="cptch_desktop_style-css" href="./2020 - The short story of 1 Linux Kernel Use-After-Free bug and 2 CVEs (CVE-2020-14356 and CVE-2020-25220)_files/desktop_style.css" type="text/css" media="all">
<link rel="stylesheet" id="jetpack_css-css" href="./2020 - The short story of 1 Linux Kernel Use-After-Free bug and 2 CVEs (CVE-2020-14356 and CVE-2020-25220)_files/jetpack.css" type="text/css" media="all">
<link rel="https://api.w.org/" href="http://blog.pi3.com.pl/index.php?rest_route=/"><link rel="alternate" type="application/json" href="http://blog.pi3.com.pl/index.php?rest_route=/wp/v2/posts/720"><link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://blog.pi3.com.pl/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://blog.pi3.com.pl/wp-includes/wlwmanifest.xml"> 
<meta name="generator" content="WordPress 5.8.2">
<link rel="canonical" href="http://blog.pi3.com.pl/?p=720">
<link rel="shortlink" href="http://blog.pi3.com.pl/?p=720">
<link rel="alternate" type="application/json+oembed" href="http://blog.pi3.com.pl/index.php?rest_route=%2Foembed%2F1.0%2Fembed&amp;url=http%3A%2F%2Fblog.pi3.com.pl%2F%3Fp%3D720">
<link rel="alternate" type="text/xml+oembed" href="http://blog.pi3.com.pl/index.php?rest_route=%2Foembed%2F1.0%2Fembed&amp;url=http%3A%2F%2Fblog.pi3.com.pl%2F%3Fp%3D720&amp;format=xml">
<style type="text/css">img#wpstats{display:none}</style>
		

<link rel="stylesheet" type="text/css" href="./2020 - The short story of 1 Linux Kernel Use-After-Free bug and 2 CVEs (CVE-2020-14356 and CVE-2020-25220)_files/style.css" media="screen">





<!--[if IE]>


<link rel="stylesheet" type="text/css" href="http://blog.pi3.com.pl/wp-content/themes/gods-and-monsters/ie.css" media="screen" />


<![endif]-->








</head>





<body>





<!--[if lte IE 6]>


<div style="border:4px solid #302831; margin:8px auto; background:#bcab8b; color:#302821; width:700px;">


  <p style="font-size:22px; margin:8px; padding:0;">


    Hello! This page looks wacky because you're using an outdated version of Internet Explorer, one which this site no longer supports. 


  </p>


  <p style="margin:8px; padding:0;">


    Instead of upgrading to the new Internet Explorer, consider trying a free browser like Firefox. It's free, has all the same features as Internet Explorer, and will work much faster. If you would like to try Firefox, it's available as a free download at <a href="http://www.mozilla.com/en-US/firefox/personal.html">Mozilla</a>.</p>  


</div>


<![endif]-->





<div id="headerwrap">


    <div id="header">


        <div id="headertitle">


	    <h1>pi3 blog</h1>


	 </div>


	 <div id="tag">


	     bug bugs bughunt exploit exploiting research vulnerabilities

	 </div>


	 <div id="nav">


	     <ul>


		 <li class=""><a href="http://blog.pi3.com.pl/" title="A link to home page">Home</a></li>						 


		 <li class="page_item page-item-2"><a href="http://blog.pi3.com.pl/?page_id=2">About</a></li>





	     </ul>


	 </div> 


         <div id="quote"><p>“He who fights with monsters should be careful lest he thereby become a   


  monster. And if thou gaze long into an abyss, the abyss will also gaze into thee.”</p>


         <p style="margin:-10px 0 0 0; text-align:right;">~Friedrich Nietzsche</p>


         </div>





     </div>


<div style="clear:both;"></div>	





	





<div id="wrapper">



	<div id="sidebar">


	<ul>





        <li id="rss">


			<p class="rss">Subscribe</p><a href="http://blog.pi3.com.pl/?feed=rss2"><img src="./2020 - The short story of 1 Linux Kernel Use-After-Free bug and 2 CVEs (CVE-2020-14356 and CVE-2020-25220)_files/rss.png" alt="rss"></a>


	</li>


        </ul>


<div id="search">


	     <p class="sidetitle">Search</p>


		<div id="search-box">


		<form id="searchbox" method="get" action="http://blog.pi3.com.pl/index.php">


	   		<input type="text" value="Press enter to search." name="s" id="f" onfocus="if (this.value == &#39;Press enter to search.&#39;) {this.value = &#39;&#39;;}" onblur="if (this.value == &#39;&#39;) {this.value = &#39;Press enter to search.&#39;;}">


			</form>


		</div>


	</div>




        <ul>       


        


<li id="categories-3" class="widget widget_categories"><h2 class="widgettitle">Categories</h2>
			<ul>
					<li class="cat-item cat-item-4"><a href="http://blog.pi3.com.pl/?cat=4">Bughunt</a> (26)
</li>
	<li class="cat-item cat-item-5"><a href="http://blog.pi3.com.pl/?cat=5">Exploiting</a> (33)
</li>
	<li class="cat-item cat-item-6"><a href="http://blog.pi3.com.pl/?cat=6">Ideas</a> (27)
</li>
	<li class="cat-item cat-item-7"><a href="http://blog.pi3.com.pl/?cat=7">LKRG</a> (10)
</li>
	<li class="cat-item cat-item-3"><a href="http://blog.pi3.com.pl/?cat=3">Meeting</a> (6)
</li>
	<li class="cat-item cat-item-1"><a href="http://blog.pi3.com.pl/?cat=1">O wszystkim i o niczym</a> (31)
</li>
			</ul>

			</li>
		<li id="recent-posts-3" class="widget widget_recent_entries">
		<h2 class="widgettitle">Recent Posts</h2>
		<ul>
											<li>
					<a href="http://blog.pi3.com.pl/?p=894">My talks @ BlackHat 2021 and DefCon29</a>
									</li>
											<li>
					<a href="http://blog.pi3.com.pl/?p=890">LKRG 0.9.0 has been released!</a>
									</li>
											<li>
					<a href="http://blog.pi3.com.pl/?p=850">Windows 7 TCP/IP hijacking</a>
									</li>
											<li>
					<a href="http://blog.pi3.com.pl/?p=831">The short story of broken KRETPROBES and OPTIMIZER in Linux Kernel</a>
									</li>
											<li>
					<a href="http://blog.pi3.com.pl/?p=780">CVE-2020-16898 – Exploiting “Bad Neighbor” vulnerability</a>
									</li>
					</ul>

		</li><li id="archives-3" class="widget widget_archive"><h2 class="widgettitle">Archives</h2>
			<ul>
					<li><a href="http://blog.pi3.com.pl/?m=202107">July 2021</a></li>
	<li><a href="http://blog.pi3.com.pl/?m=202104">April 2021</a></li>
	<li><a href="http://blog.pi3.com.pl/?m=202101">January 2021</a></li>
	<li><a href="http://blog.pi3.com.pl/?m=202012">December 2020</a></li>
	<li><a href="http://blog.pi3.com.pl/?m=202010">October 2020</a></li>
	<li><a href="http://blog.pi3.com.pl/?m=202009">September 2020</a></li>
	<li><a href="http://blog.pi3.com.pl/?m=202006">June 2020</a></li>
	<li><a href="http://blog.pi3.com.pl/?m=202005">May 2020</a></li>
	<li><a href="http://blog.pi3.com.pl/?m=202003">March 2020</a></li>
	<li><a href="http://blog.pi3.com.pl/?m=201910">October 2019</a></li>
	<li><a href="http://blog.pi3.com.pl/?m=201907">July 2019</a></li>
	<li><a href="http://blog.pi3.com.pl/?m=201905">May 2019</a></li>
	<li><a href="http://blog.pi3.com.pl/?m=201904">April 2019</a></li>
	<li><a href="http://blog.pi3.com.pl/?m=201902">February 2019</a></li>
	<li><a href="http://blog.pi3.com.pl/?m=201808">August 2018</a></li>
	<li><a href="http://blog.pi3.com.pl/?m=201807">July 2018</a></li>
	<li><a href="http://blog.pi3.com.pl/?m=201803">March 2018</a></li>
	<li><a href="http://blog.pi3.com.pl/?m=201802">February 2018</a></li>
	<li><a href="http://blog.pi3.com.pl/?m=201801">January 2018</a></li>
	<li><a href="http://blog.pi3.com.pl/?m=201704">April 2017</a></li>
	<li><a href="http://blog.pi3.com.pl/?m=201609">September 2016</a></li>
	<li><a href="http://blog.pi3.com.pl/?m=201507">July 2015</a></li>
	<li><a href="http://blog.pi3.com.pl/?m=201502">February 2015</a></li>
	<li><a href="http://blog.pi3.com.pl/?m=201403">March 2014</a></li>
	<li><a href="http://blog.pi3.com.pl/?m=201308">August 2013</a></li>
	<li><a href="http://blog.pi3.com.pl/?m=201307">July 2013</a></li>
	<li><a href="http://blog.pi3.com.pl/?m=201305">May 2013</a></li>
	<li><a href="http://blog.pi3.com.pl/?m=201304">April 2013</a></li>
	<li><a href="http://blog.pi3.com.pl/?m=201303">March 2013</a></li>
	<li><a href="http://blog.pi3.com.pl/?m=201302">February 2013</a></li>
	<li><a href="http://blog.pi3.com.pl/?m=201210">October 2012</a></li>
	<li><a href="http://blog.pi3.com.pl/?m=201205">May 2012</a></li>
	<li><a href="http://blog.pi3.com.pl/?m=201204">April 2012</a></li>
	<li><a href="http://blog.pi3.com.pl/?m=201112">December 2011</a></li>
	<li><a href="http://blog.pi3.com.pl/?m=201109">September 2011</a></li>
	<li><a href="http://blog.pi3.com.pl/?m=201108">August 2011</a></li>
	<li><a href="http://blog.pi3.com.pl/?m=201107">July 2011</a></li>
	<li><a href="http://blog.pi3.com.pl/?m=201103">March 2011</a></li>
	<li><a href="http://blog.pi3.com.pl/?m=201011">November 2010</a></li>
	<li><a href="http://blog.pi3.com.pl/?m=201010">October 2010</a></li>
	<li><a href="http://blog.pi3.com.pl/?m=201007">July 2010</a></li>
	<li><a href="http://blog.pi3.com.pl/?m=201005">May 2010</a></li>
	<li><a href="http://blog.pi3.com.pl/?m=201003">March 2010</a></li>
	<li><a href="http://blog.pi3.com.pl/?m=201002">February 2010</a></li>
	<li><a href="http://blog.pi3.com.pl/?m=201001">January 2010</a></li>
	<li><a href="http://blog.pi3.com.pl/?m=200912">December 2009</a></li>
	<li><a href="http://blog.pi3.com.pl/?m=200911">November 2009</a></li>
	<li><a href="http://blog.pi3.com.pl/?m=200910">October 2009</a></li>
	<li><a href="http://blog.pi3.com.pl/?m=200909">September 2009</a></li>
			</ul>

			</li><li id="linkcat-2" class="widget widget_links"><h2 class="widgettitle">Friends</h2>
	<ul class="xoxo blogroll">
<li><a href="http://bothunters.pl/">Bothunters – Borys Łącki</a></li>
<li><a href="http://gynvael.coldwind.pl/">Gynvael Coldwind</a></li>
<li><a href="http://www.icewall.pl/">Icewall</a></li>
<li><a href="http://j00ru.vexillium.org/">j00ru</a></li>
<li><a href="http://piotrbania.com/">Piotr Bania</a></li>

	</ul>
</li>
<li id="pages-3" class="widget widget_pages"><h2 class="widgettitle">Pages</h2>
			<ul>
				<li class="page_item page-item-2"><a href="http://blog.pi3.com.pl/?page_id=2">About</a></li>
			</ul>

			</li>

	</ul>


			


</div>








	<div id="content">	



                


                <div class="postheader">



                <div id="date"><p class="datea">11</p> <p class="dateb" style=" margin-top:-9px;">Sep</p></div>



		<div id="posttitle"><h1><a href="http://blog.pi3.com.pl/?p=720" rel="bookmark">CVE: 2020-14356 &amp; 2020-25220</a></h1></div>

                <div style="clear:both;"></div>

                        <p class="author">by pi3</p>

                </div>

		

		
<p class="has-medium-font-size"><strong><span style="text-decoration: underline;" class="underline">The short story of 1 Linux Kernel Use-After-Free bug and 2 CVEs (CVE-2020-14356 and CVE-2020-25220)</span></strong></p>



<p>Name:&nbsp;&nbsp;&nbsp;&nbsp; Linux kernel Cgroup BPF Use-After-Free<br>Author:&nbsp;&nbsp; Adam Zabrocki (<a href="mailto:pi3@pi3.com.pl">pi3@pi3.com.pl</a>)<br>Date:&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; May 27, 2020</p>



<span id="more-720"></span>



<p><span style="font-size: 14pt;"><strong><span style="text-decoration: underline;">First things first – short history:</span></strong></span></p>



<p>In 2019 Tejun Heo discovered a racing problem with lifetime of the cgroup_bpf which could result in double-free and other memory corruptions. This bug was fixed in kernel 5.3. More information about the problem and the patch can be found here:</p>



<p><a href="https://lore.kernel.org/patchwork/patch/1094080/" target="_blank" rel="noreferrer noopener">https://lore.kernel.org/patchwork/patch/1094080/</a></p>



<p>Roman Gushchin discovered another problem with the newly fixed code which could lead to use-after-free vulnerability. His report and fix can be found here:</p>



<p><a href="https://lore.kernel.org/bpf/20191227215034.3169624-1-guro@fb.com/" target="_blank" rel="noreferrer noopener">https://lore.kernel.org/bpf/20191227215034.3169624-1-guro@fb.com/</a></p>



<p>During the discussion on the fix, Alexei Starovoitov pointed out that walking through the cgroup hierarchy without holding cgroup_mutex might be dangerous:</p>



<p><a href="https://lore.kernel.org/bpf/20200104003523.rfte5rw6hbnncjes@ast-mbp/" target="_blank" rel="noreferrer noopener">https://lore.kernel.org/bpf/20200104003523.rfte5rw6hbnncjes@ast-mbp/</a></p>



<p>However, Roman and Alexei concluded that it shouldn’t be a problem:</p>



<p><a rel="noreferrer noopener" href="https://lore.kernel.org/bpf/20200106220746.fm3hp3zynaiaqgly@ast-mbp/" target="_blank">https://lore.kernel.org/bpf/20200106220746.fm3hp3zynaiaqgly@ast-mbp/</a></p>



<p>Unfortunately, there is another Use-After-Free bug related to the Cgroup BPF release logic.</p>



<p class="has-medium-font-size"><strong><span style="text-decoration: underline" class="underline">The “new” bug – details (a lot of details ;-)):</span></strong></p>



<p>During LKRG development and tests, one of my VMs was generating a kernel crash during shutdown procedure. This specific machine had the newest kernel at that time (5.7.x) and I compiled it with all debug information as well as SLAB DEBUG feature. When I analyzed the crash, it had nothing to do with LKRG. Later I confirmed that kernels without LKRG are always hitting that issue:</p>



<pre class="wp-block-code"><code>      KERNEL: linux-5.7/vmlinux
    DUMPFILE: /var/crash/202006161848/dump.202006161848  [PARTIAL DUMP]
        CPUS: 1
        DATE: Tue Jun 16 18:47:40 2020
      UPTIME: 14:09:24
LOAD AVERAGE: 0.21, 0.37, 0.50
       TASKS: 234
    NODENAME: oi3
     RELEASE: 5.7.0-g4
     VERSION: #28 SMP PREEMPT Fri Jun 12 18:09:14 UTC 2020
     MACHINE: x86_64  (3694 Mhz)
      MEMORY: 8 GB
       PANIC: "Oops: 0000 [#1] PREEMPT SMP PTI" (check log for details)
         PID: 1060499
     COMMAND: "sshd"
        TASK: ffff9d8c36b33040  [THREAD_INFO: ffff9d8c36b33040]
         CPU: 0
       STATE:  (PANIC)

crash&gt; bt
PID: 1060499  TASK: ffff9d8c36b33040  CPU: 0   COMMAND: "sshd"
 #0 [ffffb0fc41b1f990] machine_kexec at ffffffff9404d22f
 #1 [ffffb0fc41b1f9d8] __crash_kexec at ffffffff941c19b8
 #2 [ffffb0fc41b1faa0] crash_kexec at ffffffff941c2b60
 #3 [ffffb0fc41b1fab0] oops_end at ffffffff94019d3e
 #4 [ffffb0fc41b1fad0] page_fault at ffffffff95c0104f
    [exception RIP: __cgroup_bpf_run_filter_skb+401]
    RIP: ffffffff9423e801  RSP: ffffb0fc41b1fb88  RFLAGS: 00010246
    RAX: 0000000000000000  RBX: ffff9d8d56ae1ee0  RCX: 0000000000000028
    RDX: 0000000000000000  RSI: ffff9d8e25c40b00  RDI: ffffffff9423e7f3
    RBP: 0000000000000000   R8: 0000000000000000   R9: 0000000000000000
    R10: 0000000000000003  R11: 0000000000000000  R12: 0000000000000000
    R13: 0000000000000000  R14: 0000000000000000  R15: 0000000000000001
    ORIG_RAX: ffffffffffffffff  CS: 0010  SS: 0018
 #5 [ffffb0fc41b1fbd0] ip_finish_output at ffffffff957d71b3
 #6 [ffffb0fc41b1fbf8] __ip_queue_xmit at ffffffff957d84e1
 #7 [ffffb0fc41b1fc50] __tcp_transmit_skb at ffffffff957f4b27
 #8 [ffffb0fc41b1fd58] tcp_write_xmit at ffffffff957f6579
 #9 [ffffb0fc41b1fdb8] __tcp_push_pending_frames at ffffffff957f737d
#10 [ffffb0fc41b1fdd0] tcp_close at ffffffff957e6ec1
#11 [ffffb0fc41b1fdf8] inet_release at ffffffff9581809f
#12 [ffffb0fc41b1fe10] __sock_release at ffffffff95616848
#13 [ffffb0fc41b1fe30] sock_close at ffffffff956168bc
#14 [ffffb0fc41b1fe38] __fput at ffffffff942fd3cd
#15 [ffffb0fc41b1fe78] task_work_run at ffffffff94148a4a
#16 [ffffb0fc41b1fe98] do_exit at ffffffff9412b144
#17 [ffffb0fc41b1ff08] do_group_exit at ffffffff9412b8ae
#18 [ffffb0fc41b1ff30] __x64_sys_exit_group at ffffffff9412b92f
#19 [ffffb0fc41b1ff38] do_syscall_64 at ffffffff940028d7
#20 [ffffb0fc41b1ff50] entry_SYSCALL_64_after_hwframe at ffffffff95c0007c
    RIP: 00007fe54ea30136  RSP: 00007fff33413468  RFLAGS: 00000202
    RAX: ffffffffffffffda  RBX: 00007fff334134e0  RCX: 00007fe54ea30136
    RDX: 00000000000000ff  RSI: 000000000000003c  RDI: 00000000000000ff
    RBP: 00000000000000ff   R8: 00000000000000e7   R9: fffffffffffffdf0
    R10: 000055a091a22d09  R11: 0000000000000202  R12: 000055a091d67f20
    R13: 00007fe54ea5afa0  R14: 000055a091d7ef70  R15: 000055a091d70a20
    ORIG_RAX: 00000000000000e7  CS: 0033  SS: 002b</code></pre>



<p><strong>1060499 </strong>is a sshd’s child:</p>



<pre class="wp-block-code"><code><span style="font-size: 8pt;">...
root        5462  0.0  0.0  12168  7276 ?        Ss   04:38   0:00 sshd: /usr/sbin/sshd -D [listener] 0 of 10-100 startups
...
root     1060499  0.0  0.1  13936  9056 ?        Ss   17:51   0:00  \_ sshd: pi3 [priv]
pi3      1062463  0.0  0.0  13936  5852 ?        S    17:51   0:00      \_ sshd: pi3@pts/3
...</span></code></pre>



<p>Crash happens in function “__cgroup_bpf_run_filter_skb”, exactly in this piece of code:</p>



<pre class="wp-block-code"><span style="font-size: 4pt;"><code><span style="font-family: andale mono, monospace;"><span style="font-family: courier new, courier, monospace; font-size: 8pt;">0xffffffff9423e7ee &lt;__cgroup_bpf_run_filter_skb+382&gt;: callq  0xffffffff94153cb0 &lt;preempt_count_add&gt;
0xffffffff9423e7f3 &lt;__cgroup_bpf_run_filter_skb+387&gt;: callq  0xffffffff941925a0 &lt;__rcu_read_lock&gt;
0xffffffff9423e7f8 &lt;__cgroup_bpf_run_filter_skb+392&gt;: mov 0x3e8(%rbp),%rax
0xffffffff9423e7ff &lt;__cgroup_bpf_run_filter_skb+399&gt;: xor %ebp,%ebp
0xffffffff9423e801 &lt;__cgroup_bpf_run_filter_skb+401&gt;: mov 0x10(%rax),%rdi
                                                          ^^^^^^^^^^^^^^^
0xffffffff9423e805 &lt;__cgroup_bpf_run_filter_skb+405&gt;: lea 0x10(%rax),%r14
0xffffffff9423e809 &lt;__cgroup_bpf_run_filter_skb+409&gt;: test %rdi,%rdi</span></span></code></span></pre>



<p>where RAX: 0000000000000000. However, when I was playing with repro under SLAB_DEBUG, I often got RAX: 6b6b6b6b6b6b6b6b:</p>



<pre class="wp-block-code"><code>    [exception RIP: __cgroup_bpf_run_filter_skb+401]
    RIP: ffffffff9123e801  RSP: ffffb136c16ffb88  RFLAGS: 00010246
    RAX: 6b6b6b6b6b6b6b6b  RBX: ffff9ce3e5a0e0e0  RCX: 0000000000000028
    RDX: 0000000000000000  RSI: ffff9ce3de26b280  RDI: ffffffff9123e7f3
    RBP: 0000000000000000   R8: 0000000000000000   R9: 0000000000000000
    R10: 0000000000000003  R11: 0000000000000000  R12: 0000000000000000
    R13: 0000000000000000  R14: 0000000000000000  R15: 0000000000000001</code></pre>



<p>So we have kind of a Use-After-Free bug. This bug is triggerable from user-mode. I’ve looked under IDA for the binary:</p>



<pre class="wp-block-code"><code>.text:FFFFFFFF8123E7EE skb = rbx      ; sk_buff * ; PIC mode
.text:FFFFFFFF8123E7EE type = r15     ; bpf_attach_type
.text:FFFFFFFF8123E7EE save_sk = rsi  ; sock *
.text:FFFFFFFF8123E7EE        call    near ptr preempt_count_add-0EAB43h
.text:FFFFFFFF8123E7F3        call    near ptr __rcu_read_lock-0AC258h ; PIC mode
.text:FFFFFFFF8123E7F8        mov     ret, [rbp+3E8h]
.text:FFFFFFFF8123E7FF        xor     ebp, ebp
.text:FFFFFFFF8123E801 _cn = rbp      ; u32
.text:FFFFFFFF8123E801        mov     rdi, [ret+10h]  ; prog
.text:FFFFFFFF8123E805        lea     r14, [ret+10h]</code></pre>



<p>and this code is referencing cgroups from the socket. Source code:</p>



<pre class="wp-block-code"><code><span style="font-size: 8pt;">int __cgroup_bpf_run_filter_skb(struct sock *sk,
				struct sk_buff *skb,
				enum bpf_attach_type type)
{
    ...
	struct cgroup *cgrp;
    ...<br><span style="font-size: 10pt;"><span style="font-size: 8pt;">
    ...
	cgrp = sock_cgroup_ptr(&amp;sk-&gt;sk_cgrp_data);
    ...
	if (type == BPF_CGROUP_INET_EGRESS) {
		ret = BPF_PROG_CGROUP_INET_EGRESS_RUN_ARRAY(
			cgrp-&gt;bpf.effective[type], skb, __bpf_prog_run_save_cb);
    ...
    ...
}</span></span></span></code></pre>



<p>Debugger:</p>



<pre class="wp-block-code"><code>crash&gt; x/4i 0xffffffff9423e7f8
   0xffffffff9423e7f8:  mov    0x3e8(%rbp),%rax
   0xffffffff9423e7ff:  xor    %ebp,%ebp
   0xffffffff9423e801:  mov    0x10(%rax),%rdi
   0xffffffff9423e805:  lea    0x10(%rax),%r14
crash&gt; p/x (int)&amp;((struct cgroup*)0)-&gt;bpf
$2 = 0x3e0
crash&gt; ptype struct cgroup_bpf
type = struct cgroup_bpf {
    struct bpf_prog_array *effective[28];
    struct list_head progs[28];
    u32 flags[28];
    struct bpf_prog_array *inactive;
    struct percpu_ref refcnt;
    struct work_struct release_work;
}
crash&gt; print/a sizeof(struct bpf_prog_array)
$3 = 0x10
crash&gt; print/a ((struct sk_buff *)0xffff9ce3e5a0e0e0)-&gt;sk
$4 = 0xffff9ce3de26b280
crash&gt; print/a ((struct sock *)0xffff9ce3de26b280)-&gt;sk_cgrp_data
$5 = {
  {
    {
      is_data = 0x0,
      padding = 0x68,
      prioidx = 0xe241,
      classid = 0xffff9ce3
    },
    val = 0xffff9ce3e2416800
  }
}</code></pre>



<p>We also know that R15: 0000000000000001 == type == BPF_CGROUP_INET_EGRESS</p>



<pre class="wp-block-code"><code>crash&gt; p/a ((struct cgroup *)0xffff9ce3e2416800)-&gt;bpf.effective[1]
$6 = 0x6b6b6b6b6b6b6b6b
crash&gt; x/20a 0xffff9ce3e2416800
0xffff9ce3e2416800:     0x6b6b6b6b6b6b016b      0x6b6b6b6b6b6b6b6b
0xffff9ce3e2416810:     0x6b6b6b6b6b6b6b6b      0x6b6b6b6b6b6b6b6b
0xffff9ce3e2416820:     0x6b6b6b6b6b6b6b6b      0x6b6b6b6b6b6b6b6b
0xffff9ce3e2416830:     0x6b6b6b6b6b6b6b6b      0x6b6b6b6b6b6b6b6b
0xffff9ce3e2416840:     0x6b6b6b6b6b6b6b6b      0x6b6b6b6b6b6b6b6b
0xffff9ce3e2416850:     0x6b6b6b6b6b6b6b6b      0x6b6b6b6b6b6b6b6b
0xffff9ce3e2416860:     0x6b6b6b6b6b6b6b6b      0x6b6b6b6b6b6b6b6b
0xffff9ce3e2416870:     0x6b6b6b6b6b6b6b6b      0x6b6b6b6b6b6b6b6b
0xffff9ce3e2416880:     0x6b6b6b6b6b6b6b6b      0x6b6b6b6b6b6b6b6b
0xffff9ce3e2416890:     0x6b6b6b6b6b6b6b6b      0x6b6b6b6b6b6b6b6b
crash&gt;</code></pre>



<p>This pointer (struct cgroup *)</p>



<pre class="wp-block-code"><code>	cgrp = sock_cgroup_ptr(&amp;sk-&gt;sk_cgrp_data);</code></pre>



<p>Points to the freed object. However, kernel still keeps eBPF rules attached to the socket under cgroups. When process (sshd) dies (do_exit() call) and cleanup is executed, all sockets are being closed. If such socket has “pending” packets, the following code path is executed:</p>



<pre class="wp-block-code"><code>do_exit -&gt; ... -&gt; sock_close -&gt; __sock_release -&gt; inet_release -&gt; tcp_close -&gt; __tcp_push_pending_frames -&gt; tcp_write_xmit -&gt; __tcp_transmit_skb -&gt; __ip_queue_xmit -&gt; ip_finish_output -&gt; __cgroup_bpf_run_filter_skb</code></pre>



<p>However, there is nothing wrong with such logic and path. The real problem is that cgroups disappeared while still holding active clients. How is that even possible? Just before the crash I can see the following entry in kernel logs:</p>



<pre class="wp-block-code"><code><span style="font-size: 8pt;">[190820.457422] ------------[ cut here ]------------
[190820.457465] percpu ref (cgroup_bpf_release_fn) &lt;= 0 (-70581) after switching to atomic
                            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[190820.457511] WARNING: CPU: 0 PID: 9 at lib/percpu-refcount.c:161 percpu_ref_switch_to_atomic_rcu+0x112/0x120
[190820.457511] Modules linked in: [last unloaded: p_lkrg]
[190820.457513] CPU: 0 PID: 9 Comm: ksoftirqd/0 Kdump: loaded Tainted: G           OE     5.7.0-g4 #28
[190820.457513] Hardware name: VMware, Inc. VMware Virtual Platform/440BX Desktop Reference Platform, BIOS 6.00 04/13/2018
[190820.457515] RIP: 0010:percpu_ref_switch_to_atomic_rcu+0x112/0x120
[190820.457516] Code: eb b6 80 3d 11 95 5a 02 00 0f 85 65 ff ff ff 48 8b 55 d8 48 8b 75 e8 48 c7 c7 d0 9f 78 93 c6 05 f5 94 5a 02 01 e8 00 57 88 ff &lt;0f&gt; 0b e9 43 ff ff ff 0f 0b eb 9d cc cc cc 8d 8c 16 ef be ad de 89
[190820.457516] RSP: 0018:ffffb136c0087e00 EFLAGS: 00010286
[190820.457517] RAX: 0000000000000000 RBX: 7ffffffffffeec4a RCX: 0000000000000000
[190820.457517] RDX: 0000000000000101 RSI: ffffffff949235c0 RDI: 00000000ffffffff
[190820.457517] RBP: ffff9ce3e204af20 R08: 6d6f7461206f7420 R09: 63696d6f7461206f
[190820.457517] R10: 7320726574666120 R11: 676e696863746977 R12: 00003452c5002ce8
[190820.457518] R13: ffff9ce3f6e2b450 R14: ffff9ce2c7fc3100 R15: 0000000000000000
[190820.457526] FS:  0000000000000000(0000) GS:ffff9ce3f6e00000(0000) knlGS:0000000000000000
[190820.457527] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[190820.457527] CR2: 00007f516c2b9000 CR3: 0000000222c64006 CR4: 00000000003606f0
[190820.457550] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[190820.457551] DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
[190820.457551] Call Trace:
[190820.457577]  rcu_core+0x1df/0x530
[190820.457598]  ? smpboot_register_percpu_thread+0xd0/0xd0
[190820.457609]  __do_softirq+0xfc/0x331
[190820.457629]  ? smpboot_register_percpu_thread+0xd0/0xd0
[190820.457630]  run_ksoftirqd+0x21/0x30
[190820.457649]  smpboot_thread_fn+0x195/0x230
[190820.457660]  kthread+0x139/0x160
[190820.457670]  ? __kthread_bind_mask+0x60/0x60
[190820.457671]  ret_from_fork+0x35/0x40
[190820.457682] ---[ end trace 63d2aef89e998452 ]---</span></code></pre>



<p>I was testing the same scenario a few times and I had the following results:</p>



<pre class="wp-block-code"><code><span style="font-size: 8pt;"> percpu ref (cgroup_bpf_release_fn) &lt;= 0 (-70581) after switching to atomic
 percpu ref (cgroup_bpf_release_fn) &lt;= 0 (-18829) after switching to atomic
 percpu ref (cgroup_bpf_release_fn) &lt;= 0 (-29849) after switching to atomic
</span></code></pre>



<p>Let’s look at this function:</p>



<pre class="wp-block-code"><code><span style="font-size: 8pt;">/**
 * cgroup_bpf_release_fn() - callback used to schedule releasing
 *                           of bpf cgroup data
 * @ref: percpu ref counter structure
 */
static void cgroup_bpf_release_fn(struct percpu_ref *ref)
{
	struct cgroup *cgrp = container_of(ref, struct cgroup, bpf.refcnt);

	INIT_WORK(&amp;cgrp-&gt;bpf.release_work, cgroup_bpf_release);
	queue_work(system_wq, &amp;cgrp-&gt;bpf.release_work);
}</span></code></pre>



<p>So that’s the callback used to release bpf cgroup data. Sounds like it is being called while there could be still active socket attached to such cgroup:</p>



<pre class="wp-block-code"><code><span style="font-size: 8pt;">/**
 * cgroup_bpf_release() - put references of all bpf programs and
 *                        release all cgroup bpf data
 * @work: work structure embedded into the cgroup to modify
 */
static void cgroup_bpf_release(struct work_struct *work)
{
	struct cgroup *p, *cgrp = container_of(work, struct cgroup,
					       bpf.release_work);
	struct bpf_prog_array *old_array;
	unsigned int type;

	mutex_lock(&amp;cgroup_mutex);

	for (type = 0; type &lt; ARRAY_SIZE(cgrp-&gt;bpf.progs); type++) {
		struct list_head *progs = &amp;cgrp-&gt;bpf.progs[type];
		struct bpf_prog_list *pl, *tmp;

		list_for_each_entry_safe(pl, tmp, progs, node) {
			list_del(&amp;pl-&gt;node);
			if (pl-&gt;prog)
				bpf_prog_put(pl-&gt;prog);
			if (pl-&gt;link)
				bpf_cgroup_link_auto_detach(pl-&gt;link);
			bpf_cgroup_storages_unlink(pl-&gt;storage);
			bpf_cgroup_storages_free(pl-&gt;storage);
			kfree(pl);
			static_branch_dec(&amp;cgroup_bpf_enabled_key);
		}
		old_array = rcu_dereference_protected(
				cgrp-&gt;bpf.effective[type],
				lockdep_is_held(&amp;cgroup_mutex));
		bpf_prog_array_free(old_array);
	}

	mutex_unlock(&amp;cgroup_mutex);

	for (p = cgroup_parent(cgrp); p; p = cgroup_parent(p))
		cgroup_bpf_put(p);

	percpu_ref_exit(&amp;cgrp-&gt;bpf.refcnt);
	cgroup_put(cgrp);
}</span></code></pre>



<p>while:</p>



<pre class="wp-block-code"><code>static void bpf_cgroup_link_auto_detach(struct bpf_cgroup_link *link)
{
	cgroup_put(link-&gt;cgroup);
	link-&gt;cgroup = NULL;
}</code></pre>



<p>So if cgroup dies, all the potential clients are being auto_detached. However, they might not be aware about such situation. When is cgroup_bpf_release_fn() executed?</p>



<pre class="wp-block-code"><code><span style="font-size: 8pt;">/**
 * cgroup_bpf_inherit() - inherit effective programs from parent
 * @cgrp: the cgroup to modify
 */
int cgroup_bpf_inherit(struct cgroup *cgrp)
{
    ...
  	ret = percpu_ref_init(&amp;cgrp-&gt;bpf.refcnt, cgroup_bpf_release_fn, 0,
			      GFP_KERNEL);
    ...
}</span></code></pre>



<p>It is automatically executed when cgrp-&gt;bpf.refcnt drops to 1. However, in the warning logs before kernel had crashed, we saw that such reference counter is below 0. Cgroup was already freed.</p>



<p>Originally, I thought that the problem might be related to the code walking through the cgroup hierarchy without holding cgroup_mutex, which was pointed out by Alexei. I’ve prepared the patch and recompiled the kernel:</p>



<pre class="wp-block-code"><code>$ diff -u cgroup.c linux-5.7/kernel/bpf/cgroup.c
--- cgroup.c    2020-05-31 23:49:15.000000000 +0000
+++ linux-5.7/kernel/bpf/cgroup.c       2020-07-17 16:31:10.712969480 +0000
@@ -126,11 +126,11 @@
                bpf_prog_array_free(old_array);
        }

-       mutex_unlock(&amp;cgroup_mutex);
-
        for (p = cgroup_parent(cgrp); p; p = cgroup_parent(p))
                cgroup_bpf_put(p);

+       mutex_unlock(&amp;cgroup_mutex);
+
        percpu_ref_exit(&amp;cgrp-&gt;bpf.refcnt);
        cgroup_put(cgrp);
 }</code></pre>



<p>Interestingly, without this patch I was able to generate this kernel crash every time when I was rebooting the machine (100% repro). After this patch crashing ratio dropped to around 30%. However, I was still able to hit the same code-path and generate kernel dump. The patch indeed helps but it looks like it’s not the real problem since I can still hit the crash (just much less often).</p>



<p>I stepped back and looked again where the bug is. Corrupted pointer (struct cgroup *) is comming from that line:</p>



<pre class="wp-block-code"><code>	cgrp = sock_cgroup_ptr(&amp;sk-&gt;sk_cgrp_data);</code></pre>



<p>this code is related to the CONFIG_SOCK_CGROUP_DATA. Linux source has an interesting comment about it in “cgroup-defs.h” file:</p>



<pre class="wp-block-code"><code><span style="font-size: 10pt;">/*
 * sock_cgroup_data is embedded at sock-&gt;sk_cgrp_data and contains
 * per-socket cgroup information except for memcg association.
 *
 * On legacy hierarchies, net_prio and net_cls controllers directly set
 * attributes on each sock which can then be tested by the network layer.
 * On the default hierarchy, each sock is associated with the cgroup it was
 * created in and the networking layer can match the cgroup directly.
 *
 * To avoid carrying all three cgroup related fields separately in sock,
 * sock_cgroup_data overloads (prioidx, classid) and the cgroup pointer.
 * On boot, sock_cgroup_data records the cgroup that the sock was created
 * in so that cgroup2 matches can be made; however, once either net_prio or
 * net_cls starts being used, the area is overriden to carry prioidx and/or
 * classid.  The two modes are distinguished by whether the lowest bit is
 * set.  Clear bit indicates cgroup pointer while set bit prioidx and
 * classid.
 *
 * While userland may start using net_prio or net_cls at any time, once
 * either is used, cgroup2 matching no longer works.  There is no reason to
 * mix the two and this is in line with how legacy and v2 compatibility is
 * handled.  On mode switch, cgroup references which are already being
 * pointed to by socks may be leaked.  While this can be remedied by adding
 * synchronization around sock_cgroup_data, given that the number of leaked
 * cgroups is bound and highly unlikely to be high, this seems to be the
 * better trade-off.
 */</span></code></pre>



<p>and later:</p>



<pre class="wp-block-code"><code>/*
 * There's a theoretical window where the following accessors race with
 * updaters and return part of the previous pointer as the prioidx or
 * classid.  Such races are short-lived and the result isn't critical.
 */</code></pre>



<p>This means that sock_cgroup_data “carries” the information whether net_prio or net_cls starts being used and in such case sock_cgroup_data overloads (prioidx, classid) and the cgroup pointer. In our crash we can extract this information:</p>



<pre class="wp-block-code"><code>crash&gt; print/a ((struct sock *)0xffff9ce3de26b280)-&gt;sk_cgrp_data
$5 = {
  {
    {
      is_data = 0x0,
      padding = 0x68,
      prioidx = 0xe241,
      classid = 0xffff9ce3
    },
    val = 0xffff9ce3e2416800
  }
}</code></pre>



<p>Described socket keeps the “sk_cgrp_data” pointer with the information of being “attached” to the cgroup2. However, cgroup2 has been destroyed.<br>Now we have all the information to solve the mystery of this bug:</p>



<ol>
<li>Process creates a socket and both of them are inside some cgroup v2 (non-root)
<ul>
<li>cgroup BPF is cgroup2 only</li>
</ul>
</li>
<li>At some point net_prio or net_cls is being used:
<ul>
<li>this operation is disabling cgroup2 socket matching</li>
<li>now, all related sockets should be converted to use net_prio, and sk_cgrp_data should be updated</li>
</ul>
</li>
<li>The socket is cloned, but not the reference to the cgroup (ref: point 1)
<ul>
<li>this essentially moves the socket to the new cgroup</li>
</ul>
</li>
<li>All tasks in the old cgroup (ref: point 1) must die and when this happens, this cgroup dies as well</li>
<li>When original process is starting to “use” the socket, it might attempt to access cgroup which is already “dead”. This essentially generates Use-After-Free condition
<ul>
<li>in my specific case, process was killed or invoked exit()</li>
<li>during the execution of do_exit() function, all file descriptors and all sockets are being closed</li>
<li>one of the socket still points to the previously destroyed cgroup2 BPF (OpenSSH might install BPF)</li>
<li>__cgroup_bpf_run_filter_skb runs attached BPF and we have Use-After-Free</li>
</ul>
</li>
</ol>



<p>To confirm that scenario, I’ve modified some of the Linux kernel sources:</p>
<ol>
<li>Function cgroup_sk_alloc_disable():
<ul>
<li>I’ve added dump_stack();</li>
</ul>
</li>
<li>Function cgroup_bpf_release():<br>
<ul>
<li>I’ve moved mutex to guard code responsible for walking through the cgroup hierarchy</li>
</ul>
</li>
</ol>



<p>I’ve managed to reproduce this bug again and this is what I can see in the logs:</p>



<pre class="wp-block-code"><code><span style="font-size: 8pt;">...
[   72.061197] kmem.limit_in_bytes is deprecated and will be removed. Please report your usecase to linux-mm@kvack.org if you depend on this functionality.
[   72.121572] cgroup: cgroup: disabling cgroup2 socket matching due to net_prio or net_cls activation
               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
[   72.121574] CPU: 0 PID: 6958 Comm: kubelet Kdump: loaded Not tainted 5.7.0-g6 #32
[   72.121574] Hardware name: VMware, Inc. VMware Virtual Platform/440BX Desktop Reference Platform, BIOS 6.00 04/13/2018
[   72.121575] Call Trace:
[   72.121580]  dump_stack+0x50/0x70
[   72.121582]  cgroup_sk_alloc_disable.cold+0x11/0x25
                ^^^^^^^^^^^^^^^^^^^^^^^
[   72.121584]  net_prio_attach+0x22/0xa0
                ^^^^^^^^^^^^^^^
[   72.121586]  cgroup_migrate_execute+0x371/0x430
[   72.121587]  cgroup_attach_task+0x132/0x1f0
[   72.121588]  __cgroup1_procs_write.constprop.0+0xff/0x140
                ^^^^^^^^^^^^^^^^^^^^^^
[   72.121590]  kernfs_fop_write+0xc9/0x1a0
[   72.121592]  vfs_write+0xb1/0x1a0
[   72.121593]  ksys_write+0x5a/0xd0
[   72.121595]  do_syscall_64+0x47/0x190
[   72.121596]  entry_SYSCALL_64_after_hwframe+0x44/0xa9
[   72.121598] RIP: 0033:0x48abdb
[   72.121599] Code: ff e9 69 ff ff ff cc cc cc cc cc cc cc cc cc e8 7b 68 fb ff 48 8b 7c 24 10 48 8b 74 24 18 48 8b 54 24 20 48 8b 44 24 08 0f 05 &lt;48&gt; 3d 01 f0 ff ff 76 20 48 c7 44 24 28 ff ff ff ff 48 c7 44 24 30
[   72.121600] RSP: 002b:000000c00110f778 EFLAGS: 00000212 ORIG_RAX: 0000000000000001
[   72.121601] RAX: ffffffffffffffda RBX: 000000c000060000 RCX: 000000000048abdb
[   72.121601] RDX: 0000000000000004 RSI: 000000c00110f930 RDI: 000000000000001e
[   72.121601] RBP: 000000c00110f7c8 R08: 000000c00110f901 R09: 0000000000000004
[   72.121602] R10: 000000c0011a39a0 R11: 0000000000000212 R12: 000000000000019b
[   72.121602] R13: 000000000000019a R14: 0000000000000200 R15: 0000000000000000</span></code></pre>



<p>As we can see, net_prio is being activated and cgroup2 socket matching is being disabled. Next:</p>



<pre class="wp-block-code"><code><span style="font-size: 8pt;">[  287.497527] percpu ref (cgroup_bpf_release_fn) &lt;= 0 (-79) after switching to atomic
[  287.497535] WARNING: CPU: 0 PID: 9 at lib/percpu-refcount.c:161 percpu_ref_switch_to_atomic_rcu+0x11f/0x12a
[  287.497536] Modules linked in:
[  287.497537] CPU: 0 PID: 9 Comm: ksoftirqd/0 Kdump: loaded Not tainted 5.7.0-g6 #32
[  287.497538] Hardware name: VMware, Inc. VMware Virtual Platform/440BX Desktop Reference Platform, BIOS 6.00 04/13/2018
[  287.497539] RIP: 0010:percpu_ref_switch_to_atomic_rcu+0x11f/0x12a</span></code></pre>



<p>cgroup_bpf_release_fn is being executed multiple times. All cgroup BPF entries has been deleted and freed. Next:</p>



<pre class="wp-block-code"><code><span style="font-size: 8pt;">[  287.543976] general protection fault, probably for non-canonical address 0x6b6b6b6b6b6b6b6b: 0000 [#1] PREEMPT SMP PTI
[  287.544062] CPU: 0 PID: 11398 Comm: realpath Kdump: loaded Tainted: G        W         5.7.0-g6 #32
[  287.544133] Hardware name: VMware, Inc. VMware Virtual Platform/440BX Desktop Reference Platform, BIOS 6.00 04/13/2018
[  287.544217] RIP: 0010:__cgroup_bpf_run_filter_skb+0xd4/0x230
[  287.544267] Code: 00 48 01 c8 48 89 43 50 41 83 ff 01 0f 84 c2 00 00 00 e8 6f 55 f1 ff e8 5a 3e f5 ff 44 89 fa 48 8d 84 d5 e0 03 00 00 48 8b 00 &lt;48&gt; 8b 78 10 4c 8d 78 10 48 85 ff 0f 84 29 01 00 00 bd 01 00 00 00
[  287.544398] RSP: 0018:ffff957740003af8 EFLAGS: 00010206
[  287.544446] RAX: 6b6b6b6b6b6b6b6b RBX: ffff8911f339cf00 RCX: 0000000000000028
[  287.544506] RDX: 0000000000000000 RSI: 0000000000000000 RDI: 0000000000000001
[  287.544566] RBP: ffff8911e2eb5000 R08: 0000000000000000 R09: 0000000000000001
[  287.544625] R10: 0000000000000000 R11: 0000000000000000 R12: 0000000000000014
[  287.544685] R13: 0000000000000014 R14: 0000000000000000 R15: 0000000000000000
[  287.544753] FS:  00007f86e885a580(0000) GS:ffff8911f6e00000(0000) knlGS:0000000000000000
[  287.544833] CS:  0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[  287.544919] CR2: 000055fb75e86da4 CR3: 0000000221316003 CR4: 00000000003606f0
[  287.544996] DR0: 0000000000000000 DR1: 0000000000000000 DR2: 0000000000000000
[  287.545063] DR3: 0000000000000000 DR6: 00000000fffe0ff0 DR7: 0000000000000400
[  287.545129] Call Trace:
[  287.545167]  &lt;IRQ&gt;
[  287.545204]  sk_filter_trim_cap+0x10c/0x250
[  287.545253]  ? nf_ct_deliver_cached_events+0xb6/0x120
[  287.545308]  ? tcp_v4_inbound_md5_hash+0x47/0x160
[  287.545359]  tcp_v4_rcv+0xb49/0xda0
[  287.545404]  ? nf_hook_slow+0x3a/0xa0
[  287.545449]  ip_protocol_deliver_rcu+0x26/0x1d0
[  287.545500]  ip_local_deliver_finish+0x50/0x60
[  287.545550]  ip_sublist_rcv_finish+0x38/0x50
[  287.545599]  ip_sublist_rcv+0x16d/0x200
[  287.545645]  ? ip_rcv_finish_core.constprop.0+0x470/0x470
[  287.545701]  ip_list_rcv+0xf1/0x115
[  287.545746]  __netif_receive_skb_list_core+0x249/0x270
[  287.545801]  netif_receive_skb_list_internal+0x19f/0x2c0
[  287.545856]  napi_complete_done+0x8e/0x130
[  287.545905]  e1000_clean+0x27e/0x600
[  287.545951]  ? security_cred_free+0x37/0x50
[  287.545999]  net_rx_action+0x133/0x3b0
[  287.546045]  __do_softirq+0xfc/0x331
[  287.546091]  irq_exit+0x92/0x110
[  287.546133]  do_IRQ+0x6d/0x120
[  287.546175]  common_interrupt+0xf/0xf
[  287.546219]  &lt;/IRQ&gt;
[  287.546255] RIP: 0010:__x64_sys_exit_group+0x4/0x10</span></code></pre>



<p>We have our crash referencing freed memory.&nbsp;</p>



<p class="has-medium-font-size"><strong><span class="underline" style="text-decoration: underline;">First CVE – CVE-2020-14356:</span></strong></p>



<p>I’ve decided to report this issue to the Linux Kernel security mailing list around the mid-July (2020). Roman Gushchin replied to my report and suggested to verify if I can still repro this issue when commit ad0f75e5f57c (“cgroup: fix cgroup_sk_alloc() for sk_clone_lock()”) is applied. This commit was merged to the Linux Kernel git source tree just a few days before my report. I’ve carefully verified it and indeed it fixed the problem. However, commit ad0f75e5f57c is not fully complete and a follow-up fix 14b032b8f8fc (“cgroup: Fix sock_cgroup_data on big-endian.”) should be applied as well.</p>
<p><br>After this conversation Greg KH decided to backport Roman’s patches to the LTS kernels. In the meantime, I’ve decided to apply for CVE number (through RedHat) to track this issue:</p>
<ol>
<li>CVE-2020-14356 was allocated to track this issue</li>
<li>For some unknown reasons, this bug was classified as NULL pointer dereference <img draggable="false" role="img" class="emoji" alt="🙂" src="./2020 - The short story of 1 Linux Kernel Use-After-Free bug and 2 CVEs (CVE-2020-14356 and CVE-2020-25220)_files/1f642.svg"></li>
</ol>
<p>RedHat correctly acknowledged this issue as Use-After-Free and in their own description and bugzilla they specify:</p>
<ul style="list-style-type: circle;">
<li>“A use-after-free flaw was found in the Linux kernel’s cgroupv2 (…)”<br><a href="https://access.redhat.com/security/cve/cve-2020-14356" target="_blank" rel="noopener noreferrer">https://access.redhat.com/security/cve/cve-2020-14356</a></li>
<li>“It was found that the Linux kernel’s use after free issue (…)”<br><a href="https://bugzilla.redhat.com/show_bug.cgi?id=1868453" target="_blank" rel="noopener noreferrer">https://bugzilla.redhat.com/show_bug.cgi?id=1868453</a></li>
</ul>
<p>However, in CVE MITRE portal we can see a very inaccurate description:</p>
<ul style="list-style-type: circle;">
<li>“A flaw null pointer dereference in the Linux kernel cgroupv2 subsystem in versions before 5.7.10 was found in the way when reboot the system. A local user could use this flaw to crash the system or escalate their privileges on the system.”<br><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-14356" target="_blank" rel="noopener noreferrer">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2020-14356</a></li>
</ul>
<p>First, it is not NULL pointer dereference but Use-After-Free bug. Maybe it is badly classified based on that opened bug:<br><a href="https://bugzilla.kernel.org/show_bug.cgi?id=208003" target="_blank" rel="noopener noreferrer">https://bugzilla.kernel.org/show_bug.cgi?id=208003</a></p>
<p>People have started to hit this Use-After-Free bug in the form of NULL pointer dereference “kernel panic”.</p>
<p>Additionally, the entire description of the bug is wrong. I’ve raised that concern to the CVE MITRE but the invalid description is still there. There is also a small Twitter discussion about that here:<br><a href="https://twitter.com/Adam_pi3/status/1296212546043740160" target="_blank" rel="noopener noreferrer">https://twitter.com/Adam_pi3/status/1296212546043740160</a></p>



<p class="has-medium-font-size"><strong><span class="underline" style="text-decoration: underline;">Second CVE – CVE-2020-25220:</span></strong></p>



<p>During analysis of this bug, I contacted Brad Spengler. When the patch for this issue was backported to LTS kernels, Brad noticed that it conflicted with his pre-existing backport, and that the upstream backport looked incorrect. I was surprised since I had reviewed the original commit for mainline kernel (5.7) and it was fine. Having this in mind, I decided to carefully review the backported patch:<br><a href="https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/commit/?h=linux-4.14.y&amp;id=82fd2138a5ffd7e0d4320cdb669e115ee976a26e" target="_blank" rel="noreferrer noopener">https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/commit/?h=linux-4.14.y&amp;id=82fd2138a5ffd7e0d4320cdb669e115ee976a26e</a></p>



<p>and it really looks incorrect. Part of the original fix is the following code:</p>



<pre class="wp-block-code"><code>+void cgroup_sk_clone(struct sock_cgroup_data *skcd)
+{
+   if (skcd-&gt;val) {
+       if (skcd-&gt;no_refcnt)
+           return;
+       /*
+        * We might be cloning a socket which is left in an empty
+        * cgroup and the cgroup might have already been rmdir'd.
+        * Don't use cgroup_get_live().
+        */
+       cgroup_get(sock_cgroup_ptr(skcd));
+       cgroup_bpf_get(sock_cgroup_ptr(skcd));
+   }
+}</code></pre>



<p>However, backported patch has the following logic:</p>



<pre class="wp-block-code"><code>+void cgroup_sk_clone(struct sock_cgroup_data *skcd)
+{
+   /* Socket clone path */
+   if (skcd-&gt;val) {
+       /*
+        * We might be cloning a socket which is left in an empty
+        * cgroup and the cgroup might have already been rmdir'd.
+        * Don't use cgroup_get_live().
+        */
+       cgroup_get(sock_cgroup_ptr(skcd));
+   }
+}</code></pre>



<p>There is a missing check:</p>



<pre class="wp-block-code"><code>+       if (skcd-&gt;no_refcnt)
+           return;</code></pre>



<p>which could result in reference counter bug and in the end Use-After-Free again. It looks like the backported patch for stable kernels is still buggy.</p>



<p>I’ve contacted RedHat again and they started to provide correct patches for their own kernels. However, LTS kernels were still buggy. I’ve also asked to assign a separate CVE for that issue but RedHat suggested that I do it myself.</p>



<p>After that, I went for vacation and forgot about this issue <img draggable="false" role="img" class="emoji" alt="🙂" src="./2020 - The short story of 1 Linux Kernel Use-After-Free bug and 2 CVEs (CVE-2020-14356 and CVE-2020-25220)_files/1f642.svg"> Recently, I’ve decided to apply for CVE to track the “bad patch” issue, and CVE-2020-25220 was allocated. It is worth to point out that someone from Huawei at some point realized that patch is wrong and LTS got a correct fix as well:</p>



<p><a href="https://www.spinics.net/lists/stable/msg405099.html">https://www.spinics.net/lists/stable/msg405099.html</a></p>



<p>What is worth to mention, grsecurity backport was never affected by the CVE-2020-25220.</p>



<p class="has-medium-font-size"><strong><span class="underline" style="text-decoration: underline;">Summary</span></strong>:</p>



<p>Original issue, tracked by CVE-2020-14356, affects kernels starting from 4.5+ up to 5.7.10.</p>
<ul>
<li>RedHat correctly fixed all their kernels, and has proper description of the bug</li>
<li>CVE MITRE still has invalid and misleading description</li>
</ul>
<p>Badly backported patch, tracked by CVE-2020-25220, affects kernels:</p>
<ul>
<li>4.19 until version 4.19.140 (exclusive)</li>
<li>4.14 until version 4.14.194 (exclusive)</li>
<li>4.9 until version 4.9.233 (exclusive)</li>
</ul>
<p>*grsecurity kernels were never affected by the CVE-2020-25220</p>
<p><br>Best regards,<br>Adam ‘pi3’ Zabrocki</p>
<div style="clear:both;"></div>

		

		<div class="postmeta">

			<p> Filed Under <a href="http://blog.pi3.com.pl/?cat=4" rel="category">Bughunt</a>, <a href="http://blog.pi3.com.pl/?cat=5" rel="category">Exploiting</a>&nbsp;</p>

		</div>

	 			

		<!--

		<rdf:RDF xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#"
			xmlns:dc="http://purl.org/dc/elements/1.1/"
			xmlns:trackback="http://madskills.com/public/xml/rss/module/trackback/">
		<rdf:Description rdf:about="http://blog.pi3.com.pl/?p=720"
    dc:identifier="http://blog.pi3.com.pl/?p=720"
    dc:title="CVE: 2020-14356 &#038; 2020-25220"
    trackback:ping="http://blog.pi3.com.pl/wp-trackback.php?p=720" />
</rdf:RDF>
		-->

		

		<p class="class1">Comments</p>

		


<!-- You can start editing here. -->





<div id="commentblock">




	
		<!-- If comments are open, but there are no comments. -->



	 








<p class="class1">Leave a Reply</p>






<form action="http://blog.pi3.com.pl/wp-comments-post.php" method="post" id="commentform">






<p class="label"><label for="author">Name (Required)</label><br>

<input type="text" name="author" id="author" value="" tabindex="1"></p>



<p class="label"><label for="email">Email Address (Required)</label><br>

<input type="text" name="email" id="email" value="" tabindex="2"></p>



<p class="label"><label for="url">Website</label><br>

<input type="text" name="url" id="url" value="" tabindex="3"></p>






<p class="label2"><textarea name="comment" id="comment" cols="40" rows="10" tabindex="4"></textarea></p>



<p><input name="submit" type="submit" id="submit" tabindex="5" value="Submit Comment">

<input type="hidden" name="comment_post_ID" value="720"></p>



<p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="14422bfec0"></p><p style="display: none !important;"><label>Δ<textarea name="ak_hp_textarea" cols="45" rows="8" maxlength="100"></textarea></label><input type="hidden" id="ak_js" name="ak_js" value="1638484856814"><script>document.getElementById( "ak_js" ).setAttribute( "value", ( new Date() ).getTime() );</script></p><p class="cptch_block"><span class="cptch_title">CAPTCHA<span class="required"> *</span></span><script class="cptch_to_remove">
				(function( timeout ) {
					setTimeout(
						function() {
							var notice = document.getElementById("cptch_time_limit_notice_34");
							if ( notice )
								notice.style.display = "block";
						},
						timeout
					);
				})(120000);
			</script>
			<span id="cptch_time_limit_notice_34" class="cptch_time_limit_notice cptch_to_remove">Time limit is exhausted. Please reload the CAPTCHA.</span><span class="cptch_wrap cptch_math_actions">
				<label class="cptch_label" for="cptch_input_34"><span class="cptch_span"><img class="cptch_img " src="data:image/png;base64,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" alt="image"></span>
					<span class="cptch_span">&nbsp;−&nbsp;</span>
					<span class="cptch_span"><input id="cptch_input_34" class="cptch_input cptch_wp_comments" type="text" autocomplete="off" name="cptch_number" value="" maxlength="2" size="2" aria-required="true" required="required" style="margin-bottom:0;display:inline;font-size: 12px;width: 40px;"></span>
					<span class="cptch_span">&nbsp;=&nbsp;</span>
					<span class="cptch_span">zero</span>
					<input type="hidden" name="cptch_result" value="OJ0="><input type="hidden" name="cptch_time" value="1638484854">
					<input type="hidden" name="cptch_form" value="wp_comments">
				</label><span class="cptch_reload_button_wrap hide-if-no-js">
					<noscript>
						<style type="text/css">
							.hide-if-no-js {
								display: none !important;
							}
						</style>
					</noscript>
					<span class="cptch_reload_button dashicons dashicons-update"></span>
				</span></span></p>


</form>

</div>







		

		
	

	</div>

        </div>

<div style="clear:both;"></div>



<div id="footerwrap">



<div id="footer">



     <div id="copyright">



           <p>Copyright © 2021 <a href="http://blog.pi3.com.pl/">pi3 blog</a>.</p>



     </div>



     <div id="design">



           <p><a href="http://www.arsgrafik.com/">Gods &amp; Monsters</a> Theme | Powered by <a href="http://wordpress.org/">WordPress</a> </p>



     </div>







</div>



<script type="text/javascript" src="./2020 - The short story of 1 Linux Kernel Use-After-Free bug and 2 CVEs (CVE-2020-14356 and CVE-2020-25220)_files/wp-embed.min.js.下載" id="wp-embed-js"></script>
<script type="text/javascript" src="./2020 - The short story of 1 Linux Kernel Use-After-Free bug and 2 CVEs (CVE-2020-14356 and CVE-2020-25220)_files/jquery.min.js.下載" id="jquery-core-js"></script>
<script type="text/javascript" src="./2020 - The short story of 1 Linux Kernel Use-After-Free bug and 2 CVEs (CVE-2020-14356 and CVE-2020-25220)_files/jquery-migrate.min.js.下載" id="jquery-migrate-js"></script>
<script type="text/javascript" id="cptch_front_end_script-js-extra">
/* <![CDATA[ */
var cptch_vars = {"nonce":"3488d2cb7b","ajaxurl":"http:\/\/blog.pi3.com.pl\/wp-admin\/admin-ajax.php","enlarge":"0"};
/* ]]> */
</script>
<script type="text/javascript" src="./2020 - The short story of 1 Linux Kernel Use-After-Free bug and 2 CVEs (CVE-2020-14356 and CVE-2020-25220)_files/front_end_script.js.下載" id="cptch_front_end_script-js"></script>
<script src="./2020 - The short story of 1 Linux Kernel Use-After-Free bug and 2 CVEs (CVE-2020-14356 and CVE-2020-25220)_files/e-202148.js.下載" defer=""></script>
<script>
	_stq = window._stq || [];
	_stq.push([ 'view', {v:'ext',j:'1:10.2.1',blog:'21042933',post:'720',tz:'1',srv:'blog.pi3.com.pl'} ]);
	_stq.push([ 'clickTrackerInit', '21042933', '720' ]);
</script>












</div></div><img src="./2020 - The short story of 1 Linux Kernel Use-After-Free bug and 2 CVEs (CVE-2020-14356 and CVE-2020-25220)_files/g.gif" alt="" width="6" height="5" id="wpstats"></body></html>