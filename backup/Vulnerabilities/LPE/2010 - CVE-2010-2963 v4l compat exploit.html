<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0078)https://outflux.net/blog/archives/2010/10/19/cve-2010-2963-v4l-compat-exploit/ -->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head profile="http://gmpg.org/xfn/11"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	

	<title>CVE-2010-2963 v4l compat exploit Â«  codeblog</title>

	<style type="text/css" media="screen">
		@import url( https://outflux.net/blog/wp-content/themes/classic/style.css );
	</style>

	<link rel="pingback" href="https://outflux.net/blog/xmlrpc.php">
		<link rel="archives" title="April 2021" href="https://outflux.net/blog/archives/2021/04/">
	<link rel="archives" title="February 2021" href="https://outflux.net/blog/archives/2021/02/">
	<link rel="archives" title="October 2020" href="https://outflux.net/blog/archives/2020/10/">
	<link rel="archives" title="September 2020" href="https://outflux.net/blog/archives/2020/09/">
	<link rel="archives" title="May 2020" href="https://outflux.net/blog/archives/2020/05/">
	<link rel="archives" title="February 2020" href="https://outflux.net/blog/archives/2020/02/">
	<link rel="archives" title="November 2019" href="https://outflux.net/blog/archives/2019/11/">
	<link rel="archives" title="July 2019" href="https://outflux.net/blog/archives/2019/07/">
	<link rel="archives" title="June 2019" href="https://outflux.net/blog/archives/2019/06/">
	<link rel="archives" title="May 2019" href="https://outflux.net/blog/archives/2019/05/">
	<link rel="archives" title="March 2019" href="https://outflux.net/blog/archives/2019/03/">
	<link rel="archives" title="December 2018" href="https://outflux.net/blog/archives/2018/12/">
	<link rel="archives" title="October 2018" href="https://outflux.net/blog/archives/2018/10/">
	<link rel="archives" title="August 2018" href="https://outflux.net/blog/archives/2018/08/">
	<link rel="archives" title="June 2018" href="https://outflux.net/blog/archives/2018/06/">
	<link rel="archives" title="April 2018" href="https://outflux.net/blog/archives/2018/04/">
	<link rel="archives" title="February 2018" href="https://outflux.net/blog/archives/2018/02/">
	<link rel="archives" title="January 2018" href="https://outflux.net/blog/archives/2018/01/">
	<link rel="archives" title="November 2017" href="https://outflux.net/blog/archives/2017/11/">
	<link rel="archives" title="September 2017" href="https://outflux.net/blog/archives/2017/09/">
	<link rel="archives" title="August 2017" href="https://outflux.net/blog/archives/2017/08/">
	<link rel="archives" title="July 2017" href="https://outflux.net/blog/archives/2017/07/">
	<link rel="archives" title="May 2017" href="https://outflux.net/blog/archives/2017/05/">
	<link rel="archives" title="February 2017" href="https://outflux.net/blog/archives/2017/02/">
	<link rel="archives" title="December 2016" href="https://outflux.net/blog/archives/2016/12/">
	<link rel="archives" title="October 2016" href="https://outflux.net/blog/archives/2016/10/">
	<link rel="archives" title="September 2016" href="https://outflux.net/blog/archives/2016/09/">
	<link rel="archives" title="November 2015" href="https://outflux.net/blog/archives/2015/11/">
	<link rel="archives" title="July 2015" href="https://outflux.net/blog/archives/2015/07/">
	<link rel="archives" title="January 2015" href="https://outflux.net/blog/archives/2015/01/">
	<link rel="archives" title="December 2014" href="https://outflux.net/blog/archives/2014/12/">
	<link rel="archives" title="June 2014" href="https://outflux.net/blog/archives/2014/06/">
	<link rel="archives" title="May 2014" href="https://outflux.net/blog/archives/2014/05/">
	<link rel="archives" title="February 2014" href="https://outflux.net/blog/archives/2014/02/">
	<link rel="archives" title="January 2014" href="https://outflux.net/blog/archives/2014/01/">
	<link rel="archives" title="December 2013" href="https://outflux.net/blog/archives/2013/12/">
	<link rel="archives" title="November 2013" href="https://outflux.net/blog/archives/2013/11/">
	<link rel="archives" title="August 2013" href="https://outflux.net/blog/archives/2013/08/">
	<link rel="archives" title="May 2013" href="https://outflux.net/blog/archives/2013/05/">
	<link rel="archives" title="January 2013" href="https://outflux.net/blog/archives/2013/01/">
	<link rel="archives" title="November 2012" href="https://outflux.net/blog/archives/2012/11/">
	<link rel="archives" title="October 2012" href="https://outflux.net/blog/archives/2012/10/">
	<link rel="archives" title="May 2012" href="https://outflux.net/blog/archives/2012/05/">
	<link rel="archives" title="March 2012" href="https://outflux.net/blog/archives/2012/03/">
	<link rel="archives" title="February 2012" href="https://outflux.net/blog/archives/2012/02/">
	<link rel="archives" title="January 2012" href="https://outflux.net/blog/archives/2012/01/">
	<link rel="archives" title="December 2011" href="https://outflux.net/blog/archives/2011/12/">
	<link rel="archives" title="November 2011" href="https://outflux.net/blog/archives/2011/11/">
	<link rel="archives" title="September 2011" href="https://outflux.net/blog/archives/2011/09/">
	<link rel="archives" title="July 2011" href="https://outflux.net/blog/archives/2011/07/">
	<link rel="archives" title="April 2011" href="https://outflux.net/blog/archives/2011/04/">
	<link rel="archives" title="February 2011" href="https://outflux.net/blog/archives/2011/02/">
	<link rel="archives" title="December 2010" href="https://outflux.net/blog/archives/2010/12/">
	<link rel="archives" title="November 2010" href="https://outflux.net/blog/archives/2010/11/">
	<link rel="archives" title="October 2010" href="https://outflux.net/blog/archives/2010/10/">
	<link rel="archives" title="September 2010" href="https://outflux.net/blog/archives/2010/09/">
	<link rel="archives" title="August 2010" href="https://outflux.net/blog/archives/2010/08/">
	<link rel="archives" title="July 2010" href="https://outflux.net/blog/archives/2010/07/">
	<link rel="archives" title="June 2010" href="https://outflux.net/blog/archives/2010/06/">
	<link rel="archives" title="May 2010" href="https://outflux.net/blog/archives/2010/05/">
	<link rel="archives" title="April 2010" href="https://outflux.net/blog/archives/2010/04/">
	<link rel="archives" title="March 2010" href="https://outflux.net/blog/archives/2010/03/">
	<link rel="archives" title="February 2010" href="https://outflux.net/blog/archives/2010/02/">
	<link rel="archives" title="January 2010" href="https://outflux.net/blog/archives/2010/01/">
	<link rel="archives" title="December 2009" href="https://outflux.net/blog/archives/2009/12/">
	<link rel="archives" title="November 2009" href="https://outflux.net/blog/archives/2009/11/">
	<link rel="archives" title="October 2009" href="https://outflux.net/blog/archives/2009/10/">
	<link rel="archives" title="September 2009" href="https://outflux.net/blog/archives/2009/09/">
	<link rel="archives" title="July 2009" href="https://outflux.net/blog/archives/2009/07/">
	<link rel="archives" title="May 2009" href="https://outflux.net/blog/archives/2009/05/">
	<link rel="archives" title="April 2009" href="https://outflux.net/blog/archives/2009/04/">
	<link rel="archives" title="February 2009" href="https://outflux.net/blog/archives/2009/02/">
	<link rel="archives" title="January 2009" href="https://outflux.net/blog/archives/2009/01/">
	<link rel="archives" title="December 2008" href="https://outflux.net/blog/archives/2008/12/">
	<link rel="archives" title="November 2008" href="https://outflux.net/blog/archives/2008/11/">
	<link rel="archives" title="October 2008" href="https://outflux.net/blog/archives/2008/10/">
	<link rel="archives" title="September 2008" href="https://outflux.net/blog/archives/2008/09/">
	<link rel="archives" title="August 2008" href="https://outflux.net/blog/archives/2008/08/">
	<link rel="archives" title="July 2008" href="https://outflux.net/blog/archives/2008/07/">
	<link rel="archives" title="June 2008" href="https://outflux.net/blog/archives/2008/06/">
	<link rel="archives" title="April 2008" href="https://outflux.net/blog/archives/2008/04/">
	<link rel="archives" title="March 2008" href="https://outflux.net/blog/archives/2008/03/">
	<link rel="archives" title="February 2008" href="https://outflux.net/blog/archives/2008/02/">
	<link rel="archives" title="January 2008" href="https://outflux.net/blog/archives/2008/01/">
	<link rel="archives" title="December 2007" href="https://outflux.net/blog/archives/2007/12/">
	<link rel="archives" title="September 2007" href="https://outflux.net/blog/archives/2007/09/">
	<link rel="archives" title="August 2007" href="https://outflux.net/blog/archives/2007/08/">
	<link rel="archives" title="April 2007" href="https://outflux.net/blog/archives/2007/04/">
	<link rel="archives" title="March 2007" href="https://outflux.net/blog/archives/2007/03/">
	<link rel="archives" title="February 2007" href="https://outflux.net/blog/archives/2007/02/">
	<link rel="archives" title="January 2007" href="https://outflux.net/blog/archives/2007/01/">
	<link rel="archives" title="December 2006" href="https://outflux.net/blog/archives/2006/12/">
	<link rel="archives" title="October 2006" href="https://outflux.net/blog/archives/2006/10/">
	<link rel="archives" title="September 2006" href="https://outflux.net/blog/archives/2006/09/">
	<link rel="archives" title="August 2006" href="https://outflux.net/blog/archives/2006/08/">
	<link rel="archives" title="July 2006" href="https://outflux.net/blog/archives/2006/07/">
	<link rel="archives" title="June 2006" href="https://outflux.net/blog/archives/2006/06/">
	<link rel="archives" title="May 2006" href="https://outflux.net/blog/archives/2006/05/">
	<link rel="archives" title="April 2006" href="https://outflux.net/blog/archives/2006/04/">
	<link rel="archives" title="March 2006" href="https://outflux.net/blog/archives/2006/03/">
	<link rel="archives" title="January 2006" href="https://outflux.net/blog/archives/2006/01/">
	<link rel="archives" title="December 2005" href="https://outflux.net/blog/archives/2005/12/">
	<link rel="archives" title="October 2005" href="https://outflux.net/blog/archives/2005/10/">
	<link rel="archives" title="September 2005" href="https://outflux.net/blog/archives/2005/09/">
	<link rel="archives" title="August 2005" href="https://outflux.net/blog/archives/2005/08/">
	<link rel="archives" title="July 2005" href="https://outflux.net/blog/archives/2005/07/">
	<link rel="archives" title="June 2005" href="https://outflux.net/blog/archives/2005/06/">
	<link rel="archives" title="May 2005" href="https://outflux.net/blog/archives/2005/05/">
	<link rel="archives" title="April 2005" href="https://outflux.net/blog/archives/2005/04/">
	<link rel="archives" title="March 2005" href="https://outflux.net/blog/archives/2005/03/">
	<link rel="archives" title="February 2005" href="https://outflux.net/blog/archives/2005/02/">
	<link rel="archives" title="January 2005" href="https://outflux.net/blog/archives/2005/01/">
		<link rel="dns-prefetch" href="https://s.w.org/">
<link rel="alternate" type="application/rss+xml" title="codeblog Â» Feed" href="https://outflux.net/blog/feed/">
<link rel="alternate" type="application/rss+xml" title="codeblog Â» Comments Feed" href="https://outflux.net/blog/comments/feed/">
<link rel="alternate" type="application/rss+xml" title="codeblog Â» CVE-2010-2963 v4l compat exploit Comments Feed" href="https://outflux.net/blog/archives/2010/10/19/cve-2010-2963-v4l-compat-exploit/feed/">
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.4\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/2.4\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/outflux.net\/blog\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.9.5"}};
			!function(a,b,c){function d(a,b){var c=String.fromCharCode;l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,a),0,0);var d=k.toDataURL();l.clearRect(0,0,k.width,k.height),l.fillText(c.apply(this,b),0,0);var e=k.toDataURL();return d===e}function e(a){var b;if(!l||!l.fillText)return!1;switch(l.textBaseline="top",l.font="600 32px Arial",a){case"flag":return!(b=d([55356,56826,55356,56819],[55356,56826,8203,55356,56819]))&&(b=d([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]),!b);case"emoji":return b=d([55357,56692,8205,9792,65039],[55357,56692,8203,9792,65039]),!b}return!1}function f(a){var c=b.createElement("script");c.src=a,c.defer=c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var g,h,i,j,k=b.createElement("canvas"),l=k.getContext&&k.getContext("2d");for(j=Array("flag","emoji"),c.supports={everything:!0,everythingExceptFlag:!0},i=0;i<j.length;i++)c.supports[j[i]]=e(j[i]),c.supports.everything=c.supports.everything&&c.supports[j[i]],"flag"!==j[i]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[j[i]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(h=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",h,!1),a.addEventListener("load",h,!1)):(a.attachEvent("onload",h),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),g=c.source||{},g.concatemoji?f(g.concatemoji):g.wpemoji&&g.twemoji&&(f(g.twemoji),f(g.wpemoji)))}(window,document,window._wpemojiSettings);
		</script><script src="./2010 - CVE-2010-2963 v4l compat exploit_files/wp-emoji-release.min.js.ä¸è¼" type="text/javascript" defer=""></script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel="stylesheet" id="contact-form-7-css" href="./2010 - CVE-2010-2963 v4l compat exploit_files/styles.css" type="text/css" media="all">
<script type="text/javascript" src="./2010 - CVE-2010-2963 v4l compat exploit_files/jquery.js.ä¸è¼"></script>
<script type="text/javascript" src="./2010 - CVE-2010-2963 v4l compat exploit_files/jquery-migrate.min.js.ä¸è¼"></script>
<link rel="https://api.w.org/" href="https://outflux.net/blog/wp-json/">
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://outflux.net/blog/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://outflux.net/blog/wp-includes/wlwmanifest.xml"> 
<link rel="prev" title="mountall umask" href="https://outflux.net/blog/archives/2010/10/13/mountall-umask/">
<link rel="next" title="Jettison Jaunty" href="https://outflux.net/blog/archives/2010/10/25/jettison-jaunty/">
<meta name="generator" content="WordPress 4.9.5">
<link rel="canonical" href="https://outflux.net/blog/archives/2010/10/19/cve-2010-2963-v4l-compat-exploit/">
<link rel="shortlink" href="https://outflux.net/blog/?p=407">
<link rel="alternate" type="application/json+oembed" href="https://outflux.net/blog/wp-json/oembed/1.0/embed?url=https%3A%2F%2Foutflux.net%2Fblog%2Farchives%2F2010%2F10%2F19%2Fcve-2010-2963-v4l-compat-exploit%2F">
<link rel="alternate" type="text/xml+oembed" href="https://outflux.net/blog/wp-json/oembed/1.0/embed?url=https%3A%2F%2Foutflux.net%2Fblog%2Farchives%2F2010%2F10%2F19%2Fcve-2010-2963-v4l-compat-exploit%2F&amp;format=xml">
	<link type="text/css" rel="stylesheet" href="./2010 - CVE-2010-2963 v4l compat exploit_files/shCore.css">
	<link type="text/css" rel="stylesheet" href="./2010 - CVE-2010-2963 v4l compat exploit_files/shThemeDefault.css">
	<script type="text/javascript" src="./2010 - CVE-2010-2963 v4l compat exploit_files/shCore.js.ä¸è¼"></script>
	<script type="text/javascript" src="./2010 - CVE-2010-2963 v4l compat exploit_files/shBrushBash.js.ä¸è¼"></script>
	<script type="text/javascript" src="./2010 - CVE-2010-2963 v4l compat exploit_files/shBrushCpp.js.ä¸è¼"></script>
	<script type="text/javascript" src="./2010 - CVE-2010-2963 v4l compat exploit_files/shBrushCSharp.js.ä¸è¼"></script>
	<script type="text/javascript" src="./2010 - CVE-2010-2963 v4l compat exploit_files/shBrushCss.js.ä¸è¼"></script>
	<script type="text/javascript" src="./2010 - CVE-2010-2963 v4l compat exploit_files/shBrushDelphi.js.ä¸è¼"></script>
	<script type="text/javascript" src="./2010 - CVE-2010-2963 v4l compat exploit_files/shBrushDiff.js.ä¸è¼"></script>
	<script type="text/javascript" src="./2010 - CVE-2010-2963 v4l compat exploit_files/shBrushGroovy.js.ä¸è¼"></script>
	<script type="text/javascript" src="./2010 - CVE-2010-2963 v4l compat exploit_files/shBrushJava.js.ä¸è¼"></script>
	<script type="text/javascript" src="./2010 - CVE-2010-2963 v4l compat exploit_files/shBrushJScript.js.ä¸è¼"></script>
	<script type="text/javascript" src="./2010 - CVE-2010-2963 v4l compat exploit_files/shBrushPerl.js.ä¸è¼"></script>
	<script type="text/javascript" src="./2010 - CVE-2010-2963 v4l compat exploit_files/shBrushPhp.js.ä¸è¼"></script>
	<script type="text/javascript" src="./2010 - CVE-2010-2963 v4l compat exploit_files/shBrushPlain.js.ä¸è¼"></script>
	<script type="text/javascript" src="./2010 - CVE-2010-2963 v4l compat exploit_files/shBrushPython.js.ä¸è¼"></script>
	<script type="text/javascript" src="./2010 - CVE-2010-2963 v4l compat exploit_files/shBrushRuby.js.ä¸è¼"></script>
	<script type="text/javascript" src="./2010 - CVE-2010-2963 v4l compat exploit_files/shBrushScala.js.ä¸è¼"></script>
	<script type="text/javascript" src="./2010 - CVE-2010-2963 v4l compat exploit_files/shBrushSql.js.ä¸è¼"></script>
	<script type="text/javascript" src="./2010 - CVE-2010-2963 v4l compat exploit_files/shBrushVb.js.ä¸è¼"></script>
	<script type="text/javascript" src="./2010 - CVE-2010-2963 v4l compat exploit_files/shBrushXml.js.ä¸è¼"></script>
	<script type="text/javascript">		
		SyntaxHighlighter.config.clipboardSwf = 'https://outflux.net/blog/wp-content/plugins/syntax-highlighter-and-code-prettifier/scripts/clipboard.swf';
		SyntaxHighlighter.all();
	</script>
	</head>

<body class="post-template-default single single-post postid-407 single-format-standard">
<div id="rap">
<h1 id="header">
	<a href="https://outflux.net/blog/">codeblog</a>
	<span id="tagline">code is freedom â patching my itch</span>
</h1>

<div id="content">
<!-- end header -->


<h2>October 19, 2010</h2>
<div class="post-407 post type-post status-publish format-standard hentry category-blogging category-debian category-security category-ubuntu category-ubuntu-server category-vulnerabilities" id="post-407">
	 <h3 class="storytitle"><a href="https://outflux.net/blog/archives/2010/10/19/cve-2010-2963-v4l-compat-exploit/" rel="bookmark">CVE-2010-2963 v4l compat exploit</a></h3>
	<div class="meta">Filed under: <a href="https://outflux.net/blog/archives/category/blogging/" rel="category tag">Blogging</a>,<a href="https://outflux.net/blog/archives/category/debian/" rel="category tag">Debian</a>,<a href="https://outflux.net/blog/archives/category/security/" rel="category tag">Security</a>,<a href="https://outflux.net/blog/archives/category/ubuntu/" rel="category tag">Ubuntu</a>,<a href="https://outflux.net/blog/archives/category/ubuntu-server/" rel="category tag">Ubuntu-Server</a>,<a href="https://outflux.net/blog/archives/category/vulnerabilities/" rel="category tag">Vulnerabilities</a> â  kees @ 3:41 pm </div>

	<div class="storycontent">
		<p>If youâre running a 64bit system, and youâve got users with access to a video device (<code>/dev/video*</code>), then be sure you update your kernels for <a href="http://git.kernel.org/?p=linux/kernel/git/torvalds/linux-2.6.git;a=commitdiff;h=3e645d6b485446c54c6745c5e2cf5c528fe4deec">CVE-2010-2963</a>.  Iâve been slowly making my way through auditing the many uses in the Linux kernel of the <code>copy_from_user()</code> function, and ran into this vulnerability.</p>
<p>Hereâs the kernel code from <code>drivers/media/video/v4l2-compat-ioctl32.c</code>:</p>
<div id="highlighter_323008" class="syntaxhighlighter  "><div class="bar "><div class="toolbar"><a href="https://outflux.net/blog/archives/2010/10/19/cve-2010-2963-v4l-compat-exploit/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_323008_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_323008" menu="false" src="https://outflux.net/blog/wp-content/plugins/syntax-highlighter-and-code-prettifier/scripts/clipboard.swf"></div><a href="https://outflux.net/blog/archives/2010/10/19/cve-2010-2963-v4l-compat-exploit/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="https://outflux.net/blog/archives/2010/10/19/cve-2010-2963-v4l-compat-exploit/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="keyword bold">static</code> <code class="color1 bold">int</code> <code class="plain">get_microcode32(</code><code class="keyword bold">struct</code> <code class="plain">video_code *kp, </code><code class="keyword bold">struct</code> <code class="plain">video_code32 __user *up)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="plain">{</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">if</code> <code class="plain">(!access_ok(VERIFY_READ, up, </code><code class="keyword bold">sizeof</code><code class="plain">(</code><code class="keyword bold">struct</code> <code class="plain">video_code32)) ||</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">copy_from_user(kp-&gt;loadwhat, up-&gt;loadwhat, </code><code class="keyword bold">sizeof</code><code class="plain">(up-&gt;loadwhat)) ||</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">get_user(kp-&gt;datasize, &amp;up-&gt;datasize) ||</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>6</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">copy_from_user(kp-&gt;data, up-&gt;data, up-&gt;datasize))</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>7</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">return</code> <code class="plain">-EFAULT;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>8</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">return</code> <code class="plain">0;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>9</code></td><td class="content"><code class="plain">}</code></td></tr></tbody></table></div></div></div>
<p>Note that <code>kp-&gt;data</code> is being used as the target for <code>up-&gt;data</code> in the final <code>copy_from_user()</code> without actually verifying that <code>kp-&gt;data</code> is pointing anywhere safe. Hereâs the caller of <code>get_microcode32</code>:</p>
<div id="highlighter_692791" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="https://outflux.net/blog/archives/2010/10/19/cve-2010-2963-v4l-compat-exploit/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_692791_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_692791" menu="false" src="https://outflux.net/blog/wp-content/plugins/syntax-highlighter-and-code-prettifier/scripts/clipboard.swf"></div><a href="https://outflux.net/blog/archives/2010/10/19/cve-2010-2963-v4l-compat-exploit/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="https://outflux.net/blog/archives/2010/10/19/cve-2010-2963-v4l-compat-exploit/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>01</code></td><td class="content"><code class="keyword bold">static</code> <code class="color1 bold">long</code> <code class="plain">do_video_ioctl(</code><code class="keyword bold">struct</code> <code class="plain">file *file, unsigned </code><code class="color1 bold">int</code> <code class="plain">cmd, unsigned </code><code class="color1 bold">long</code> <code class="plain">arg)</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>02</code></td><td class="content"><code class="plain">{</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>03</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">union</code> <code class="plain">{</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>04</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">struct</code> <code class="plain">video_tuner vt;</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>05</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">struct</code> <code class="plain">video_code vc;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>06</code></td><td class="content"><code class="plain">...</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>07</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">} karg;</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>08</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">void</code> <code class="plain">__user *up = compat_ptr(arg);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>09</code></td><td class="content"><code class="plain">...</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>10</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">switch</code> <code class="plain">(cmd) {</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>11</code></td><td class="content"><code class="plain">...</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>12</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">VIDIOCSMICROCODE:</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>13</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">err = get_microcode32(&amp;karg.vc, up);</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>14</code></td><td class="content"><code class="plain">...</code></td></tr></tbody></table></div></div></div>
<p>So, the contents of <code>up</code> are totally under control of the caller, and the contents of <code>karg</code> (in our case, the <code>video_code</code> structure) are <em>not initialized at all</em>. So, it seems like a call for <code>VIDIOCSMICROCODE</code> would write <code>video_code-&gt;datasize</code> bytes from <code>video_code-&gt;data</code> into some random kernel address, just causing an Oops, since we donât control what is on the kernelâs stack.</p>
<p>But wait, who says we canât control the contents of the kernelâs stack? In fact, this compat function makes it extremely easy. Letâs look back at the union. Notice the <code>struct video_tuner</code>? That gets populated from the callerâs <code>up</code> memory via this case of the <code>switch (cmd)</code> statement:</p>
<div id="highlighter_864839" class="syntaxhighlighter  "><div class="bar"><div class="toolbar"><a href="https://outflux.net/blog/archives/2010/10/19/cve-2010-2963-v4l-compat-exploit/#viewSource" title="view source" class="item viewSource" style="width: 16px; height: 16px;">view source</a><div class="item copyToClipboard"><embed width="16" height="16" id="highlighter_864839_clipboard" type="application/x-shockwave-flash" title="copy to clipboard" allowscriptaccess="always" wmode="transparent" flashvars="highlighterId=highlighter_864839" menu="false" src="https://outflux.net/blog/wp-content/plugins/syntax-highlighter-and-code-prettifier/scripts/clipboard.swf"></div><a href="https://outflux.net/blog/archives/2010/10/19/cve-2010-2963-v4l-compat-exploit/#printSource" title="print" class="item printSource" style="width: 16px; height: 16px;">print</a><a href="https://outflux.net/blog/archives/2010/10/19/cve-2010-2963-v4l-compat-exploit/#about" title="?" class="item about" style="width: 16px; height: 16px;">?</a></div></div><div class="lines"><div class="line alt1"><table><tbody><tr><td class="number"><code>1</code></td><td class="content"><code class="plain">...</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>2</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">VIDIOCSTUNER:</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>3</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="keyword bold">case</code> <code class="plain">VIDIOCGTUNER:</code></td></tr></tbody></table></div><div class="line alt2"><table><tbody><tr><td class="number"><code>4</code></td><td class="content"><code class="spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="plain">err = get_video_tuner32(&amp;karg.vt, up);</code></td></tr></tbody></table></div><div class="line alt1"><table><tbody><tr><td class="number"><code>5</code></td><td class="content"><code class="plain">...</code></td></tr></tbody></table></div></div></div>
<p>So, to control the kernel stack, we just need to call this <code>ioctl</code> twice in a row: once to populate the stack via <code>VIDIOCSTUNER</code> with the contents we want (including the future address for <code>video_code-&gt;data</code>, which starts at the same location as <code>video_tuner-&gt;name[20]</code>), and then again with <code>VIDIOCSMICROCODE</code>.</p>
<p>Tricks involved here are: the definition of the <code>VIDIOCSMICROCODE</code> case in the kernel is wrong, and calling the <code>ioctl</code>s without any preparation can trigger other kernel work (memory faults, etc) that may destroy the stack contents. First, we need the real value for the desired case statement. This turns out to be 0x4020761b. Next, we just repeatedly call the setup <code>ioctl</code> in an attempt to get incidental kernel work out of the way so that our last <code>ioctl</code> doing the stack preparation will stick, and then we call the buggy <code>ioctl</code> to trigger the vulnerability.</p>
<p>Since the ioctl already does a multi-byte copy, we can now copy arbitrary lengths of bytes into kernel memory. One method of turning an arbitrary kernel memory write into a privilege escalation is to overwrite a kernel function pointer, and trigger that function. Based on the <a href="http://blog.ksplice.com/2010/09/anatomy-of-an-exploit-cve-2010-3081/">exploit for CVE-2010-3081</a>, I opted to overwrite the <code>security_ops</code> function pointer table. Their use of <code>msg_queue_msgctl</code> wasnât very good for the general case since itâs near the end of the table and its offset would depend on kernel versions. Initially I opted for <code>getcap</code>, but in the end used <code>ptrace_traceme</code>, both of which are very near the top the <code>security_ops</code> structure. (Though I need share credit here with <a href="http://twitter.com/djrbliss">Dan Rosenberg</a> as we were working together on improving the reliability of the <code>security_ops</code> overwrite method. He used the same approach for his excellent <a href="http://www.vsecurity.com/resources/advisory/20101019-1/">RDS exploit</a>.)</p>
<p>Here are the steps for one way of taking an arbitrary kernel memory write and turning it into a root escalation:</p>
<ul>
<li>overwrite <code>security_ops</code> with <code>default_security_ops</code>, which will revert the LSM back to the capabilities-only security operations. This, however, means we can calculate where <code>cap_ptrace_traceme</code> is.</li>
<li>overwrite <code>default_security_ops-&gt;ptrace_traceme</code> to point to our supplied function that will actually perform the privilege escalation (thanks to <a href="http://www.grsecurity.net/~spender/">Brad Spengler</a> for his code from Enlightenment).</li>
<li>trigger the function (in this case, call <code>ptrace(PTRACE_TRACEME, 0, NULL, NULL)</code>).</li>
<li>restore <code>default_security_ops-&gt;ptrace_traceme</code> to point to <code>cap_ptrace_traceme</code> so the next caller doesnât Oops the system (since userspace memory will be remapped).</li>
</ul>
<p>Hereâs the <a href="http://outflux.net/exploits/exp_vyakarana.c">source</a> for <a href="http://twitter.com/kees_cook/status/27181373405">Vyakarana</a> as seen <a href="http://www.youtube.com/watch?v=CLxpae-M7Js">running in Enlightenment</a> using <code>cap_getcap</code> (which is pretty unstable, so you might want to switch it to use <code>ptrace_traceme</code>), and as a <a href="http://outflux.net/exploits/vyakarana.c">stand-alone memory writer</a>.</p>
<p>Conclusions: Keep auditing the kernel for more arbitrary writes; I think there are still many left. Reduce the exploitation surface within the kernel itself (which <a href="http://grsecurity.net/features.php">PaX and grsecurity</a> have been doing for a while now), specifically:</p>
<ul>
<li>Block userspace memory access while in kernel mode. This would stop the ability to make the kernel start executing functions that live in userspace â a clear privilege violation. This protection would stop the current exploit above, but the exploit could be adjusted to use kernel memory instead.</li>
<li>Keep function pointers read-only. There is no reason for these function pointer tables (<code>fops</code>, <code>IDT</code>, <code>security_ops</code>, etc) to be writable. These should all be marked correctly, with inline code exceptions being made for updating the global pointers to those tables, leaving the pointer read-only after it gets set. This would stop this particular exploit above, but there are still plenty more targets.</li>
<li>Randomize the kernel stack location on a per-syscall basis. This will stop exploits that depend on a stable kernel stack location (as this exploit does).</li>
</ul>
<p style="text-align:left">Â© 2010, <a href="https://outflux.net/blog/">Kees Cook</a>. This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 License</a>.<br><a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="CC BY-SA 4.0" style="border-width:0" src="./2010 - CVE-2010-2963 v4l compat exploit_files/88x31.png"></a> </p>
	</div>

	<div class="feedback">
				<a href="https://outflux.net/blog/archives/2010/10/19/cve-2010-2963-v4l-compat-exploit/#comments">Comments (10)</a>	</div>

</div>


<h2 id="comments">10 Comments</h2>

<ol id="commentlist">

	<li class="comment even thread-even depth-1" id="comment-1037">
	<img alt="" src="./2010 - CVE-2010-2963 v4l compat exploit_files/7b38f700e2103ebb94ddd3725c69016d.jpeg" srcset="https://secure.gravatar.com/avatar/7b38f700e2103ebb94ddd3725c69016d?s=64&amp;d=wavatar&amp;r=r 2x" class="avatar avatar-32 photo" height="32" width="32">	<p>Hi,</p>
<p>Iâve seen mention of this elsewhere.</p>
<p>It would be nice if you could elaborate on how, exactly, to fix these vulnerabilities.  I have a couple in mind which Iâm responsible for, but Iâm unsure exactly how to fix them â and be sure Iâve done it right.</p>
<p>The other mention I saw of this also failed to explain how to fix it, other than mentioning access_ok() should be used.  I could take a stab at it, but Iâd like to know I was doing it right.</p>
	<p><cite>Comment by SteveC â October 19, 2010 @ <a href="https://outflux.net/blog/archives/2010/10/19/cve-2010-2963-v4l-compat-exploit/#comment-1037">4:28 pm</a></cite> </p>
	</li>

	<li class="comment byuser comment-author-kees bypostauthor odd alt thread-odd thread-alt depth-1" id="comment-1039">
	<img alt="" src="./2010 - CVE-2010-2963 v4l compat exploit_files/7b6f70086cbcbddb1dca2ca162cb623a.png" srcset="https://secure.gravatar.com/avatar/7b6f70086cbcbddb1dca2ca162cb623a?s=64&amp;d=wavatar&amp;r=r 2x" class="avatar avatar-32 photo" height="32" width="32">	<p>In general, itâs best to just verify every single use of copy_to_user(), copy_from_user(), get_user(), and put_user(), etc (or any memory copying for that matter). Make sure you know where youâre reading and writing from, and how large those accesses are. (For example, are you sure a length canât be negative, or larger than youâre expecting?) Calling access_ok() is already done inside the copy_*_user() functions, so it usually isnât needed. Youâll note that in this particular case, it was the kernel destination that was unchecked. Everything was fine about the userspace reads â nothing was out of bounds. But nothing actually defined where or how large the kernel destination buffer was.</p>
	<p><cite>Comment by <a href="http://www.outflux.net/blog/" rel="external nofollow" class="url">kees</a> â October 19, 2010 @ <a href="https://outflux.net/blog/archives/2010/10/19/cve-2010-2963-v4l-compat-exploit/#comment-1039">4:38 pm</a></cite> </p>
	</li>

	<li class="comment even thread-even depth-1" id="comment-1042">
	<img alt="" src="./2010 - CVE-2010-2963 v4l compat exploit_files/ccd9a9e8456cbf0610cb217a43e1ed1e" srcset="https://secure.gravatar.com/avatar/ccd9a9e8456cbf0610cb217a43e1ed1e?s=64&amp;d=wavatar&amp;r=r 2x" class="avatar avatar-32 photo" height="32" width="32">	<p>Thanks for this detailed post!</p>
	<p><cite>Comment by JohnTaylor â October 19, 2010 @ <a href="https://outflux.net/blog/archives/2010/10/19/cve-2010-2963-v4l-compat-exploit/#comment-1042">11:49 pm</a></cite> </p>
	</li>

	<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1043">
	<img alt="" src="./2010 - CVE-2010-2963 v4l compat exploit_files/7b38f700e2103ebb94ddd3725c69016d.jpeg" srcset="https://secure.gravatar.com/avatar/7b38f700e2103ebb94ddd3725c69016d?s=64&amp;d=wavatar&amp;r=r 2x" class="avatar avatar-32 photo" height="32" width="32">	<p>Actually, it turns out I was thinking of a different issue now that Iâm looking at it again, CVS-2010-3081</p>
<p><a href="http://sota.gen.nz/compat1/" rel="nofollow">http://sota.gen.nz/compat1/</a></p>
<p>also related to the compat stuff, but to compat_alloc_user_space().</p>
	<p><cite>Comment by SteveC â October 20, 2010 @ <a href="https://outflux.net/blog/archives/2010/10/19/cve-2010-2963-v4l-compat-exploit/#comment-1043">5:14 am</a></cite> </p>
	</li>

	<li class="comment even thread-even depth-1" id="comment-1047">
	<img alt="" src="./2010 - CVE-2010-2963 v4l compat exploit_files/139362c4bf92ea747eb6e0a448bff8ac" srcset="https://secure.gravatar.com/avatar/139362c4bf92ea747eb6e0a448bff8ac?s=64&amp;d=wavatar&amp;r=r 2x" class="avatar avatar-32 photo" height="32" width="32">	<p>That should trigger a sparse warning shouldnât it?  If someone dereferences a __user pointer?</p>
<p>I donât have a 64 bit computer and so I donât compile that file.  But someone should have caught that.</p>
	<p><cite>Comment by Dan Carpenter â October 23, 2010 @ <a href="https://outflux.net/blog/archives/2010/10/19/cve-2010-2963-v4l-compat-exploit/#comment-1047">11:08 am</a></cite> </p>
	</li>

	<li class="comment byuser comment-author-kees bypostauthor odd alt thread-odd thread-alt depth-1" id="comment-1048">
	<img alt="" src="./2010 - CVE-2010-2963 v4l compat exploit_files/7b6f70086cbcbddb1dca2ca162cb623a.png" srcset="https://secure.gravatar.com/avatar/7b6f70086cbcbddb1dca2ca162cb623a?s=64&amp;d=wavatar&amp;r=r 2x" class="avatar avatar-32 photo" height="32" width="32">	<p>@Dan which part should have? Everything was syntactically correct except for the part where -&gt;data wasnât initialized.</p>
	<p><cite>Comment by <a href="http://www.outflux.net/blog/" rel="external nofollow" class="url">kees</a> â October 23, 2010 @ <a href="https://outflux.net/blog/archives/2010/10/19/cve-2010-2963-v4l-compat-exploit/#comment-1048">1:56 pm</a></cite> </p>
	</li>

	<li class="comment even thread-even depth-1" id="comment-1049">
	<img alt="" src="./2010 - CVE-2010-2963 v4l compat exploit_files/139362c4bf92ea747eb6e0a448bff8ac" srcset="https://secure.gravatar.com/avatar/139362c4bf92ea747eb6e0a448bff8ac?s=64&amp;d=wavatar&amp;r=r 2x" class="avatar avatar-32 photo" height="32" width="32">	<p>up is declared with the __user attribute.</p>
<p>So weâre not allowed to dereference it when we do the âup-&gt;datasizeâ.  Calling access_ok() doesnât mean we can dereference it, it just means that we use __get_user() instead of get_user().  User memory can be in a different address space or it can be swapped out.</p>
<p>Btw up-&gt;loadwhat is an array so that doesnât actually dereference âupâ.</p>
<p>Of course, the datasize isnât capped as well as you point out.  It seems like someone could write a Smatch script to detect these places automatically.  Stuff like:<br>
get_user(size, &amp;user_ptr);<br>
&lt;â no cap on size here.<br>
copy_from_user(dest, src, size);<br>
I'll poke at this on Monday.</p>
	<p><cite>Comment by Dan Carpenter â October 23, 2010 @ <a href="https://outflux.net/blog/archives/2010/10/19/cve-2010-2963-v4l-compat-exploit/#comment-1049">8:57 pm</a></cite> </p>
	</li>

	<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-1050">
	<img alt="" src="./2010 - CVE-2010-2963 v4l compat exploit_files/139362c4bf92ea747eb6e0a448bff8ac" srcset="https://secure.gravatar.com/avatar/139362c4bf92ea747eb6e0a448bff8ac?s=64&amp;d=wavatar&amp;r=r 2x" class="avatar avatar-32 photo" height="32" width="32">	<p>Actually, I just read more thouroughly and thatâs not what you were pointing out at all.  :P  Ha ha.  Itâs amazing this crap works at all.</p>
	<p><cite>Comment by Dan Carpenter â October 23, 2010 @ <a href="https://outflux.net/blog/archives/2010/10/19/cve-2010-2963-v4l-compat-exploit/#comment-1050">10:00 pm</a></cite> </p>
	</li>

	<li class="comment even thread-even depth-1" id="comment-1119">
	<img alt="" src="./2010 - CVE-2010-2963 v4l compat exploit_files/c15e88cb370e3acf3be902f01101c7cc.png" srcset="https://secure.gravatar.com/avatar/c15e88cb370e3acf3be902f01101c7cc?s=64&amp;d=wavatar&amp;r=r 2x" class="avatar avatar-32 photo" height="32" width="32">	<p>âNext, we just repeatedly call the setup ioctl in an attempt to get incidental kernel work out of the way so that our last ioctl doing the stack preparation will stick, and then we call the buggy ioctl to trigger the vulnerability.â</p>
<p>Can you give me an example when stack preparation will not stick?<br>
I wrote my own exploit for this vulnerability and I call only one time the setup ioctl and it always works..</p>
	<p><cite>Comment by madara â August 7, 2011 @ <a href="https://outflux.net/blog/archives/2010/10/19/cve-2010-2963-v4l-compat-exploit/#comment-1119">7:03 am</a></cite> </p>
	</li>

	<li class="comment byuser comment-author-kees bypostauthor odd alt thread-odd thread-alt depth-1" id="comment-1120">
	<img alt="" src="./2010 - CVE-2010-2963 v4l compat exploit_files/7b6f70086cbcbddb1dca2ca162cb623a.png" srcset="https://secure.gravatar.com/avatar/7b6f70086cbcbddb1dca2ca162cb623a?s=64&amp;d=wavatar&amp;r=r 2x" class="avatar avatar-32 photo" height="32" width="32">	<p>@madara I didnât try it with just 1 stack prep, but I figured a bunch wouldnât hurt. :)</p>
	<p><cite>Comment by <a href="http://www.outflux.net/blog/" rel="external nofollow" class="url">kees</a> â August 8, 2011 @ <a href="https://outflux.net/blog/archives/2010/10/19/cve-2010-2963-v4l-compat-exploit/#comment-1120">10:32 am</a></cite> </p>
	</li>


</ol>





<!-- begin footer -->
</div>

<!-- begin sidebar -->
<div id="menu">

<ul>
<li id="categories-2" class="widget widget_categories">Categories		<ul>
	<li class="cat-item cat-item-5"><a href="https://outflux.net/blog/archives/category/blogging/" title="Blogging, and the software needed to get it done.">Blogging</a> (149)
</li>
	<li class="cat-item cat-item-20"><a href="https://outflux.net/blog/archives/category/chromeos/" title="Chrome OS distribution of Linux">Chrome OS</a> (47)
</li>
	<li class="cat-item cat-item-18"><a href="https://outflux.net/blog/archives/category/debian/" title="Debian and SPI">Debian</a> (115)
</li>
	<li class="cat-item cat-item-3"><a href="https://outflux.net/blog/archives/category/embedded/" title="Deep internals, programming, and designing of various hardware devices.">Embedded</a> (8)
</li>
	<li class="cat-item cat-item-1"><a href="https://outflux.net/blog/archives/category/general/" title="I forgot to click a more specific topic.">General</a> (33)
</li>
	<li class="cat-item cat-item-8"><a href="https://outflux.net/blog/archives/category/health/" title="My health, other people&#39;s health, or health in general.">Health</a> (3)
</li>
	<li class="cat-item cat-item-2"><a href="https://outflux.net/blog/archives/category/inkscape/" title="Inkscape SVG editor software project.">Inkscape</a> (8)
</li>
	<li class="cat-item cat-item-21"><a href="https://outflux.net/blog/archives/category/kernel/">Kernel</a> (34)
</li>
	<li class="cat-item cat-item-11"><a href="https://outflux.net/blog/archives/category/kernelorg/" title="My work on the kernel.org servers.">kernel.org</a> (6)
</li>
	<li class="cat-item cat-item-4"><a href="https://outflux.net/blog/archives/category/multimedia/" title="Software/things involved in audio/visual display, recording, and/or editing.">Multimedia</a> (33)
</li>
	<li class="cat-item cat-item-7"><a href="https://outflux.net/blog/archives/category/networking/" title="Networking and computer intercommunication, including wireless.">Networking</a> (27)
</li>
	<li class="cat-item cat-item-10"><a href="https://outflux.net/blog/archives/category/reverse-engineering/" title="Trying to take something apart and see how it works, usually with improvements.">Reverse Engineering</a> (15)
</li>
	<li class="cat-item cat-item-6"><a href="https://outflux.net/blog/archives/category/security/" title="Security, penetration testing, and hardening.">Security</a> (127)
</li>
	<li class="cat-item cat-item-14"><a href="https://outflux.net/blog/archives/category/ubuntu/" title="Ubuntu and Canonical">Ubuntu</a> (177)
</li>
	<li class="cat-item cat-item-19"><a href="https://outflux.net/blog/archives/category/ubuntu-server/" title="Stuff happening with the Ubuntu Server Team.">Ubuntu-Server</a> (107)
</li>
	<li class="cat-item cat-item-9"><a href="https://outflux.net/blog/archives/category/vehicles/" title="Working on or drooling over various vehicles.">Vehicles</a> (2)
</li>
	<li class="cat-item cat-item-12"><a href="https://outflux.net/blog/archives/category/vulnerabilities/" title="Vulnerability discovery announcements.">Vulnerabilities</a> (12)
</li>
	<li class="cat-item cat-item-13"><a href="https://outflux.net/blog/archives/category/web/" title="Websites, protocols, languages, etc.">Web</a> (14)
</li>
		</ul>
</li><li id="search-3" class="widget widget_search"><form role="search" method="get" id="searchform" class="searchform" action="https://outflux.net/blog/">
				<div>
					<label class="screen-reader-text" for="s">Search for:</label>
					<input type="text" value="" name="s" id="s">
					<input type="submit" id="searchsubmit" value="Search">
				</div>
			</form></li><li id="linkcat-15" class="widget widget_links">Links
	<ul class="xoxo blogroll">
<li><a href="http://outflux.net/" rel="me" title="homepage">Outflux</a></li>

	</ul>
</li>
<li id="archives-3" class="widget widget_archive">Archives		<label class="screen-reader-text" for="archives-dropdown-3">Archives</label>
		<select id="archives-dropdown-3" name="archive-dropdown" onchange="document.location.href=this.options[this.selectedIndex].value;">
			
			<option value="">Select Month</option>
				<option value="https://outflux.net/blog/archives/2021/04/"> April 2021 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2021/02/"> February 2021 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2020/10/"> October 2020 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2020/09/"> September 2020 &nbsp;(2)</option>
	<option value="https://outflux.net/blog/archives/2020/05/"> May 2020 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2020/02/"> February 2020 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2019/11/"> November 2019 &nbsp;(2)</option>
	<option value="https://outflux.net/blog/archives/2019/07/"> July 2019 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2019/06/"> June 2019 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2019/05/"> May 2019 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2019/03/"> March 2019 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2018/12/"> December 2018 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2018/10/"> October 2018 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2018/08/"> August 2018 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2018/06/"> June 2018 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2018/04/"> April 2018 &nbsp;(2)</option>
	<option value="https://outflux.net/blog/archives/2018/02/"> February 2018 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2018/01/"> January 2018 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2017/11/"> November 2017 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2017/09/"> September 2017 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2017/08/"> August 2017 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2017/07/"> July 2017 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2017/05/"> May 2017 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2017/02/"> February 2017 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2016/12/"> December 2016 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2016/10/"> October 2016 &nbsp;(4)</option>
	<option value="https://outflux.net/blog/archives/2016/09/"> September 2016 &nbsp;(4)</option>
	<option value="https://outflux.net/blog/archives/2015/11/"> November 2015 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2015/07/"> July 2015 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2015/01/"> January 2015 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2014/12/"> December 2014 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2014/06/"> June 2014 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2014/05/"> May 2014 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2014/02/"> February 2014 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2014/01/"> January 2014 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2013/12/"> December 2013 &nbsp;(2)</option>
	<option value="https://outflux.net/blog/archives/2013/11/"> November 2013 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2013/08/"> August 2013 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2013/05/"> May 2013 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2013/01/"> January 2013 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2012/11/"> November 2012 &nbsp;(3)</option>
	<option value="https://outflux.net/blog/archives/2012/10/"> October 2012 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2012/05/"> May 2012 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2012/03/"> March 2012 &nbsp;(2)</option>
	<option value="https://outflux.net/blog/archives/2012/02/"> February 2012 &nbsp;(3)</option>
	<option value="https://outflux.net/blog/archives/2012/01/"> January 2012 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2011/12/"> December 2011 &nbsp;(5)</option>
	<option value="https://outflux.net/blog/archives/2011/11/"> November 2011 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2011/09/"> September 2011 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2011/07/"> July 2011 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2011/04/"> April 2011 &nbsp;(2)</option>
	<option value="https://outflux.net/blog/archives/2011/02/"> February 2011 &nbsp;(3)</option>
	<option value="https://outflux.net/blog/archives/2010/12/"> December 2010 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2010/11/"> November 2010 &nbsp;(2)</option>
	<option value="https://outflux.net/blog/archives/2010/10/"> October 2010 &nbsp;(3)</option>
	<option value="https://outflux.net/blog/archives/2010/09/"> September 2010 &nbsp;(3)</option>
	<option value="https://outflux.net/blog/archives/2010/08/"> August 2010 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2010/07/"> July 2010 &nbsp;(3)</option>
	<option value="https://outflux.net/blog/archives/2010/06/"> June 2010 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2010/05/"> May 2010 &nbsp;(4)</option>
	<option value="https://outflux.net/blog/archives/2010/04/"> April 2010 &nbsp;(2)</option>
	<option value="https://outflux.net/blog/archives/2010/03/"> March 2010 &nbsp;(3)</option>
	<option value="https://outflux.net/blog/archives/2010/02/"> February 2010 &nbsp;(5)</option>
	<option value="https://outflux.net/blog/archives/2010/01/"> January 2010 &nbsp;(2)</option>
	<option value="https://outflux.net/blog/archives/2009/12/"> December 2009 &nbsp;(3)</option>
	<option value="https://outflux.net/blog/archives/2009/11/"> November 2009 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2009/10/"> October 2009 &nbsp;(3)</option>
	<option value="https://outflux.net/blog/archives/2009/09/"> September 2009 &nbsp;(2)</option>
	<option value="https://outflux.net/blog/archives/2009/07/"> July 2009 &nbsp;(2)</option>
	<option value="https://outflux.net/blog/archives/2009/05/"> May 2009 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2009/04/"> April 2009 &nbsp;(3)</option>
	<option value="https://outflux.net/blog/archives/2009/02/"> February 2009 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2009/01/"> January 2009 &nbsp;(3)</option>
	<option value="https://outflux.net/blog/archives/2008/12/"> December 2008 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2008/11/"> November 2008 &nbsp;(6)</option>
	<option value="https://outflux.net/blog/archives/2008/10/"> October 2008 &nbsp;(5)</option>
	<option value="https://outflux.net/blog/archives/2008/09/"> September 2008 &nbsp;(4)</option>
	<option value="https://outflux.net/blog/archives/2008/08/"> August 2008 &nbsp;(3)</option>
	<option value="https://outflux.net/blog/archives/2008/07/"> July 2008 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2008/06/"> June 2008 &nbsp;(4)</option>
	<option value="https://outflux.net/blog/archives/2008/04/"> April 2008 &nbsp;(2)</option>
	<option value="https://outflux.net/blog/archives/2008/03/"> March 2008 &nbsp;(4)</option>
	<option value="https://outflux.net/blog/archives/2008/02/"> February 2008 &nbsp;(3)</option>
	<option value="https://outflux.net/blog/archives/2008/01/"> January 2008 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2007/12/"> December 2007 &nbsp;(4)</option>
	<option value="https://outflux.net/blog/archives/2007/09/"> September 2007 &nbsp;(5)</option>
	<option value="https://outflux.net/blog/archives/2007/08/"> August 2007 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2007/04/"> April 2007 &nbsp;(2)</option>
	<option value="https://outflux.net/blog/archives/2007/03/"> March 2007 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2007/02/"> February 2007 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2007/01/"> January 2007 &nbsp;(2)</option>
	<option value="https://outflux.net/blog/archives/2006/12/"> December 2006 &nbsp;(6)</option>
	<option value="https://outflux.net/blog/archives/2006/10/"> October 2006 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2006/09/"> September 2006 &nbsp;(2)</option>
	<option value="https://outflux.net/blog/archives/2006/08/"> August 2006 &nbsp;(3)</option>
	<option value="https://outflux.net/blog/archives/2006/07/"> July 2006 &nbsp;(5)</option>
	<option value="https://outflux.net/blog/archives/2006/06/"> June 2006 &nbsp;(1)</option>
	<option value="https://outflux.net/blog/archives/2006/05/"> May 2006 &nbsp;(8)</option>
	<option value="https://outflux.net/blog/archives/2006/04/"> April 2006 &nbsp;(9)</option>
	<option value="https://outflux.net/blog/archives/2006/03/"> March 2006 &nbsp;(4)</option>
	<option value="https://outflux.net/blog/archives/2006/01/"> January 2006 &nbsp;(6)</option>
	<option value="https://outflux.net/blog/archives/2005/12/"> December 2005 &nbsp;(4)</option>
	<option value="https://outflux.net/blog/archives/2005/10/"> October 2005 &nbsp;(9)</option>
	<option value="https://outflux.net/blog/archives/2005/09/"> September 2005 &nbsp;(8)</option>
	<option value="https://outflux.net/blog/archives/2005/08/"> August 2005 &nbsp;(12)</option>
	<option value="https://outflux.net/blog/archives/2005/07/"> July 2005 &nbsp;(3)</option>
	<option value="https://outflux.net/blog/archives/2005/06/"> June 2005 &nbsp;(6)</option>
	<option value="https://outflux.net/blog/archives/2005/05/"> May 2005 &nbsp;(6)</option>
	<option value="https://outflux.net/blog/archives/2005/04/"> April 2005 &nbsp;(4)</option>
	<option value="https://outflux.net/blog/archives/2005/03/"> March 2005 &nbsp;(2)</option>
	<option value="https://outflux.net/blog/archives/2005/02/"> February 2005 &nbsp;(3)</option>
	<option value="https://outflux.net/blog/archives/2005/01/"> January 2005 &nbsp;(11)</option>

		</select>
		</li><li id="meta-3" class="widget widget_meta">Meta			<ul>
						<li><a href="https://outflux.net/blog/wp-login.php">Log in</a></li>
			<li><a href="https://outflux.net/blog/feed/">Entries <abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="https://outflux.net/blog/comments/feed/">Comments <abbr title="Really Simple Syndication">RSS</abbr></a></li>
			<li><a href="https://wordpress.org/" title="Powered by WordPress, state-of-the-art semantic personal publishing platform.">WordPress.org</a></li>			</ul>
			</li>
</ul>

</div>
<!-- end sidebar -->

<p class="credit"><!--27 queries. 0.142 seconds. --> <cite>Powered by <a href="http://wordpress.org/" title="Powered by WordPress, state-of-the-art semantic personal publishing platform."><strong>WordPress</strong></a></cite></p>

</div>

<script type="text/javascript" src="./2010 - CVE-2010-2963 v4l compat exploit_files/jquery.form.min.js.ä¸è¼"></script>
<script type="text/javascript">
/* <![CDATA[ */
var _wpcf7 = {"loaderUrl":"https:\/\/outflux.net\/blog\/wp-content\/plugins\/contact-form-7\/images\/ajax-loader.gif","sending":"Sending ..."};
/* ]]> */
</script>
<script type="text/javascript" src="./2010 - CVE-2010-2963 v4l compat exploit_files/scripts.js.ä¸è¼"></script>
<script type="text/javascript" src="./2010 - CVE-2010-2963 v4l compat exploit_files/wp-embed.min.js.ä¸è¼"></script>

</body></html>