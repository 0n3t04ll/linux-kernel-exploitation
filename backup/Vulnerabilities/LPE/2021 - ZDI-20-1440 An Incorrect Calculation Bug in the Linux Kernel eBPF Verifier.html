<!DOCTYPE html>
<!-- saved from url=(0123)https://www.zerodayinitiative.com/blog/2021/1/18/zdi-20-1440-an-incorrect-calculation-bug-in-the-linux-kernel-ebpf-verifier -->
<html xmlns:og="http://opengraphprotocol.org/schema/" xmlns:fb="http://www.facebook.com/2008/fbml" lang="en-US" class="yui3-js-enabled js flexbox canvas canvastext webgl no-touch hashchange history draganddrop rgba hsla multiplebgs backgroundsize borderimage borderradius boxshadow textshadow opacity cssanimations csscolumns cssgradients cssreflections csstransforms no-csstransforms3d csstransitions video audio svg inlinesvg svgclippaths" style=""><div id="yui3-css-stamp" style="position: absolute !important; visibility: hidden !important"></div><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

    
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <meta name="viewport" content="width=device-width,initial-scale=1">
    

    <link href="./2021 - ZDI-20-1440 An Incorrect Calculation Bug in the Linux Kernel eBPF Verifier_files/css" rel="stylesheet"> 
    <link href="./2021 - ZDI-20-1440 An Incorrect Calculation Bug in the Linux Kernel eBPF Verifier_files/icon" rel="stylesheet">

    <!--INCLUDE SQS SCRIPTS, META TAGS AND USER CONTENT FROM THE CODE INJECTION TAB-->

    <!-- This is Squarespace. --><!-- brian-gorenc -->
<link charset="utf-8" rel="stylesheet" id="yui_3_17_2_1_1638470369736_101" href="./2021 - ZDI-20-1440 An Incorrect Calculation Bug in the Linux Kernel eBPF Verifier_files/simple-liking-47606e375db2b296c3464-min.en-US.css"><script charset="utf-8" id="yui_3_17_2_1_1638470369736_100" src="./2021 - ZDI-20-1440 An Incorrect Calculation Bug in the Linux Kernel eBPF Verifier_files/simple-liking-84b2629024662e9fb2c97-min.en-US.js.下載"></script><link charset="utf-8" rel="stylesheet" id="yui_3_17_2_1_1638470369736_105" href="./2021 - ZDI-20-1440 An Incorrect Calculation Bug in the Linux Kernel eBPF Verifier_files/social-buttons-b186d09e02921fd7f8e00-min.en-US.css"><script charset="utf-8" id="yui_3_17_2_1_1638470369736_104" src="./2021 - ZDI-20-1440 An Incorrect Calculation Bug in the Linux Kernel eBPF Verifier_files/social-buttons-b1c03a6501dfedc48861a-min.en-US.js.下載"></script><!--<base href="">--><base href=".">

<title>Zero Day Initiative — ZDI-20-1440: An Incorrect Calculation Bug in the Linux Kernel eBPF Verifier</title>
<link rel="shortcut icon" type="image/x-icon" href="https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1487670157237-HOXHMI54TA0SZP21OY7C/favicon.ico">
<link rel="canonical" href="https://www.thezdi.com/blog/2021/1/18/zdi-20-1440-an-incorrect-calculation-bug-in-the-linux-kernel-ebpf-verifier">
<meta property="og:site_name" content="Zero Day Initiative">
<meta property="og:title" content="Zero Day Initiative — ZDI-20-1440: An Incorrect Calculation Bug in the Linux Kernel eBPF Verifier">
<meta property="og:latitude" content="40.7207559">
<meta property="og:longitude" content="-74.0007613">
<meta property="og:locality" content="">
<meta property="og:url" content="https://www.thezdi.com/blog/2021/1/18/zdi-20-1440-an-incorrect-calculation-bug-in-the-linux-kernel-ebpf-verifier">
<meta property="og:type" content="article">
<meta property="og:description" content="In April 2020, the ZDI received a Linux kernel submission that turned out to be an incorrect calculation bug in the extended Berkeley Packet Filter (eBPF) verifier. If you’re not familiar with it, eBPF is a Linux subsystem that is designed to safely execute untrusted, user-defined extensions inside ">
<meta property="og:image" content="http://static1.squarespace.com/static/5894c269e4fcb5e65a1ed623/58a5b38cb3db2bd67b608658/6005f43e3d757a3dbd41b2f2/1611076428376/architecture-structure-interior-building-urban-construction-1062015-pxhere.com.jpg?format=1500w">
<meta property="og:image:width" content="1280">
<meta property="og:image:height" content="853">
<meta itemprop="name" content="Zero Day Initiative — ZDI-20-1440: An Incorrect Calculation Bug in the Linux Kernel eBPF Verifier">
<meta itemprop="url" content="https://www.thezdi.com/blog/2021/1/18/zdi-20-1440-an-incorrect-calculation-bug-in-the-linux-kernel-ebpf-verifier">
<meta itemprop="description" content="In April 2020, the ZDI received a Linux kernel submission that turned out to be an incorrect calculation bug in the extended Berkeley Packet Filter (eBPF) verifier. If you’re not familiar with it, eBPF is a Linux subsystem that is designed to safely execute untrusted, user-defined extensions inside ">
<meta itemprop="thumbnailUrl" content="http://static1.squarespace.com/static/5894c269e4fcb5e65a1ed623/58a5b38cb3db2bd67b608658/6005f43e3d757a3dbd41b2f2/1611076428376/architecture-structure-interior-building-urban-construction-1062015-pxhere.com.jpg?format=1500w">
<link rel="image_src" href="http://static1.squarespace.com/static/5894c269e4fcb5e65a1ed623/58a5b38cb3db2bd67b608658/6005f43e3d757a3dbd41b2f2/1611076428376/architecture-structure-interior-building-urban-construction-1062015-pxhere.com.jpg?format=1500w">
<meta itemprop="image" content="http://static1.squarespace.com/static/5894c269e4fcb5e65a1ed623/58a5b38cb3db2bd67b608658/6005f43e3d757a3dbd41b2f2/1611076428376/architecture-structure-interior-building-urban-construction-1062015-pxhere.com.jpg?format=1500w">
<meta itemprop="author" content="Lucas Leong">
<meta itemprop="datePublished" content="2021-01-19T11:13:48-0600">
<meta itemprop="dateModified" content="2021-01-19T11:13:48-0600">
<meta itemprop="headline" content="ZDI-20-1440: An Incorrect Calculation Bug in the Linux Kernel eBPF Verifier">
<meta itemprop="publisher" content="Zero Day Initiative">
<meta name="twitter:title" content="Zero Day Initiative — ZDI-20-1440: An Incorrect Calculation Bug in the Linux Kernel eBPF Verifier">
<meta name="twitter:image" content="http://static1.squarespace.com/static/5894c269e4fcb5e65a1ed623/58a5b38cb3db2bd67b608658/6005f43e3d757a3dbd41b2f2/1611076428376/architecture-structure-interior-building-urban-construction-1062015-pxhere.com.jpg?format=1500w">
<meta name="twitter:url" content="https://www.thezdi.com/blog/2021/1/18/zdi-20-1440-an-incorrect-calculation-bug-in-the-linux-kernel-ebpf-verifier">
<meta name="twitter:card" content="summary">
<meta name="twitter:description" content="In April 2020, the ZDI received a Linux kernel submission that turned out to be an incorrect calculation bug in the extended Berkeley Packet Filter (eBPF) verifier. If you’re not familiar with it, eBPF is a Linux subsystem that is designed to safely execute untrusted, user-defined extensions inside ">
<meta name="description" content="">
<link rel="preconnect" href="https://images.squarespace-cdn.com/">
<link rel="stylesheet" type="text/css" href="./2021 - ZDI-20-1440 An Incorrect Calculation Bug in the Linux Kernel eBPF Verifier_files/css2">
<script async="" src="./2021 - ZDI-20-1440 An Incorrect Calculation Bug in the Linux Kernel eBPF Verifier_files/analytics.js.下載"></script><script type="text/javascript" crossorigin="anonymous" nomodule="nomodule" src="./2021 - ZDI-20-1440 An Incorrect Calculation Bug in the Linux Kernel eBPF Verifier_files/legacy.js.下載"></script>
<script type="text/javascript" crossorigin="anonymous" src="./2021 - ZDI-20-1440 An Incorrect Calculation Bug in the Linux Kernel eBPF Verifier_files/modern.js.下載"></script>
<script type="text/javascript">SQUARESPACE_ROLLUPS = {};</script>
<script>(function(rollups, name) { if (!rollups[name]) { rollups[name] = {}; } rollups[name].js = ["//assets.squarespace.com/universal/scripts-compressed/moment-js-vendor-26ddeab7fa5f90b6c8cb3-min.en-US.js"]; })(SQUARESPACE_ROLLUPS, 'squarespace-moment_js_vendor');</script>
<script crossorigin="anonymous" src="./2021 - ZDI-20-1440 An Incorrect Calculation Bug in the Linux Kernel eBPF Verifier_files/moment-js-vendor-26ddeab7fa5f90b6c8cb3-min.en-US.js.下載"></script><script>(function(rollups, name) { if (!rollups[name]) { rollups[name] = {}; } rollups[name].js = ["//assets.squarespace.com/universal/scripts-compressed/cldr-resource-pack-be81d1ce004cbca505842-min.en-US.js"]; })(SQUARESPACE_ROLLUPS, 'squarespace-cldr_resource_pack');</script>
<script crossorigin="anonymous" src="./2021 - ZDI-20-1440 An Incorrect Calculation Bug in the Linux Kernel eBPF Verifier_files/cldr-resource-pack-be81d1ce004cbca505842-min.en-US.js.下載"></script><script>(function(rollups, name) { if (!rollups[name]) { rollups[name] = {}; } rollups[name].js = ["//assets.squarespace.com/universal/scripts-compressed/common-vendors-stable-5f58a0e5b599c258afba7-min.en-US.js"]; })(SQUARESPACE_ROLLUPS, 'squarespace-common_vendors_stable');</script>
<script crossorigin="anonymous" src="./2021 - ZDI-20-1440 An Incorrect Calculation Bug in the Linux Kernel eBPF Verifier_files/common-vendors-stable-5f58a0e5b599c258afba7-min.en-US.js.下載"></script><script>(function(rollups, name) { if (!rollups[name]) { rollups[name] = {}; } rollups[name].js = ["//assets.squarespace.com/universal/scripts-compressed/common-vendors-2b8d103c58c279879debb-min.en-US.js"]; })(SQUARESPACE_ROLLUPS, 'squarespace-common_vendors');</script>
<script crossorigin="anonymous" src="./2021 - ZDI-20-1440 An Incorrect Calculation Bug in the Linux Kernel eBPF Verifier_files/common-vendors-2b8d103c58c279879debb-min.en-US.js.下載"></script><script>(function(rollups, name) { if (!rollups[name]) { rollups[name] = {}; } rollups[name].js = ["//assets.squarespace.com/universal/scripts-compressed/common-4e8968d09e387393951e6-min.en-US.js"]; })(SQUARESPACE_ROLLUPS, 'squarespace-common');</script>
<script crossorigin="anonymous" src="./2021 - ZDI-20-1440 An Incorrect Calculation Bug in the Linux Kernel eBPF Verifier_files/common-4e8968d09e387393951e6-min.en-US.js.下載"></script><script>(function(rollups, name) { if (!rollups[name]) { rollups[name] = {}; } rollups[name].js = ["//assets.squarespace.com/universal/scripts-compressed/performance-bc3576cf7eca79df62e49-min.en-US.js"]; })(SQUARESPACE_ROLLUPS, 'squarespace-performance');</script>
<script crossorigin="anonymous" src="./2021 - ZDI-20-1440 An Incorrect Calculation Bug in the Linux Kernel eBPF Verifier_files/performance-bc3576cf7eca79df62e49-min.en-US.js.下載" defer=""></script><script data-name="static-context">Static = window.Static || {}; Static.SQUARESPACE_CONTEXT = {"facebookAppId":"314192535267336","facebookApiVersion":"v6.0","rollups":{"squarespace-announcement-bar":{"js":"//assets.squarespace.com/universal/scripts-compressed/announcement-bar-2f7261bafe0cccffc79c1-min.en-US.js"},"squarespace-audio-player":{"css":"//assets.squarespace.com/universal/styles-compressed/audio-player-7273d8fcec67906942b35-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/audio-player-bf3733dc1a7a1a312f00b-min.en-US.js"},"squarespace-blog-collection-list":{"css":"//assets.squarespace.com/universal/styles-compressed/blog-collection-list-3d55c64c25996c7633fc2-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/blog-collection-list-41fb020c05858537c749a-min.en-US.js"},"squarespace-calendar-block-renderer":{"css":"//assets.squarespace.com/universal/styles-compressed/calendar-block-renderer-5668de53c0ce16e20cc01-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/calendar-block-renderer-8e106d6ff1e1b025652e1-min.en-US.js"},"squarespace-chartjs-helpers":{"css":"//assets.squarespace.com/universal/styles-compressed/chartjs-helpers-58ae73137091cd0a61360-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/chartjs-helpers-f7fcba491a8523ac88fff-min.en-US.js"},"squarespace-comments":{"css":"//assets.squarespace.com/universal/styles-compressed/comments-eeb99f32a31032af774cb-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/comments-6f87194ca559fd42b7649-min.en-US.js"},"squarespace-commerce-cart":{"js":"//assets.squarespace.com/universal/scripts-compressed/commerce-cart-1bf72f78bcd6ff67a17f4-min.en-US.js"},"squarespace-dialog":{"css":"//assets.squarespace.com/universal/styles-compressed/dialog-7b3fdec47b80fd63e5e6f-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/dialog-cbcfce3803b0c7c3a195c-min.en-US.js"},"squarespace-events-collection":{"css":"//assets.squarespace.com/universal/styles-compressed/events-collection-5668de53c0ce16e20cc01-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/events-collection-32833edadee64550abcb4-min.en-US.js"},"squarespace-form-rendering-utils":{"js":"//assets.squarespace.com/universal/scripts-compressed/form-rendering-utils-bb354724a3757df74ec71-min.en-US.js"},"squarespace-forms":{"css":"//assets.squarespace.com/universal/styles-compressed/forms-1cc007b21ede0b73086c9-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/forms-40e56e15ffcec85859b95-min.en-US.js"},"squarespace-gallery-collection-list":{"css":"//assets.squarespace.com/universal/styles-compressed/gallery-collection-list-3d55c64c25996c7633fc2-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/gallery-collection-list-cd5d8e548068a3a2586f7-min.en-US.js"},"squarespace-image-zoom":{"css":"//assets.squarespace.com/universal/styles-compressed/image-zoom-60e14b9bac69739c96fa7-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/image-zoom-fa19933bfc5ac12f6e17f-min.en-US.js"},"squarespace-pinterest":{"css":"//assets.squarespace.com/universal/styles-compressed/pinterest-3d55c64c25996c7633fc2-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/pinterest-94a487a04e13fea79ec08-min.en-US.js"},"squarespace-popup-overlay":{"css":"//assets.squarespace.com/universal/styles-compressed/popup-overlay-e4ea05bd2ae9c1568e432-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/popup-overlay-b061b4158487e7ae7e527-min.en-US.js"},"squarespace-product-quick-view":{"css":"//assets.squarespace.com/universal/styles-compressed/product-quick-view-663fb8b8c08febe7303f1-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/product-quick-view-d8b0257186afe8865af43-min.en-US.js"},"squarespace-products-collection-item-v2":{"css":"//assets.squarespace.com/universal/styles-compressed/products-collection-item-v2-60e14b9bac69739c96fa7-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/products-collection-item-v2-dbbb091f4df62f531003e-min.en-US.js"},"squarespace-products-collection-list-v2":{"css":"//assets.squarespace.com/universal/styles-compressed/products-collection-list-v2-60e14b9bac69739c96fa7-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/products-collection-list-v2-49760745a9d44239d49d0-min.en-US.js"},"squarespace-search-page":{"css":"//assets.squarespace.com/universal/styles-compressed/search-page-568ad8f2a40e76c0175c8-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/search-page-c5f76c478bd25aaf2e466-min.en-US.js"},"squarespace-search-preview":{"js":"//assets.squarespace.com/universal/scripts-compressed/search-preview-6766a2def97ff8ef1ecfb-min.en-US.js"},"squarespace-share-buttons":{"js":"//assets.squarespace.com/universal/scripts-compressed/share-buttons-b677b0661ada7b7447f04-min.en-US.js"},"squarespace-simple-liking":{"css":"//assets.squarespace.com/universal/styles-compressed/simple-liking-47606e375db2b296c3464-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/simple-liking-84b2629024662e9fb2c97-min.en-US.js"},"squarespace-social-buttons":{"css":"//assets.squarespace.com/universal/styles-compressed/social-buttons-b186d09e02921fd7f8e00-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/social-buttons-b1c03a6501dfedc48861a-min.en-US.js"},"squarespace-tourdates":{"css":"//assets.squarespace.com/universal/styles-compressed/tourdates-3d55c64c25996c7633fc2-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/tourdates-63b620d61e3da5004abf0-min.en-US.js"},"squarespace-website-overlays-manager":{"css":"//assets.squarespace.com/universal/styles-compressed/website-overlays-manager-5c2f030f6ee94f066dc3d-min.en-US.css","js":"//assets.squarespace.com/universal/scripts-compressed/website-overlays-manager-c7281d57b648e036b6739-min.en-US.js"}},"pageType":50,"website":{"id":"5894c269e4fcb5e65a1ed623","identifier":"brian-gorenc","websiteType":1,"contentModifiedOn":1635895979747,"cloneable":false,"hasBeenCloneable":false,"developerMode":true,"siteStatus":{},"language":"en-US","timeZone":"America/Chicago","machineTimeZoneOffset":-21600000,"timeZoneOffset":-21600000,"timeZoneAbbr":"CST","siteTitle":"Zero Day Initiative","fullSiteTitle":"Zero Day Initiative \u2014 ZDI-20-1440: An Incorrect Calculation Bug in the Linux Kernel eBPF Verifier","siteDescription":"","shareButtonOptions":{"2":true,"1":true,"6":true,"4":true,"3":true},"authenticUrl":"https://www.thezdi.com","internalUrl":"https://brian-gorenc.squarespace.com","baseUrl":"https://www.thezdi.com","primaryDomain":"www.thezdi.com","sslSetting":3,"socialAccounts":[{"serviceId":4,"userId":"86973588","userName":"thezdi","screenname":"Zero Day Initiative","addedOn":1492718968086,"profileUrl":"https://twitter.com/thezdi","iconUrl":"http://pbs.twimg.com/profile_images/626740860508442632/dC1lsJPl_normal.png","collectionId":"58f91578e58c6231c1daf261","iconEnabled":true,"serviceName":"twitter"},{"serviceId":11,"userId":"UChbH7B5YhXANmlMYJRHpw0g","screenname":"TippingPoint Zero Day Initiative","addedOn":1492722141068,"profileUrl":"https://www.youtube.com/channel/UChbH7B5YhXANmlMYJRHpw0g","iconUrl":"https://yt3.ggpht.com/-5tyoeQlg_Jk/AAAAAAAAAAI/AAAAAAAAAAA/lrjg7w8bQgA/s88-c-k-no-mo-rj-c0xffffff/photo.jpg","iconEnabled":true,"serviceName":"youtube"}],"typekitId":"","statsMigrated":false,"imageMetadataProcessingEnabled":false,"screenshotId":"a0a901f81f08cc6c7c9e5108d43c513fa4847e74de2b39c335909e3f8dd88d34","showOwnerLogin":false},"websiteSettings":{"id":"5894c269e4fcb5e65a1ed625","websiteId":"5894c269e4fcb5e65a1ed623","subjects":[],"country":"US","state":"TX","simpleLikingEnabled":true,"mobileInfoBarSettings":{"isContactEmailEnabled":false,"isContactPhoneNumberEnabled":false,"isLocationEnabled":false,"isBusinessHoursEnabled":false},"commentLikesAllowed":true,"commentAnonAllowed":true,"commentThreaded":true,"commentApprovalRequired":false,"commentAvatarsOn":true,"commentSortType":2,"commentFlagThreshold":0,"commentFlagsAllowed":true,"commentEnableByDefault":true,"commentDisableAfterDaysDefault":0,"disqusShortname":"","commentsEnabled":false,"contactPhoneNumber":"","storeSettings":{"returnPolicy":null,"termsOfService":null,"privacyPolicy":null,"expressCheckout":false,"continueShoppingLinkUrl":"/","useLightCart":false,"showNoteField":false,"shippingCountryDefaultValue":"US","billToShippingDefaultValue":false,"showShippingPhoneNumber":true,"isShippingPhoneRequired":false,"showBillingPhoneNumber":true,"isBillingPhoneRequired":false,"currenciesSupported":["CHF","HKD","MXN","EUR","DKK","USD","CAD","MYR","NOK","THB","AUD","SGD","ILS","PLN","GBP","CZK","SEK","NZD","PHP","RUB"],"defaultCurrency":"USD","selectedCurrency":"USD","measurementStandard":1,"showCustomCheckoutForm":false,"checkoutPageMarketingOptInEnabled":false,"enableMailingListOptInByDefault":false,"sameAsRetailLocation":false,"merchandisingSettings":{"scarcityEnabledOnProductItems":false,"scarcityEnabledOnProductBlocks":false,"scarcityMessageType":"DEFAULT_SCARCITY_MESSAGE","scarcityThreshold":10,"multipleQuantityAllowedForServices":true,"restockNotificationsEnabled":false,"restockNotificationsMailingListSignUpEnabled":false,"relatedProductsEnabled":false,"relatedProductsOrdering":"random","soldOutVariantsDropdownDisabled":false,"productComposerOptedIn":false,"productComposerABTestOptedOut":false,"productReviewsEnabled":false},"isLive":false,"multipleQuantityAllowedForServices":true},"useEscapeKeyToLogin":true,"ssBadgeType":1,"ssBadgePosition":4,"ssBadgeVisibility":1,"ssBadgeDevices":1,"pinterestOverlayOptions":{"mode":"disabled"},"ampEnabled":false},"cookieSettings":{"isCookieBannerEnabled":false,"isRestrictiveCookiePolicyEnabled":false,"isRestrictiveCookiePolicyAbsolute":false,"cookieBannerText":"","cookieBannerTheme":"","cookieBannerVariant":"","cookieBannerPosition":"","cookieBannerCtaVariant":"","cookieBannerCtaText":"","cookieBannerAcceptType":"OPT_IN","cookieBannerOptOutCtaText":""},"websiteCloneable":false,"collection":{"title":"Blog","id":"58a5b38cb3db2bd67b608658","fullUrl":"/blog","type":1,"permissionType":1},"item":{"title":"ZDI-20-1440: An Incorrect Calculation Bug in the Linux Kernel eBPF Verifier","id":"6005f43e3d757a3dbd41b2f2","fullUrl":"/blog/2021/1/18/zdi-20-1440-an-incorrect-calculation-bug-in-the-linux-kernel-ebpf-verifier","publicCommentCount":0,"commentState":2,"recordType":1},"subscribed":false,"appDomain":"squarespace.com","templateTweakable":false,"tweakJSON":{"aspect-ratio":"Auto","gallery-arrow-style":"No Background","gallery-aspect-ratio":"3:2 Standard","gallery-auto-crop":"true","gallery-autoplay":"false","gallery-design":"Slideshow","gallery-info-overlay":"Show on Hover","gallery-loop":"false","gallery-navigation":"Bullets","gallery-show-arrows":"true","gallery-transitions":"Fade","galleryArrowBackground":"rgba(34,34,34,1)","galleryArrowColor":"rgba(255,255,255,1)","galleryAutoplaySpeed":"3","galleryCircleColor":"rgba(255,255,255,1)","galleryInfoBackground":"rgba(0, 0, 0, .7)","galleryThumbnailSize":"100px","gridSize":"350px","gridSpacing":"20px","product-gallery-auto-crop":"true","product-image-auto-crop":"true","tweak-v1-related-products-title-spacing":"50px"},"templateId":"58a5cc48579fb3f464465a0c","templateVersion":"7","pageFeatures":[1,2,4],"gmRenderKey":"QUl6YVN5Q0JUUk9xNkx1dkZfSUUxcjQ2LVQ0QWVUU1YtMGQ3bXk4","templateScriptsRootUrl":"https://static1.squarespace.com/static/ta/5894c269e4fcb5e65a1ed623/26/scripts/","betaFeatureFlags":["member_areas_annual_subscriptions","commerce_product_review_etsy_import","commerce_site_visitor_metrics","commerce_afterpay_pdp","startup_checklist","campaigns_blog_product_image_editor","member_areas_schedule_interview","campaigns_audience_card","transactional_email_pipeline_v2_enabled","campaigns_show_apply_website_styles_button","member_areas_billing_state_migration","category-delete-product-service-enabled","uas_swagger_site_user_account_client","campaigns_thumbnail_layout","uas_swagger_unauthenticated_session_client","campaigns_section_reorder_arrows","commerce_etsy_product_import","commerce_etsy_shipping_import","campaigns_banner_reduce_size","commerce_onboarding_tools_screen_test","commerce_restock_notifications","commerce_product_review_import_ga","commerce_activation_experiment_add_payment_processor_card","campaigns_new_subscriber_search","uas_swagger_token_client","commerce_product_composer_ab_test_all_users","commerce_pdp_survey_modal","uas_swagger_session_client","commerce_checkout_marketing_opt_in","commerce_instagram_product_checkout_links","campaigns_hide_deleted_automations_panel","commerce_native_product_reviews","commerce_category_id_discounts_enabled","commerce_multiple_product_reviews","commerce_pdp_layouts","product_composer_feedback_form_on_save","reduce_general_search_api_traffic","nested_categories_migration_enabled","tock_block","commerce_product_branching","customer_account_creation_recaptcha","background_art_onboarding","campaigns_global_uc_ab","viewer-role-contributor-invites"],"impersonatedSession":false,"tzData":{"zones":[[-360,"US","C%sT",null]],"rules":{"US":[[1967,2006,null,"Oct","lastSun","2:00","0","S"],[1987,2006,null,"Apr","Sun>=1","2:00","1:00","D"],[2007,"max",null,"Mar","Sun>=8","2:00","1:00","D"],[2007,"max",null,"Nov","Sun>=1","2:00","0","S"]]}},"showAnnouncementBar":false};</script><script type="text/javascript"> SquarespaceFonts.loadViaContext(); Squarespace.load(window);</script><link rel="alternate" type="application/rss+xml" title="RSS Feed" href="https://www.thezdi.com/blog?format=rss">
<script type="application/ld+json">{"url":"https://www.thezdi.com","name":"Zero Day Initiative","description":"","@context":"http://schema.org","@type":"WebSite"}</script><script type="application/ld+json">{"name":"Zero Day Initiative \u2014 ZDI-20-1440: An Incorrect Calculation Bug in the Linux Kernel eBPF Verifier","url":"https://www.thezdi.com/blog/2021/1/18/zdi-20-1440-an-incorrect-calculation-bug-in-the-linux-kernel-ebpf-verifier","datePublished":"2021-01-19T11:13:48-0600","dateModified":"2021-01-19T11:13:48-0600","headline":"ZDI-20-1440: An Incorrect Calculation Bug in the Linux Kernel eBPF Verifier","author":"Lucas Leong","publisher":{"name":"Zero Day Initiative","logo":{"@type":"ImageObject"},"@context":"http://schema.org","@type":"Organization"},"image":"http://static1.squarespace.com/static/5894c269e4fcb5e65a1ed623/58a5b38cb3db2bd67b608658/6005f43e3d757a3dbd41b2f2/1611076428376/architecture-structure-interior-building-urban-construction-1062015-pxhere.com.jpg?format=1500w","@context":"http://schema.org","@type":"Article"}</script><link rel="stylesheet" type="text/css" href="./2021 - ZDI-20-1440 An Incorrect Calculation Bug in the Linux Kernel eBPF Verifier_files/site.css"><script>
if (window.location.host == "www.thezdi.com") {window.location = "https://www.zerodayinitiative.com" + window.location.pathname}</script><script>Static.COOKIE_BANNER_CAPABLE = true;</script>
<script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create', 'UA-93169700-1', 'auto');ga('send', 'pageview');</script><!-- End of Squarespace Headers -->
    <link rel="stylesheet" href="./2021 - ZDI-20-1440 An Incorrect Calculation Bug in the Linux Kernel eBPF Verifier_files/main.css">


  </head>

  <body id="item-6005f43e3d757a3dbd41b2f2" class="event-show-past-events event-thumbnails event-thumbnail-size-32-standard event-date-label  event-list-show-cats event-list-date event-list-time event-list-address   event-icalgcal-links  event-excerpts      gallery-design-slideshow aspect-ratio-auto lightbox-style-dark gallery-navigation-bullets gallery-info-overlay-show-on-hover gallery-aspect-ratio-32-standard gallery-arrow-style-no-background gallery-transitions-fade gallery-show-arrows gallery-auto-crop   product-list-titles-under product-list-alignment-left product-item-size-11-square product-image-auto-crop product-gallery-size-11-square product-gallery-auto-crop show-product-price show-product-item-nav product-social-sharing tweak-v1-related-products-image-aspect-ratio-11-square tweak-v1-related-products-details-alignment-center newsletter-style-dark hide-opentable-icons opentable-style-dark small-button-style-solid small-button-shape-square medium-button-style-solid medium-button-shape-square large-button-style-solid large-button-shape-square image-block-poster-text-alignment-center image-block-card-dynamic-font-sizing image-block-card-content-position-center image-block-card-text-alignment-left image-block-overlap-dynamic-font-sizing image-block-overlap-content-position-center image-block-overlap-text-alignment-left image-block-collage-dynamic-font-sizing image-block-collage-content-position-top image-block-collage-text-alignment-left image-block-stack-dynamic-font-sizing image-block-stack-text-alignment-left button-style-solid button-corner-style-square tweak-product-quick-view-button-style-floating tweak-product-quick-view-button-position-bottom tweak-product-quick-view-lightbox-excerpt-display-truncate tweak-product-quick-view-lightbox-show-arrows tweak-product-quick-view-lightbox-show-close-button tweak-product-quick-view-lightbox-controls-weight-light native-currency-code-usd collection-58a5b38cb3db2bd67b608658 view-item collection-type-blog collection-layout-default mobile-style-available">

    <div id="outerWrapper">

      <div id="bgOverlay"></div>

      <!--HEADER-->

      <header id="header">

        <!--MAIN NAVIGATION-->
            <!-- Begin Off Canvas Menu-->
    <div class="off-canvas">
        <nav class="off-canvas__list" role="main-navigation2">
            <div class="js-mobile-nav-toggle">Menu</div>
            <ul class="topMenu">
                <li class="nav__tier1"><a href="https://www.trendmicro.com/privacy">PRIVACY</a></li>
                <li class="nav__tier1"><a href="https://www.zerodayinitiative.com/about">WHO WE ARE</a></li>
                <li class="nav__tier1"><a href="https://www.zerodayinitiative.com/about/benefits">HOW IT WORKS</a></li>
                <li class="nav__tier1"><a href="https://www.zerodayinitiative.com/blog">BLOG</a></li>
                <li class="nav__tier1"><a href="https://www.zerodayinitiative.com/advisories">ADVISORIES</a></li>
                <li class="nav__tier1"><a class="sign-in" href="https://www.zerodayinitiative.com/portal">LOG IN</a></li>
                <li class="nav__tier1"><a class="sign-in" href="https://www.zerodayinitiative.com/portal/register">SIGN UP</a></li>
            </ul>
            <ul class="bottomMenu">
                <li class="nav__tier1 logo"><a href="https://www.zerodayinitiative.com/"><img src="./2021 - ZDI-20-1440 An Incorrect Calculation Bug in the Linux Kernel eBPF Verifier_files/logo.svg" width="125" height="37" alt="thezdi"></a></li>
                <li class="nav__tier1"><a href="https://www.trendmicro.com/">Trend Micro</a></li>
            </ul>
        </nav>
    </div>
    <!-- End Off Canvas Menu -->
            <div id="nav" class="group">
        <div id="navContent">
            <div class="nav__container">
                <div class="nav__header">
                    <div class="global-header__logo">
                        <a href="https://www.zerodayinitiative.com/"><img src="./2021 - ZDI-20-1440 An Incorrect Calculation Bug in the Linux Kernel eBPF Verifier_files/logo.svg" alt="thezdi"></a>
                    </div>
                    <div id="mobileNavIcon" class="js-mobile-nav-toggle">Menu</div>
                    <div id="mobileOverlay"></div>
                </div>
                <nav class="nav__list" role="main-navigation">
                    <ul class="list-no-bullets">
                        <li class="nav__tier1"><a href="https://www.trendmicro.com/privacy">PRIVACY</a></li>
                        <li class="nav__tier1"><a href="https://www.zerodayinitiative.com/about">WHO WE ARE</a></li>
                        <li class="nav__tier1"><a href="https://www.zerodayinitiative.com/about/benefits">HOW IT WORKS</a></li>
                        <li class="nav__tier1"><a href="https://www.zerodayinitiative.com/blog">BLOG</a></li>
                        <li class="nav__tier1"><a href="https://www.zerodayinitiative.com/advisories">ADVISORIES</a></li>
                        <li class="nav__tier1 userActions">
                            <a href="https://www.zerodayinitiative.com/portal/">LOG IN</a>
                            <a href="https://www.zerodayinitiative.com/portal/register">SIGN UP</a>
                            </li><li>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </div>


      </header>

      <!--SITE TITLE OR LOGO-->
      <div id="innerWrapper">

      <!--CONTENT INJECTION POINT-->
        <section id="content">
          <div class="main-content-wrapper cf" data-content-field="main-content">
            <!-- CATEGORY NAV -->
            
            <div id="mainContent" class="blogDetails group subscribeAbs">
    <div id="imageMasthead" class="smaller">
        <div class="content">
            
                <h1 class="title" data-content-field="title">
                  
                    ZDI-20-1440: An Incorrect Calculation Bug in the Linux Kernel eBPF Verifier
                  
                </h1>
                <data>January 19, 2021  |  Lucas Leong</data>
            
        </div>
    </div>

    <div class="blog-listing blog-details">
        <div class="subscribe-container">
            <a href="https://www.zerodayinitiative.com/rss/" class="btn subscribe rounded">SUBSCRIBE</a>
        </div>
        <div class="section">
            <div class="contentBlock">
                <div class="contentBlockCopy">
                    
                      <div class="group">
                        <div class="sqs-layout sqs-grid-12 columns-12" data-layout-label="Post Body" data-type="item" data-updated-on="1611003153649" id="item-6005f43e3d757a3dbd41b2f2"><div class="row sqs-row"><div class="col sqs-col-12 span-12"><div class="sqs-block html-block sqs-block-html" data-block-type="2" id="block-458dbce64d9cd1fb01ae"><div class="sqs-block-content"><p class="" style="white-space:pre-wrap;">In April 2020, the ZDI received a Linux kernel submission that turned out to be an incorrect calculation bug in the extended Berkeley Packet Filter (eBPF) verifier. If you’re not familiar with it, eBPF is a Linux subsystem that is designed to safely execute untrusted, user-defined extensions inside the kernel for purposes such as packet filtering. It relies on static analysis to protect the kernel against problematic extensions. The submission we received from Ryota Shiga (<a href="https://twitter.com/ga_ryo_" target="_blank">@Ga_ryo_</a>) of Flatt Security bypasses the eBPF verification and can lead to out-of-bounds (OOB) access in the Linux kernel. The eBPF verifier is a well-known source of Linux kernel local privilege escalation vulnerabilities and has been seen in many cases in the past, including being used at&nbsp;<a href="https://www.zerodayinitiative.com/blog/2020/3/19/pwn2own-2020-day-one-results" target="_blank">Pwn2Own 2020</a>.</p><p class="" style="white-space:pre-wrap;">This vulnerability affects the current Linux kernel long term version from 4.9 to 4.13. One particular distribution, Debian 9, is currently using an affected kernel version. The ZDI is disclosing this bug publicly as&nbsp;<a href="https://www.zerodayinitiative.com/advisories/ZDI-20-1440/" target="_blank">ZDI-20-1440</a> without a patch in accordance with our 120-day&nbsp;<a href="https://www.zerodayinitiative.com/advisories/disclosure_policy/" target="_blank">disclosure policy</a>.</p><p class="" style="white-space:pre-wrap;"><strong>The Vulnerability</strong></p></div></div><div class="sqs-block markdown-block sqs-block-markdown" data-block-type="44" id="block-yui_3_17_2_1_1611002762241_14412"><div class="sqs-block-content"><p>If you are not familiar with the eBPF verifier, we highly recommend the <a href="https://www.zerodayinitiative.com/blog/2020/4/8/cve-2020-8835-linux-kernel-privilege-escalation-via-improper-ebpf-program-verification">write-up</a> by Manfred Paul (<a href="https://twitter.com/_manfp">@_manfp</a>). There are two passes of verifications before executing any BPF programs. The first pass (<code>check_cfg()</code>) ensures the code is loop-free. The second pass (<code>do_check()</code>) attempts to determine if there are any invalid instructions or possible memory violations. Emulation is used to check for possible memory violations. The incorrect calculation described here comes from opcode <code>BPF_RSH</code> during the second pass. The following excerpts are based on <a href="https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/bpf/verifier.c?h=v4.9.249">4.9.249</a>.</p>
</div></div><div class="sqs-block embed-block sqs-block-embed" data-block-json="{&quot;hSize&quot;:null,&quot;floatDir&quot;:null,&quot;html&quot;:&quot;&lt;script src=\&quot;https://gist.github.com/1c95a19cddc0f4bfa03950978ff65243.js\&quot;&gt;&lt;/script&gt;&quot;,&quot;resolvedBy&quot;:&quot;manual&quot;,&quot;resolved&quot;:true}" data-block-type="22" id="block-yui_3_17_2_1_1611003168001_13422"><div class="sqs-block-content" id="yui_3_17_2_1_1638470369736_66" style="visibility: visible; opacity: 1; height: auto;"><script src="./2021 - ZDI-20-1440 An Incorrect Calculation Bug in the Linux Kernel eBPF Verifier_files/1c95a19cddc0f4bfa03950978ff65243.js.下載"></script><link rel="stylesheet" href="./2021 - ZDI-20-1440 An Incorrect Calculation Bug in the Linux Kernel eBPF Verifier_files/gist-embed-ff75a167df5efbfedb0e388793ca9fe7.css"><div id="gist107408076" class="gist">
    <div class="gist-file" translate="no">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-zdi-20-1440-snippet-1-cpp" class="file my-2">
    
  <div itemprop="text" class="Box-body p-0 blob-wrapper data type-c  ">

      
<div class="js-check-bidi blob-code-content">
  <template class="js-file-alert-template"></template>
<template class="js-line-alert-template"></template>

  <table class="highlight tab-size js-file-line-container js-code-nav-container js-tagsearch-file" data-tab-size="8" data-paste-markdown-skip="" data-tagsearch-lang="C++" data-tagsearch-path="ZDI-20-1440-snippet-1.cpp">
        <tbody><tr>
          <td id="file-zdi-20-1440-snippet-1-cpp-L1" class="blob-num js-line-number js-code-nav-line-number" data-line-number="1"></td>
          <td id="file-zdi-20-1440-snippet-1-cpp-LC1" class="blob-code blob-code-inner js-file-line"><span class="pl-k">static</span> <span class="pl-k">int</span> <span class="pl-en">do_check</span>(<span class="pl-k">struct</span> <span class="pl-en">bpf_verifier_env</span> *env) </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-1-cpp-L2" class="blob-num js-line-number js-code-nav-line-number" data-line-number="2"></td>
          <td id="file-zdi-20-1440-snippet-1-cpp-LC2" class="blob-code blob-code-inner js-file-line">{ </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-1-cpp-L3" class="blob-num js-line-number js-code-nav-line-number" data-line-number="3"></td>
          <td id="file-zdi-20-1440-snippet-1-cpp-LC3" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">//</span>... </span></td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-1-cpp-L4" class="blob-num js-line-number js-code-nav-line-number" data-line-number="4"></td>
          <td id="file-zdi-20-1440-snippet-1-cpp-LC4" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">if</span> (<span class="pl-k">class</span> == BPF_ALU || <span class="pl-k">class</span> == BPF_ALU64) { </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-1-cpp-L5" class="blob-num js-line-number js-code-nav-line-number" data-line-number="5"></td>
          <td id="file-zdi-20-1440-snippet-1-cpp-LC5" class="blob-code blob-code-inner js-file-line">            err = <span class="pl-c1">check_alu_op</span>(env, insn);   <span class="pl-c"><span class="pl-c">//</span> &lt;-- (1) </span></td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-1-cpp-L6" class="blob-num js-line-number js-code-nav-line-number" data-line-number="6"></td>
          <td id="file-zdi-20-1440-snippet-1-cpp-LC6" class="blob-code blob-code-inner js-file-line">            <span class="pl-k">if</span> (err) </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-1-cpp-L7" class="blob-num js-line-number js-code-nav-line-number" data-line-number="7"></td>
          <td id="file-zdi-20-1440-snippet-1-cpp-LC7" class="blob-code blob-code-inner js-file-line">                <span class="pl-k">return</span> err; </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-1-cpp-L8" class="blob-num js-line-number js-code-nav-line-number" data-line-number="8"></td>
          <td id="file-zdi-20-1440-snippet-1-cpp-LC8" class="blob-code blob-code-inner js-file-line">        } </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-1-cpp-L9" class="blob-num js-line-number js-code-nav-line-number" data-line-number="9"></td>
          <td id="file-zdi-20-1440-snippet-1-cpp-LC9" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">//</span>... </span></td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-1-cpp-L10" class="blob-num js-line-number js-code-nav-line-number" data-line-number="10"></td>
          <td id="file-zdi-20-1440-snippet-1-cpp-LC10" class="blob-code blob-code-inner js-file-line">} </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-1-cpp-L11" class="blob-num js-line-number js-code-nav-line-number" data-line-number="11"></td>
          <td id="file-zdi-20-1440-snippet-1-cpp-LC11" class="blob-code blob-code-inner js-file-line"> </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-1-cpp-L12" class="blob-num js-line-number js-code-nav-line-number" data-line-number="12"></td>
          <td id="file-zdi-20-1440-snippet-1-cpp-LC12" class="blob-code blob-code-inner js-file-line"><span class="pl-k">static</span> <span class="pl-k">int</span> <span class="pl-en">check_alu_op</span>(<span class="pl-k">struct</span> <span class="pl-en">bpf_verifier_env</span> *env, <span class="pl-k">struct</span> <span class="pl-en">bpf_insn</span> *insn) </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-1-cpp-L13" class="blob-num js-line-number js-code-nav-line-number" data-line-number="13"></td>
          <td id="file-zdi-20-1440-snippet-1-cpp-LC13" class="blob-code blob-code-inner js-file-line">{ </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-1-cpp-L14" class="blob-num js-line-number js-code-nav-line-number" data-line-number="14"></td>
          <td id="file-zdi-20-1440-snippet-1-cpp-LC14" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">//</span> ... </span></td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-1-cpp-L15" class="blob-num js-line-number js-code-nav-line-number" data-line-number="15"></td>
          <td id="file-zdi-20-1440-snippet-1-cpp-LC15" class="blob-code blob-code-inner js-file-line">        <span class="pl-c"><span class="pl-c">/*</span> first we want to adjust our ranges. <span class="pl-c">*/</span></span> </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-1-cpp-L16" class="blob-num js-line-number js-code-nav-line-number" data-line-number="16"></td>
          <td id="file-zdi-20-1440-snippet-1-cpp-LC16" class="blob-code blob-code-inner js-file-line">        <span class="pl-c1">adjust_reg_min_max_vals</span>(env, insn);  <span class="pl-c"><span class="pl-c">//</span> &lt;-- (2) </span></td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-1-cpp-L17" class="blob-num js-line-number js-code-nav-line-number" data-line-number="17"></td>
          <td id="file-zdi-20-1440-snippet-1-cpp-LC17" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">//</span>... </span></td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-1-cpp-L18" class="blob-num js-line-number js-code-nav-line-number" data-line-number="18"></td>
          <td id="file-zdi-20-1440-snippet-1-cpp-LC18" class="blob-code blob-code-inner js-file-line">} </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-1-cpp-L19" class="blob-num js-line-number js-code-nav-line-number" data-line-number="19"></td>
          <td id="file-zdi-20-1440-snippet-1-cpp-LC19" class="blob-code blob-code-inner js-file-line"> </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-1-cpp-L20" class="blob-num js-line-number js-code-nav-line-number" data-line-number="20"></td>
          <td id="file-zdi-20-1440-snippet-1-cpp-LC20" class="blob-code blob-code-inner js-file-line"><span class="pl-k">static</span> <span class="pl-k">void</span> <span class="pl-en">adjust_reg_min_max_vals</span>(<span class="pl-k">struct</span> <span class="pl-en">bpf_verifier_env</span> *env, </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-1-cpp-L21" class="blob-num js-line-number js-code-nav-line-number" data-line-number="21"></td>
          <td id="file-zdi-20-1440-snippet-1-cpp-LC21" class="blob-code blob-code-inner js-file-line">                    <span class="pl-k">struct</span> <span class="pl-en">bpf_insn</span> *insn) </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-1-cpp-L22" class="blob-num js-line-number js-code-nav-line-number" data-line-number="22"></td>
          <td id="file-zdi-20-1440-snippet-1-cpp-LC22" class="blob-code blob-code-inner js-file-line">{ </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-1-cpp-L23" class="blob-num js-line-number js-code-nav-line-number" data-line-number="23"></td>
          <td id="file-zdi-20-1440-snippet-1-cpp-LC23" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">//</span>... </span></td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-1-cpp-L24" class="blob-num js-line-number js-code-nav-line-number" data-line-number="24"></td>
          <td id="file-zdi-20-1440-snippet-1-cpp-LC24" class="blob-code blob-code-inner js-file-line"><span class="pl-k">if</span> (<span class="pl-c1">BPF_SRC</span>(insn-&gt;<span class="pl-smi">code</span>) == BPF_X) { </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-1-cpp-L25" class="blob-num js-line-number js-code-nav-line-number" data-line-number="25"></td>
          <td id="file-zdi-20-1440-snippet-1-cpp-LC25" class="blob-code blob-code-inner js-file-line"><span class="pl-c1">check_reg_overflow</span>(&amp;regs[insn-&gt;<span class="pl-smi">src_reg</span>]); </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-1-cpp-L26" class="blob-num js-line-number js-code-nav-line-number" data-line-number="26"></td>
          <td id="file-zdi-20-1440-snippet-1-cpp-LC26" class="blob-code blob-code-inner js-file-line">min_val = regs[insn-&gt;<span class="pl-smi">src_reg</span>].<span class="pl-smi">min_value</span>; </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-1-cpp-L27" class="blob-num js-line-number js-code-nav-line-number" data-line-number="27"></td>
          <td id="file-zdi-20-1440-snippet-1-cpp-LC27" class="blob-code blob-code-inner js-file-line">max_val = regs[insn-&gt;<span class="pl-smi">src_reg</span>].<span class="pl-smi">max_value</span>; </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-1-cpp-L28" class="blob-num js-line-number js-code-nav-line-number" data-line-number="28"></td>
          <td id="file-zdi-20-1440-snippet-1-cpp-LC28" class="blob-code blob-code-inner js-file-line">} </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-1-cpp-L29" class="blob-num js-line-number js-code-nav-line-number" data-line-number="29"></td>
          <td id="file-zdi-20-1440-snippet-1-cpp-LC29" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">//</span> ... </span></td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-1-cpp-L30" class="blob-num js-line-number js-code-nav-line-number" data-line-number="30"></td>
          <td id="file-zdi-20-1440-snippet-1-cpp-LC30" class="blob-code blob-code-inner js-file-line">    <span class="pl-k">case</span> BPF_RSH: </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-1-cpp-L31" class="blob-num js-line-number js-code-nav-line-number" data-line-number="31"></td>
          <td id="file-zdi-20-1440-snippet-1-cpp-LC31" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">/*</span> RSH by a negative number is undefined, and the BPF_RSH is an </span></td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-1-cpp-L32" class="blob-num js-line-number js-code-nav-line-number" data-line-number="32"></td>
          <td id="file-zdi-20-1440-snippet-1-cpp-LC32" class="blob-code blob-code-inner js-file-line"><span class="pl-c"> * unsigned shift, so make the appropriate casts. </span></td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-1-cpp-L33" class="blob-num js-line-number js-code-nav-line-number" data-line-number="33"></td>
          <td id="file-zdi-20-1440-snippet-1-cpp-LC33" class="blob-code blob-code-inner js-file-line"><span class="pl-c"> <span class="pl-c">*/</span></span> </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-1-cpp-L34" class="blob-num js-line-number js-code-nav-line-number" data-line-number="34"></td>
          <td id="file-zdi-20-1440-snippet-1-cpp-LC34" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">if</span> (min_val &lt; <span class="pl-c1">0</span> || dst_reg-&gt;<span class="pl-smi">min_value</span> &lt; <span class="pl-c1">0</span>) </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-1-cpp-L35" class="blob-num js-line-number js-code-nav-line-number" data-line-number="35"></td>
          <td id="file-zdi-20-1440-snippet-1-cpp-LC35" class="blob-code blob-code-inner js-file-line">            dst_reg-&gt;<span class="pl-smi">min_value</span> = BPF_REGISTER_MIN_RANGE; </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-1-cpp-L36" class="blob-num js-line-number js-code-nav-line-number" data-line-number="36"></td>
          <td id="file-zdi-20-1440-snippet-1-cpp-LC36" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">else</span> </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-1-cpp-L37" class="blob-num js-line-number js-code-nav-line-number" data-line-number="37"></td>
          <td id="file-zdi-20-1440-snippet-1-cpp-LC37" class="blob-code blob-code-inner js-file-line">            dst_reg-&gt;<span class="pl-smi">min_value</span> = (u64)(dst_reg-&gt;<span class="pl-smi">min_value</span>) &gt;&gt; min_val;  <span class="pl-c"><span class="pl-c">//</span> &lt;-- (3) </span></td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-1-cpp-L38" class="blob-num js-line-number js-code-nav-line-number" data-line-number="38"></td>
          <td id="file-zdi-20-1440-snippet-1-cpp-LC38" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">if</span> (dst_reg-&gt;<span class="pl-smi">max_value</span> != BPF_REGISTER_MAX_RANGE) </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-1-cpp-L39" class="blob-num js-line-number js-code-nav-line-number" data-line-number="39"></td>
          <td id="file-zdi-20-1440-snippet-1-cpp-LC39" class="blob-code blob-code-inner js-file-line">            dst_reg-&gt;<span class="pl-smi">max_value</span> &gt;&gt;= max_val;     &lt;-- (<span class="pl-c1">4</span>) </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-1-cpp-L40" class="blob-num js-line-number js-code-nav-line-number" data-line-number="40"></td>
          <td id="file-zdi-20-1440-snippet-1-cpp-LC40" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">break</span>; </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-1-cpp-L41" class="blob-num js-line-number js-code-nav-line-number" data-line-number="41"></td>
          <td id="file-zdi-20-1440-snippet-1-cpp-LC41" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">//</span> ... </span></td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-1-cpp-L42" class="blob-num js-line-number js-code-nav-line-number" data-line-number="42"></td>
          <td id="file-zdi-20-1440-snippet-1-cpp-LC42" class="blob-code blob-code-inner js-file-line">}</td>
        </tr>
  </tbody></table>
</div>


  </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/zdi-team/1c95a19cddc0f4bfa03950978ff65243/raw/8f227eb2f5ff4eeac1ccaaddc292270d9700041d/ZDI-20-1440-snippet-1.cpp" style="float:right">view raw</a>
        <a href="https://gist.github.com/zdi-team/1c95a19cddc0f4bfa03950978ff65243#file-zdi-20-1440-snippet-1-cpp">
          ZDI-20-1440-snippet-1.cpp
        </a>
        hosted with ❤ by <a href="https://github.com/">GitHub</a>
      </div>
    </div>
</div>
</div></div><div class="sqs-block markdown-block sqs-block-markdown" data-block-type="44" id="block-yui_3_17_2_1_1611003168001_14374"><div class="sqs-block-content"><p>The <code>BPF_RSH</code> (unsigned right shift) instruction belongs to the <code>BPF_ALU64</code> class of instructions. When emulating <code>BPF_RSH</code>, <code>do_check</code> calls <code>check_alu_op</code> at (1), which then calls <code>adjust_reg_min_max_vals</code> at (2). At (3) and (4), it tries to update the minimum and maximum value of <code>dst_reg</code> based upon how the shift operation will modify <code>dst_reg</code>. Note that the local variables <code>min_value</code> and <code>max_value</code> contain the known bounds of the operand that specifies the shift distance. There are corresponding fields named <code>min_value</code> and <code>max_value</code> that hold the known bounds of <code>dst_reg</code>.</p>
<p>However, the calculations at (3) and (4) are wrong. For example, to calculate <code>max(a &gt;&gt; b)</code> (the maximum possible value of <code>a</code> when right-shifted by <code>b</code> bits), the correct formula is <code>max(a) &gt;&gt; min(b)</code>. (To understand why, consider that a right shift is equivalent to division by a power of two. The largest possible result is produced by choosing the largest possible numerator and the smallest possible denominator.) Instead, the code at (4) calculates <code>max(a) &gt;&gt; max(b)</code>. A corresponding mistake is present at (3).</p>
<p>The consequences of bounds miscalculation during eBPF verification are catastrophic. If the attacker later uses <code>dst_reg</code> as the address for a load or store, the verification in (5) below will be bypassed.</p>
</div></div><div class="sqs-block embed-block sqs-block-embed" data-block-json="{&quot;hSize&quot;:null,&quot;floatDir&quot;:null,&quot;html&quot;:&quot;&lt;script src=\&quot;https://gist.github.com/d87bd639bb93848c4cb9849db3eeb725.js\&quot;&gt;&lt;/script&gt;&quot;,&quot;resolvedBy&quot;:&quot;manual&quot;,&quot;resolved&quot;:true}" data-block-type="22" id="block-yui_3_17_2_1_1611003168001_15467"><div class="sqs-block-content" id="yui_3_17_2_1_1638470369736_69" style="visibility: visible; opacity: 1; height: auto;"><script src="./2021 - ZDI-20-1440 An Incorrect Calculation Bug in the Linux Kernel eBPF Verifier_files/d87bd639bb93848c4cb9849db3eeb725.js.下載"></script><link rel="stylesheet" href="./2021 - ZDI-20-1440 An Incorrect Calculation Bug in the Linux Kernel eBPF Verifier_files/gist-embed-ff75a167df5efbfedb0e388793ca9fe7.css"><div id="gist107408085" class="gist">
    <div class="gist-file" translate="no">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-zdi-20-1440-snippet-2-cpp" class="file my-2">
    
  <div itemprop="text" class="Box-body p-0 blob-wrapper data type-c  ">

      
<div class="js-check-bidi blob-code-content">
  <template class="js-file-alert-template"></template>
<template class="js-line-alert-template"></template>

  <table class="highlight tab-size js-file-line-container js-code-nav-container js-tagsearch-file" data-tab-size="8" data-paste-markdown-skip="" data-tagsearch-lang="C++" data-tagsearch-path="ZDI-20-1440-snippet-2.cpp">
        <tbody><tr>
          <td id="file-zdi-20-1440-snippet-2-cpp-L1" class="blob-num js-line-number js-code-nav-line-number" data-line-number="1"></td>
          <td id="file-zdi-20-1440-snippet-2-cpp-LC1" class="blob-code blob-code-inner js-file-line"><span class="pl-k">static</span> <span class="pl-k">int</span> <span class="pl-en">do_check</span>(<span class="pl-k">struct</span> <span class="pl-en">bpf_verifier_env</span> *env) </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-2-cpp-L2" class="blob-num js-line-number js-code-nav-line-number" data-line-number="2"></td>
          <td id="file-zdi-20-1440-snippet-2-cpp-LC2" class="blob-code blob-code-inner js-file-line">{ </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-2-cpp-L3" class="blob-num js-line-number js-code-nav-line-number" data-line-number="3"></td>
          <td id="file-zdi-20-1440-snippet-2-cpp-LC3" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">//</span> ... </span></td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-2-cpp-L4" class="blob-num js-line-number js-code-nav-line-number" data-line-number="4"></td>
          <td id="file-zdi-20-1440-snippet-2-cpp-LC4" class="blob-code blob-code-inner js-file-line">        } <span class="pl-k">else</span> <span class="pl-k">if</span> (<span class="pl-k">class</span> == BPF_STX) { </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-2-cpp-L5" class="blob-num js-line-number js-code-nav-line-number" data-line-number="5"></td>
          <td id="file-zdi-20-1440-snippet-2-cpp-LC5" class="blob-code blob-code-inner js-file-line">            <span class="pl-c"><span class="pl-c">/*</span> check that memory (dst_reg + off) is writeable <span class="pl-c">*/</span></span> </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-2-cpp-L6" class="blob-num js-line-number js-code-nav-line-number" data-line-number="6"></td>
          <td id="file-zdi-20-1440-snippet-2-cpp-LC6" class="blob-code blob-code-inner js-file-line">            err = <span class="pl-c1">check_mem_access</span>(env, insn_idx, insn-&gt;<span class="pl-smi">dst_reg</span>, insn-&gt;<span class="pl-smi">off</span>, </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-2-cpp-L7" class="blob-num js-line-number js-code-nav-line-number" data-line-number="7"></td>
          <td id="file-zdi-20-1440-snippet-2-cpp-LC7" class="blob-code blob-code-inner js-file-line">                           <span class="pl-c1">BPF_SIZE</span>(insn-&gt;<span class="pl-smi">code</span>), BPF_WRITE, </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-2-cpp-L8" class="blob-num js-line-number js-code-nav-line-number" data-line-number="8"></td>
          <td id="file-zdi-20-1440-snippet-2-cpp-LC8" class="blob-code blob-code-inner js-file-line">                           insn-&gt;<span class="pl-smi">src_reg</span>);   &lt;-- (<span class="pl-c1">5</span>) </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-2-cpp-L9" class="blob-num js-line-number js-code-nav-line-number" data-line-number="9"></td>
          <td id="file-zdi-20-1440-snippet-2-cpp-LC9" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">//</span> ... </span></td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-2-cpp-L10" class="blob-num js-line-number js-code-nav-line-number" data-line-number="10"></td>
          <td id="file-zdi-20-1440-snippet-2-cpp-LC10" class="blob-code blob-code-inner js-file-line">}</td>
        </tr>
  </tbody></table>
</div>


  </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/zdi-team/d87bd639bb93848c4cb9849db3eeb725/raw/b1f43ed44b286841f0863d6903c66eb7865e23dd/ZDI-20-1440-snippet-2.cpp" style="float:right">view raw</a>
        <a href="https://gist.github.com/zdi-team/d87bd639bb93848c4cb9849db3eeb725#file-zdi-20-1440-snippet-2-cpp">
          ZDI-20-1440-snippet-2.cpp
        </a>
        hosted with ❤ by <a href="https://github.com/">GitHub</a>
      </div>
    </div>
</div>
</div></div><div class="sqs-block markdown-block sqs-block-markdown" data-block-type="44" id="block-yui_3_17_2_1_1611003168001_16429"><div class="sqs-block-content"><p>Once the eBPF program passes verification, it will execute in the kernel, and the attacker can achieve an out-of-bounds memory access, as seen in (6) below.</p>
</div></div><div class="sqs-block embed-block sqs-block-embed" data-block-json="{&quot;hSize&quot;:null,&quot;floatDir&quot;:null,&quot;html&quot;:&quot;&lt;script src=\&quot;https://gist.github.com/ca363281478dff1f2ce6bd5ea0568128.js\&quot;&gt;&lt;/script&gt;&quot;,&quot;resolvedBy&quot;:&quot;manual&quot;,&quot;resolved&quot;:true}" data-block-type="22" id="block-yui_3_17_2_1_1611003168001_17258"><div class="sqs-block-content" id="yui_3_17_2_1_1638470369736_72" style="visibility: visible; opacity: 1; height: auto;"><script src="./2021 - ZDI-20-1440 An Incorrect Calculation Bug in the Linux Kernel eBPF Verifier_files/ca363281478dff1f2ce6bd5ea0568128.js.下載"></script><link rel="stylesheet" href="./2021 - ZDI-20-1440 An Incorrect Calculation Bug in the Linux Kernel eBPF Verifier_files/gist-embed-ff75a167df5efbfedb0e388793ca9fe7.css"><div id="gist107408087" class="gist">
    <div class="gist-file" translate="no">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-zdi-20-1440-snippet-3-cpp" class="file my-2">
    
  <div itemprop="text" class="Box-body p-0 blob-wrapper data type-c  ">

      
<div class="js-check-bidi blob-code-content">
  <template class="js-file-alert-template"></template>
<template class="js-line-alert-template"></template>

  <table class="highlight tab-size js-file-line-container js-code-nav-container js-tagsearch-file" data-tab-size="8" data-paste-markdown-skip="" data-tagsearch-lang="C++" data-tagsearch-path="ZDI-20-1440-snippet-3.cpp">
        <tbody><tr>
          <td id="file-zdi-20-1440-snippet-3-cpp-L1" class="blob-num js-line-number js-code-nav-line-number" data-line-number="1"></td>
          <td id="file-zdi-20-1440-snippet-3-cpp-LC1" class="blob-code blob-code-inner js-file-line"><span class="pl-k">static</span> <span class="pl-k">unsigned</span> <span class="pl-k">int</span> <span class="pl-en">__bpf_prog_run</span>(<span class="pl-k">void</span> *ctx, <span class="pl-k">const</span> <span class="pl-k">struct</span> <span class="pl-en">bpf_insn</span> *insn) </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-3-cpp-L2" class="blob-num js-line-number js-code-nav-line-number" data-line-number="2"></td>
          <td id="file-zdi-20-1440-snippet-3-cpp-LC2" class="blob-code blob-code-inner js-file-line">{ </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-3-cpp-L3" class="blob-num js-line-number js-code-nav-line-number" data-line-number="3"></td>
          <td id="file-zdi-20-1440-snippet-3-cpp-LC3" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">//</span> ... </span></td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-3-cpp-L4" class="blob-num js-line-number js-code-nav-line-number" data-line-number="4"></td>
          <td id="file-zdi-20-1440-snippet-3-cpp-LC4" class="blob-code blob-code-inner js-file-line">#<span class="pl-k">define</span> <span class="pl-en">LDST</span>(<span class="pl-v">SIZEOP, SIZE</span>)                      \ </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-3-cpp-L5" class="blob-num js-line-number js-code-nav-line-number" data-line-number="5"></td>
          <td id="file-zdi-20-1440-snippet-3-cpp-LC5" class="blob-code blob-code-inner js-file-line">    STX_MEM_##SIZEOP:                       \ </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-3-cpp-L6" class="blob-num js-line-number js-code-nav-line-number" data-line-number="6"></td>
          <td id="file-zdi-20-1440-snippet-3-cpp-LC6" class="blob-code blob-code-inner js-file-line">        *(SIZE *)(<span class="pl-k">unsigned</span> <span class="pl-k">long</span>) (DST + insn-&gt;<span class="pl-smi">off</span>) = SRC;   \    <span class="pl-c"><span class="pl-c">//</span> &lt;-- (6) </span></td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-3-cpp-L7" class="blob-num js-line-number js-code-nav-line-number" data-line-number="7"></td>
          <td id="file-zdi-20-1440-snippet-3-cpp-LC7" class="blob-code blob-code-inner js-file-line">        CONT; </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-3-cpp-L8" class="blob-num js-line-number js-code-nav-line-number" data-line-number="8"></td>
          <td id="file-zdi-20-1440-snippet-3-cpp-LC8" class="blob-code blob-code-inner js-file-line">... </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-3-cpp-L9" class="blob-num js-line-number js-code-nav-line-number" data-line-number="9"></td>
          <td id="file-zdi-20-1440-snippet-3-cpp-LC9" class="blob-code blob-code-inner js-file-line"><span class="pl-c1">LDST</span>(DW, u64) </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-3-cpp-L10" class="blob-num js-line-number js-code-nav-line-number" data-line-number="10"></td>
          <td id="file-zdi-20-1440-snippet-3-cpp-LC10" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">//</span> ... </span></td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-3-cpp-L11" class="blob-num js-line-number js-code-nav-line-number" data-line-number="11"></td>
          <td id="file-zdi-20-1440-snippet-3-cpp-LC11" class="blob-code blob-code-inner js-file-line">}</td>
        </tr>
  </tbody></table>
</div>


  </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/zdi-team/ca363281478dff1f2ce6bd5ea0568128/raw/61f27d480e596631c71cdf58a0e7ae0625e895b9/ZDI-20-1440-snippet-3.cpp" style="float:right">view raw</a>
        <a href="https://gist.github.com/zdi-team/ca363281478dff1f2ce6bd5ea0568128#file-zdi-20-1440-snippet-3-cpp">
          ZDI-20-1440-snippet-3.cpp
        </a>
        hosted with ❤ by <a href="https://github.com/">GitHub</a>
      </div>
    </div>
</div>
</div></div><div class="sqs-block markdown-block sqs-block-markdown" data-block-type="44" id="block-yui_3_17_2_1_1611003168001_31158"><div class="sqs-block-content"><p><b data-preserve-html-node="true">The Trigger</b></p>
<p>Before triggering the bug, we have to first create two bpf maps with <code>bpf_create_map()</code>. A bpf map is a memory region designated to be accessible from within eBPF code. One map is for triggering the bug, while the other is the target for OOB access. The following opcodes perform preliminary work:</p>
</div></div><div class="sqs-block embed-block sqs-block-embed" data-block-json="{&quot;hSize&quot;:null,&quot;floatDir&quot;:null,&quot;html&quot;:&quot;&lt;script src=\&quot;https://gist.github.com/cb400cac07ddd527a219e401f8a58245.js\&quot;&gt;&lt;/script&gt;&quot;,&quot;resolvedBy&quot;:&quot;manual&quot;,&quot;resolved&quot;:true}" data-block-type="22" id="block-yui_3_17_2_1_1611003168001_32234"><div class="sqs-block-content" id="yui_3_17_2_1_1638470369736_75" style="visibility: visible; opacity: 1; height: auto;"><script src="./2021 - ZDI-20-1440 An Incorrect Calculation Bug in the Linux Kernel eBPF Verifier_files/cb400cac07ddd527a219e401f8a58245.js.下載"></script><link rel="stylesheet" href="./2021 - ZDI-20-1440 An Incorrect Calculation Bug in the Linux Kernel eBPF Verifier_files/gist-embed-ff75a167df5efbfedb0e388793ca9fe7.css"><div id="gist107408091" class="gist">
    <div class="gist-file" translate="no">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-zdi-20-1440-snippet-4-cpp" class="file my-2">
    
  <div itemprop="text" class="Box-body p-0 blob-wrapper data type-c  ">

      
<div class="js-check-bidi blob-code-content">
  <template class="js-file-alert-template"></template>
<template class="js-line-alert-template"></template>

  <table class="highlight tab-size js-file-line-container js-code-nav-container js-tagsearch-file" data-tab-size="8" data-paste-markdown-skip="" data-tagsearch-lang="C++" data-tagsearch-path="ZDI-20-1440-snippet-4.cpp">
        <tbody><tr>
          <td id="file-zdi-20-1440-snippet-4-cpp-L1" class="blob-num js-line-number js-code-nav-line-number" data-line-number="1"></td>
          <td id="file-zdi-20-1440-snippet-4-cpp-LC1" class="blob-code blob-code-inner js-file-line">#<span class="pl-k">define</span> <span class="pl-en">BPF_GET_MAP</span>(<span class="pl-v">fd, idx</span>) \ </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-4-cpp-L2" class="blob-num js-line-number js-code-nav-line-number" data-line-number="2"></td>
          <td id="file-zdi-20-1440-snippet-4-cpp-LC2" class="blob-code blob-code-inner js-file-line">        <span class="pl-en">BPF_LD_MAP_FD</span>(BPF_REG_1, fd), \ </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-4-cpp-L3" class="blob-num js-line-number js-code-nav-line-number" data-line-number="3"></td>
          <td id="file-zdi-20-1440-snippet-4-cpp-LC3" class="blob-code blob-code-inner js-file-line">        BPF_MOV64_IMM(BPF_REG_2, idx), \ </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-4-cpp-L4" class="blob-num js-line-number js-code-nav-line-number" data-line-number="4"></td>
          <td id="file-zdi-20-1440-snippet-4-cpp-LC4" class="blob-code blob-code-inner js-file-line">        BPF_STX_MEM(BPF_W, BPF_REG_10, BPF_REG_2, -<span class="pl-c1">4</span>),  \ </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-4-cpp-L5" class="blob-num js-line-number js-code-nav-line-number" data-line-number="5"></td>
          <td id="file-zdi-20-1440-snippet-4-cpp-LC5" class="blob-code blob-code-inner js-file-line">        BPF_MOV64_REG(BPF_REG_2, BPF_REG_10), \ </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-4-cpp-L6" class="blob-num js-line-number js-code-nav-line-number" data-line-number="6"></td>
          <td id="file-zdi-20-1440-snippet-4-cpp-LC6" class="blob-code blob-code-inner js-file-line">        BPF_ALU64_IMM(BPF_ADD, BPF_REG_2, -<span class="pl-c1">4</span>), \ </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-4-cpp-L7" class="blob-num js-line-number js-code-nav-line-number" data-line-number="7"></td>
          <td id="file-zdi-20-1440-snippet-4-cpp-LC7" class="blob-code blob-code-inner js-file-line">        BPF_RAW_INSN(BPF_JMP | BPF_CALL, <span class="pl-c1">0</span>, <span class="pl-c1">0</span>, <span class="pl-c1">0</span>, BPF_FUNC_map_lookup_elem), \ </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-4-cpp-L8" class="blob-num js-line-number js-code-nav-line-number" data-line-number="8"></td>
          <td id="file-zdi-20-1440-snippet-4-cpp-LC8" class="blob-code blob-code-inner js-file-line">        BPF_JMP_IMM(BPF_JNE, BPF_REG_0, <span class="pl-c1">0</span>, <span class="pl-c1">1</span>), \ </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-4-cpp-L9" class="blob-num js-line-number js-code-nav-line-number" data-line-number="9"></td>
          <td id="file-zdi-20-1440-snippet-4-cpp-LC9" class="blob-code blob-code-inner js-file-line">        BPF_EXIT_INSN(), </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-4-cpp-L10" class="blob-num js-line-number js-code-nav-line-number" data-line-number="10"></td>
          <td id="file-zdi-20-1440-snippet-4-cpp-LC10" class="blob-code blob-code-inner js-file-line"> </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-4-cpp-L11" class="blob-num js-line-number js-code-nav-line-number" data-line-number="11"></td>
          <td id="file-zdi-20-1440-snippet-4-cpp-LC11" class="blob-code blob-code-inner js-file-line">BPF_GET_MAP(map1_fd, <span class="pl-c1">1</span>) </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-4-cpp-L12" class="blob-num js-line-number js-code-nav-line-number" data-line-number="12"></td>
          <td id="file-zdi-20-1440-snippet-4-cpp-LC12" class="blob-code blob-code-inner js-file-line">BPF_LDX_MEM(BPF_W, BPF_REG_8, BPF_REG_0, <span class="pl-c1">0</span>), </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-4-cpp-L13" class="blob-num js-line-number js-code-nav-line-number" data-line-number="13"></td>
          <td id="file-zdi-20-1440-snippet-4-cpp-LC13" class="blob-code blob-code-inner js-file-line"> </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-4-cpp-L14" class="blob-num js-line-number js-code-nav-line-number" data-line-number="14"></td>
          <td id="file-zdi-20-1440-snippet-4-cpp-LC14" class="blob-code blob-code-inner js-file-line">BPF_GET_MAP(map1_fd, <span class="pl-c1">2</span>) </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-4-cpp-L15" class="blob-num js-line-number js-code-nav-line-number" data-line-number="15"></td>
          <td id="file-zdi-20-1440-snippet-4-cpp-LC15" class="blob-code blob-code-inner js-file-line">BPF_LDX_MEM(BPF_W, BPF_REG_9, BPF_REG_0, <span class="pl-c1">0</span>), </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-4-cpp-L16" class="blob-num js-line-number js-code-nav-line-number" data-line-number="16"></td>
          <td id="file-zdi-20-1440-snippet-4-cpp-LC16" class="blob-code blob-code-inner js-file-line"> </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-4-cpp-L17" class="blob-num js-line-number js-code-nav-line-number" data-line-number="17"></td>
          <td id="file-zdi-20-1440-snippet-4-cpp-LC17" class="blob-code blob-code-inner js-file-line">BPF_GET_MAP(map2_fd, <span class="pl-c1">0</span>)</td>
        </tr>
  </tbody></table>
</div>


  </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/zdi-team/cb400cac07ddd527a219e401f8a58245/raw/44ca3146da45702aaea12d3a19fab5f47739fe77/ZDI-20-1440-snippet-4.cpp" style="float:right">view raw</a>
        <a href="https://gist.github.com/zdi-team/cb400cac07ddd527a219e401f8a58245#file-zdi-20-1440-snippet-4-cpp">
          ZDI-20-1440-snippet-4.cpp
        </a>
        hosted with ❤ by <a href="https://github.com/">GitHub</a>
      </div>
    </div>
</div>
</div></div><div class="sqs-block markdown-block sqs-block-markdown" data-block-type="44" id="block-yui_3_17_2_1_1611003168001_33245"><div class="sqs-block-content"><p>The <code>BPF_FUNC_map_lookup_elem</code> function returns a pointer to a location in a bpf map. After execution of the code shown above, <code>BPF_REG_8</code> and <code>BPF_REG_9</code> are set to the values from map1[1] and map1[2] respectively. They will be used as operands for <code>BPF_RSH</code>. The final <code>BPF_GET_MAP</code> shown above loads <code>BPF_REG_0</code> with a pointer to map2[0].</p>
<p>The next step is to get the verifier to recognize that the operands to <code>BPF_RSH</code> will be bounded within a certain range. Here are the opcodes to limit the range of the registers by using branches.</p>
</div></div><div class="sqs-block embed-block sqs-block-embed" data-block-json="{&quot;hSize&quot;:null,&quot;floatDir&quot;:null,&quot;html&quot;:&quot;&lt;script src=\&quot;https://gist.github.com/9fabb4d53bbe4ea560547b19d94dc911.js\&quot;&gt;&lt;/script&gt;&quot;,&quot;resolvedBy&quot;:&quot;manual&quot;,&quot;resolved&quot;:true}" data-block-type="22" id="block-yui_3_17_2_1_1611003168001_34280"><div class="sqs-block-content" id="yui_3_17_2_1_1638470369736_78" style="visibility: visible; opacity: 1; height: auto;"><script src="./2021 - ZDI-20-1440 An Incorrect Calculation Bug in the Linux Kernel eBPF Verifier_files/9fabb4d53bbe4ea560547b19d94dc911.js.下載"></script><link rel="stylesheet" href="./2021 - ZDI-20-1440 An Incorrect Calculation Bug in the Linux Kernel eBPF Verifier_files/gist-embed-ff75a167df5efbfedb0e388793ca9fe7.css"><div id="gist107408096" class="gist">
    <div class="gist-file" translate="no">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-zdi-20-1440-snippet-5-cpp" class="file my-2">
    
  <div itemprop="text" class="Box-body p-0 blob-wrapper data type-c  ">

      
<div class="js-check-bidi blob-code-content">
  <template class="js-file-alert-template"></template>
<template class="js-line-alert-template"></template>

  <table class="highlight tab-size js-file-line-container js-code-nav-container js-tagsearch-file" data-tab-size="8" data-paste-markdown-skip="" data-tagsearch-lang="C++" data-tagsearch-path="ZDI-20-1440-snippet-5.cpp">
        <tbody><tr>
          <td id="file-zdi-20-1440-snippet-5-cpp-L1" class="blob-num js-line-number js-code-nav-line-number" data-line-number="1"></td>
          <td id="file-zdi-20-1440-snippet-5-cpp-LC1" class="blob-code blob-code-inner js-file-line"><span class="pl-en">BPF_JMP_IMM</span>(BPF_JGE, BPF_REG_8, <span class="pl-c1">0</span>, <span class="pl-c1">1</span>), </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-5-cpp-L2" class="blob-num js-line-number js-code-nav-line-number" data-line-number="2"></td>
          <td id="file-zdi-20-1440-snippet-5-cpp-LC2" class="blob-code blob-code-inner js-file-line">BPF_JMP_IMM(BPF_JA, <span class="pl-c1">0</span>, <span class="pl-c1">0</span>, <span class="pl-c1">9</span>), </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-5-cpp-L3" class="blob-num js-line-number js-code-nav-line-number" data-line-number="3"></td>
          <td id="file-zdi-20-1440-snippet-5-cpp-LC3" class="blob-code blob-code-inner js-file-line">BPF_JMP_IMM(BPF_JGE, BPF_REG_8, <span class="pl-c1">0x1000</span>, <span class="pl-c1">8</span>), </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-5-cpp-L4" class="blob-num js-line-number js-code-nav-line-number" data-line-number="4"></td>
          <td id="file-zdi-20-1440-snippet-5-cpp-LC4" class="blob-code blob-code-inner js-file-line"> </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-5-cpp-L5" class="blob-num js-line-number js-code-nav-line-number" data-line-number="5"></td>
          <td id="file-zdi-20-1440-snippet-5-cpp-LC5" class="blob-code blob-code-inner js-file-line">BPF_JMP_IMM(BPF_JGE, BPF_REG_9, <span class="pl-c1">0</span>, <span class="pl-c1">1</span>), </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-5-cpp-L6" class="blob-num js-line-number js-code-nav-line-number" data-line-number="6"></td>
          <td id="file-zdi-20-1440-snippet-5-cpp-LC6" class="blob-code blob-code-inner js-file-line">BPF_JMP_IMM(BPF_JA, <span class="pl-c1">0</span>, <span class="pl-c1">0</span>, <span class="pl-c1">5</span>), </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-5-cpp-L7" class="blob-num js-line-number js-code-nav-line-number" data-line-number="7"></td>
          <td id="file-zdi-20-1440-snippet-5-cpp-LC7" class="blob-code blob-code-inner js-file-line">BPF_JMP_IMM(BPF_JGE, BPF_REG_9, <span class="pl-c1">1024</span>, <span class="pl-c1">4</span>),</td>
        </tr>
  </tbody></table>
</div>


  </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/zdi-team/9fabb4d53bbe4ea560547b19d94dc911/raw/080b65fabda6918c5b7d6e74919c3fe96ddc03a3/ZDI-20-1440-snippet-5.cpp" style="float:right">view raw</a>
        <a href="https://gist.github.com/zdi-team/9fabb4d53bbe4ea560547b19d94dc911#file-zdi-20-1440-snippet-5-cpp">
          ZDI-20-1440-snippet-5.cpp
        </a>
        hosted with ❤ by <a href="https://github.com/">GitHub</a>
      </div>
    </div>
</div>
</div></div><div class="sqs-block markdown-block sqs-block-markdown" data-block-type="44" id="block-yui_3_17_2_1_1611003168001_35293"><div class="sqs-block-content"><p>The verifier will correctly deduce that execution cannot fall through past these instructions unless <code>0 &lt;= REG_8 &lt;= 0x1000</code> and <code>0 &lt;= REG_9 &lt;= 1024</code>. (Note that <code>JA</code> means “jump always”, not “jump if above” as in x86.)</p>
<p>It's time to trigger the bug.</p>
</div></div><div class="sqs-block embed-block sqs-block-embed" data-block-json="{&quot;hSize&quot;:null,&quot;floatDir&quot;:null,&quot;html&quot;:&quot;&lt;script src=\&quot;https://gist.github.com/da6775b5a68c0be4c7ed1d291036cb2b.js\&quot;&gt;&lt;/script&gt;&quot;,&quot;resolvedBy&quot;:&quot;manual&quot;,&quot;resolved&quot;:true}" data-block-type="22" id="block-yui_3_17_2_1_1611003168001_36306"><div class="sqs-block-content" id="yui_3_17_2_1_1638470369736_81" style="visibility: visible; opacity: 1; height: auto;"><script src="./2021 - ZDI-20-1440 An Incorrect Calculation Bug in the Linux Kernel eBPF Verifier_files/da6775b5a68c0be4c7ed1d291036cb2b.js.下載"></script><link rel="stylesheet" href="./2021 - ZDI-20-1440 An Incorrect Calculation Bug in the Linux Kernel eBPF Verifier_files/gist-embed-ff75a167df5efbfedb0e388793ca9fe7.css"><div id="gist107408100" class="gist">
    <div class="gist-file" translate="no">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-zdi-20-1440-snippet-6-cpp" class="file my-2">
    
  <div itemprop="text" class="Box-body p-0 blob-wrapper data type-c  ">

      
<div class="js-check-bidi blob-code-content">
  <template class="js-file-alert-template"></template>
<template class="js-line-alert-template"></template>

  <table class="highlight tab-size js-file-line-container js-code-nav-container js-tagsearch-file" data-tab-size="8" data-paste-markdown-skip="" data-tagsearch-lang="C++" data-tagsearch-path="ZDI-20-1440-snippet-6.cpp">
        <tbody><tr>
          <td id="file-zdi-20-1440-snippet-6-cpp-L1" class="blob-num js-line-number js-code-nav-line-number" data-line-number="1"></td>
          <td id="file-zdi-20-1440-snippet-6-cpp-LC1" class="blob-code blob-code-inner js-file-line"><span class="pl-en">BPF_ALU64_REG</span>(BPF_RSH, BPF_REG_8, BPF_REG_9), </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-6-cpp-L2" class="blob-num js-line-number js-code-nav-line-number" data-line-number="2"></td>
          <td id="file-zdi-20-1440-snippet-6-cpp-LC2" class="blob-code blob-code-inner js-file-line">BPF_ALU64_REG(BPF_ADD, BPF_REG_0, BPF_REG_8), <span class="pl-c"><span class="pl-c">//</span> (A) </span></td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-6-cpp-L3" class="blob-num js-line-number js-code-nav-line-number" data-line-number="3"></td>
          <td id="file-zdi-20-1440-snippet-6-cpp-LC3" class="blob-code blob-code-inner js-file-line">BPF_MOV64_IMM(BPF_REG_1, <span class="pl-c1">0xdeadbeef</span>), </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-6-cpp-L4" class="blob-num js-line-number js-code-nav-line-number" data-line-number="4"></td>
          <td id="file-zdi-20-1440-snippet-6-cpp-LC4" class="blob-code blob-code-inner js-file-line">BPF_STX_MEM(BPF_DW, BPF_REG_0, BPF_REG_1, <span class="pl-c1">0</span>), <span class="pl-c"><span class="pl-c">//</span> (B) </span></td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-6-cpp-L5" class="blob-num js-line-number js-code-nav-line-number" data-line-number="5"></td>
          <td id="file-zdi-20-1440-snippet-6-cpp-LC5" class="blob-code blob-code-inner js-file-line">BPF_MOV64_IMM(BPF_REG_0, <span class="pl-c1">0</span>), </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-6-cpp-L6" class="blob-num js-line-number js-code-nav-line-number" data-line-number="6"></td>
          <td id="file-zdi-20-1440-snippet-6-cpp-LC6" class="blob-code blob-code-inner js-file-line">BPF_EXIT_INSN(),</td>
        </tr>
  </tbody></table>
</div>


  </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/zdi-team/da6775b5a68c0be4c7ed1d291036cb2b/raw/fa1debf070d146b0d5491a3c4831f3569cfb7d4b/ZDI-20-1440-snippet-6.cpp" style="float:right">view raw</a>
        <a href="https://gist.github.com/zdi-team/da6775b5a68c0be4c7ed1d291036cb2b#file-zdi-20-1440-snippet-6-cpp">
          ZDI-20-1440-snippet-6.cpp
        </a>
        hosted with ❤ by <a href="https://github.com/">GitHub</a>
      </div>
    </div>
</div>
</div></div><div class="sqs-block markdown-block sqs-block-markdown" data-block-type="44" id="block-yui_3_17_2_1_1611003168001_37314"><div class="sqs-block-content"><p>After the <code>BPF_RSH</code> instruction, <code>BPF_REG_8</code> can still have a value as high as 0x1000. But due to the incorrect computation discussed above, the verifier concludes that the maximum possible value of <code>BPF_REG_8</code> is now 0. On the basis of this, the verifier incorrectly concludes that the memory operation at (B) is guaranteed to be safe.</p>
<p><code>BPF_STX_MEM</code> at (B) will perform an OOB write on map2 with an arbitrary offset specified by <code>BPF_REG_8</code>.</p>
<p>However, there is one additional precondition. Recall from above that when encountering an instruction that operates on memory, the verifier performs checks in a function named <code>check_mem_access()</code>. When the address of the memory operation is controlled by a register, <code>check_mem_access()</code> additionally ensures that the verifier has already marked the register contents as <code>PTR_TO_MAP_VALUE</code> or <code>PTR_TO_MAP_VALUE_ADJ</code>. The verifier will only set this mark if the <code>allow_ptr_leaks</code> flag is enabled in the environment, and to enable this flag, the caller must have the <code>CAP_SYS_ADMIN</code> capability.</p>
</div></div><div class="sqs-block embed-block sqs-block-embed" data-block-json="{&quot;hSize&quot;:null,&quot;floatDir&quot;:null,&quot;html&quot;:&quot;&lt;script src=\&quot;https://gist.github.com/c1237a406537f97e8314acde849bf57e.js\&quot;&gt;&lt;/script&gt;&quot;,&quot;resolvedBy&quot;:&quot;manual&quot;,&quot;resolved&quot;:true}" data-block-type="22" id="block-yui_3_17_2_1_1611003168001_38416"><div class="sqs-block-content" id="yui_3_17_2_1_1638470369736_84" style="visibility: visible; opacity: 1; height: auto;"><script src="./2021 - ZDI-20-1440 An Incorrect Calculation Bug in the Linux Kernel eBPF Verifier_files/c1237a406537f97e8314acde849bf57e.js.下載"></script><link rel="stylesheet" href="./2021 - ZDI-20-1440 An Incorrect Calculation Bug in the Linux Kernel eBPF Verifier_files/gist-embed-ff75a167df5efbfedb0e388793ca9fe7.css"><div id="gist107408102" class="gist">
    <div class="gist-file" translate="no">
      <div class="gist-data">
        <div class="js-gist-file-update-container js-task-list-container file-box">
  <div id="file-zdi-20-1440-snippet-7-cpp" class="file my-2">
    
  <div itemprop="text" class="Box-body p-0 blob-wrapper data type-c  ">

      
<div class="js-check-bidi blob-code-content">
  <template class="js-file-alert-template"></template>
<template class="js-line-alert-template"></template>

  <table class="highlight tab-size js-file-line-container js-code-nav-container js-tagsearch-file" data-tab-size="8" data-paste-markdown-skip="" data-tagsearch-lang="C++" data-tagsearch-path="ZDI-20-1440-snippet-7.cpp">
        <tbody><tr>
          <td id="file-zdi-20-1440-snippet-7-cpp-L1" class="blob-num js-line-number js-code-nav-line-number" data-line-number="1"></td>
          <td id="file-zdi-20-1440-snippet-7-cpp-LC1" class="blob-code blob-code-inner js-file-line"><span class="pl-k">static</span> <span class="pl-k">int</span> <span class="pl-en">check_mem_access</span>(<span class="pl-k">struct</span> <span class="pl-en">bpf_verifier_env</span> *env, <span class="pl-k">int</span> insn_idx, u32 regno, <span class="pl-k">int</span> off, </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-7-cpp-L2" class="blob-num js-line-number js-code-nav-line-number" data-line-number="2"></td>
          <td id="file-zdi-20-1440-snippet-7-cpp-LC2" class="blob-code blob-code-inner js-file-line">                <span class="pl-k">int</span> bpf_size, <span class="pl-k">enum</span> bpf_access_type t, </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-7-cpp-L3" class="blob-num js-line-number js-code-nav-line-number" data-line-number="3"></td>
          <td id="file-zdi-20-1440-snippet-7-cpp-LC3" class="blob-code blob-code-inner js-file-line">                <span class="pl-k">int</span> value_regno) </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-7-cpp-L4" class="blob-num js-line-number js-code-nav-line-number" data-line-number="4"></td>
          <td id="file-zdi-20-1440-snippet-7-cpp-LC4" class="blob-code blob-code-inner js-file-line">{ </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-7-cpp-L5" class="blob-num js-line-number js-code-nav-line-number" data-line-number="5"></td>
          <td id="file-zdi-20-1440-snippet-7-cpp-LC5" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">//</span> ... </span></td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-7-cpp-L6" class="blob-num js-line-number js-code-nav-line-number" data-line-number="6"></td>
          <td id="file-zdi-20-1440-snippet-7-cpp-LC6" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">if</span> (reg-&gt;<span class="pl-smi">type</span> == PTR_TO_MAP_VALUE || reg-&gt;<span class="pl-smi">type</span> == PTR_TO_MAP_VALUE_ADJ) { </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-7-cpp-L7" class="blob-num js-line-number js-code-nav-line-number" data-line-number="7"></td>
          <td id="file-zdi-20-1440-snippet-7-cpp-LC7" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">//</span> ... </span></td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-7-cpp-L8" class="blob-num js-line-number js-code-nav-line-number" data-line-number="8"></td>
          <td id="file-zdi-20-1440-snippet-7-cpp-LC8" class="blob-code blob-code-inner js-file-line">            err = <span class="pl-c1">check_map_access</span>(env, regno, off, size); </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-7-cpp-L9" class="blob-num js-line-number js-code-nav-line-number" data-line-number="9"></td>
          <td id="file-zdi-20-1440-snippet-7-cpp-LC9" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">//</span> ... </span></td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-7-cpp-L10" class="blob-num js-line-number js-code-nav-line-number" data-line-number="10"></td>
          <td id="file-zdi-20-1440-snippet-7-cpp-LC10" class="blob-code blob-code-inner js-file-line">        } </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-7-cpp-L11" class="blob-num js-line-number js-code-nav-line-number" data-line-number="11"></td>
          <td id="file-zdi-20-1440-snippet-7-cpp-LC11" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">//</span> ... </span></td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-7-cpp-L12" class="blob-num js-line-number js-code-nav-line-number" data-line-number="12"></td>
          <td id="file-zdi-20-1440-snippet-7-cpp-LC12" class="blob-code blob-code-inner js-file-line">} </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-7-cpp-L13" class="blob-num js-line-number js-code-nav-line-number" data-line-number="13"></td>
          <td id="file-zdi-20-1440-snippet-7-cpp-LC13" class="blob-code blob-code-inner js-file-line"> </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-7-cpp-L14" class="blob-num js-line-number js-code-nav-line-number" data-line-number="14"></td>
          <td id="file-zdi-20-1440-snippet-7-cpp-LC14" class="blob-code blob-code-inner js-file-line"><span class="pl-k">static</span> <span class="pl-k">int</span> <span class="pl-en">check_alu_op</span>(<span class="pl-k">struct</span> <span class="pl-en">bpf_verifier_env</span> *env, <span class="pl-k">struct</span> <span class="pl-en">bpf_insn</span> *insn) </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-7-cpp-L15" class="blob-num js-line-number js-code-nav-line-number" data-line-number="15"></td>
          <td id="file-zdi-20-1440-snippet-7-cpp-LC15" class="blob-code blob-code-inner js-file-line">{ </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-7-cpp-L16" class="blob-num js-line-number js-code-nav-line-number" data-line-number="16"></td>
          <td id="file-zdi-20-1440-snippet-7-cpp-LC16" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">//</span> ... </span></td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-7-cpp-L17" class="blob-num js-line-number js-code-nav-line-number" data-line-number="17"></td>
          <td id="file-zdi-20-1440-snippet-7-cpp-LC17" class="blob-code blob-code-inner js-file-line">        <span class="pl-k">if</span> (env-&gt;<span class="pl-smi">allow_ptr_leaks</span> &amp;&amp; </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-7-cpp-L18" class="blob-num js-line-number js-code-nav-line-number" data-line-number="18"></td>
          <td id="file-zdi-20-1440-snippet-7-cpp-LC18" class="blob-code blob-code-inner js-file-line">            <span class="pl-c1">BPF_CLASS</span>(insn-&gt;<span class="pl-smi">code</span>) == BPF_ALU64 &amp;&amp; opcode == BPF_ADD &amp;&amp; </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-7-cpp-L19" class="blob-num js-line-number js-code-nav-line-number" data-line-number="19"></td>
          <td id="file-zdi-20-1440-snippet-7-cpp-LC19" class="blob-code blob-code-inner js-file-line">            (dst_reg-&gt;<span class="pl-smi">type</span> == PTR_TO_MAP_VALUE || </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-7-cpp-L20" class="blob-num js-line-number js-code-nav-line-number" data-line-number="20"></td>
          <td id="file-zdi-20-1440-snippet-7-cpp-LC20" class="blob-code blob-code-inner js-file-line">             dst_reg-&gt;<span class="pl-smi">type</span> == PTR_TO_MAP_VALUE_ADJ)) </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-7-cpp-L21" class="blob-num js-line-number js-code-nav-line-number" data-line-number="21"></td>
          <td id="file-zdi-20-1440-snippet-7-cpp-LC21" class="blob-code blob-code-inner js-file-line">            dst_reg-&gt;<span class="pl-smi">type</span> = PTR_TO_MAP_VALUE_ADJ; </td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-7-cpp-L22" class="blob-num js-line-number js-code-nav-line-number" data-line-number="22"></td>
          <td id="file-zdi-20-1440-snippet-7-cpp-LC22" class="blob-code blob-code-inner js-file-line"><span class="pl-c"><span class="pl-c">//</span> ... </span></td>
        </tr>
        <tr>
          <td id="file-zdi-20-1440-snippet-7-cpp-L23" class="blob-num js-line-number js-code-nav-line-number" data-line-number="23"></td>
          <td id="file-zdi-20-1440-snippet-7-cpp-LC23" class="blob-code blob-code-inner js-file-line">}</td>
        </tr>
  </tbody></table>
</div>


  </div>

  </div>
</div>

      </div>
      <div class="gist-meta">
        <a href="https://gist.github.com/zdi-team/c1237a406537f97e8314acde849bf57e/raw/41fd82621b6beda6b9527ed6a6c705ea79d26f87/ZDI-20-1440-snippet-7.cpp" style="float:right">view raw</a>
        <a href="https://gist.github.com/zdi-team/c1237a406537f97e8314acde849bf57e#file-zdi-20-1440-snippet-7-cpp">
          ZDI-20-1440-snippet-7.cpp
        </a>
        hosted with ❤ by <a href="https://github.com/">GitHub</a>
      </div>
    </div>
</div>
</div></div><div class="sqs-block markdown-block sqs-block-markdown" data-block-type="44" id="block-yui_3_17_2_1_1611003168001_39426"><div class="sqs-block-content"><p>This means <code>CAP_SYS_ADMIN</code> is required to trigger the bug, even if the eBPF program is attached to a socket owned by the attacker.</p>
</div></div><div class="sqs-block html-block sqs-block-html" data-block-type="2" id="block-yui_3_17_2_1_1611003168001_40380"><div class="sqs-block-content"><p class="" style="white-space:pre-wrap;"><strong>Conclusion</strong></p><p class="" style="white-space:pre-wrap;">Although the precondition reduces the impact and risk, it would still be better to apply this&nbsp;<a href="https://lwn.net/Articles/742170/" target="_blank">mitigation</a>, or even better, upgrade the kernel to an unaffected version. Our team will try to follow up on the patch when it is released. Thanks again to Ryota Shiga of Flatt Security for submitting this bug. He’s submitted a few other reports to the program, and each has been great. We hope to see more from him in the future.</p><p class="" style="white-space:pre-wrap;">You can find me on Twitter&nbsp;<a href="https://twitter.com/_wmliang_" target="_blank">@_wmliang_</a>, and follow the&nbsp;<a href="https://twitter.com/thezdi" target="_blank">team</a>&nbsp;for the latest in exploit techniques and security patches.</p></div></div></div></div></div>
                      </div>

                       
                        <ul class="blog-tags">
                          
                            <!--TAGS-->
                            
                              <li><a class="tag" href="https://www.zerodayinitiative.com/blog?tag=Linux">Linux</a></li>
                            
                              <li><a class="tag" href="https://www.zerodayinitiative.com/blog?tag=Research">Research</a></li>
                            
                              <li><a class="tag" href="https://www.zerodayinitiative.com/blog?tag=0-day">0-day</a>
                          
                        </li></ul>
                      
                   
                    
                </div>
                <div class="contentBlockImage">
                    <div class="blog-actions">
                        <a href="https://www.zerodayinitiative.com/blog" class="btn mediumButton back-btn">BACK TO THE BLOG</a>
                        <ul class="social-share">
                            <a class="icon-heart" title="Like this">
  <span class="sqs-simple-like" data-item-id="" data-like-count="">
    <span class="like-icon"></span>
    <span class="like-count"></span>
  </span>
</a>
                            <a class="icon-share" title="Share"><span class="squarespace-social-buttons inline-style" data-system-data-id="" data-asset-url="" data-record-type="" data-full-url="" data-title=""><div id="social-yui_3_17_2_1_1638470369736_115" class="yui3-widget yui3-socialbutton"><div id="yui_3_17_2_1_1638470369736_120" class="yui3-socialbutton-content"><div class="ss-social-button-wrapper"><div class="ss-social-button"><span class="ss-social-button-icon"></span>Share</div></div><div class="ss-social-list-wrapper"><div class="ss-social-button-list"></div></div></div></div></span></a>

                            <!-- <li><a href="#" class="twitter-share"><img src="/assets/twitterIcon.svg" alt="Twitter" /></a></li>
                            <li><a href="#" class="facebook-share"><img src="/assets/facebookIcon.svg" alt="Facebook" /></a></li>
                            <li><a href="#" class="linkedin-share"><img src="/assets/linkedinIcon.svg" alt="Linkedin" /></a></li> -->
                        </ul>
                    </div>  
                </div>
            </div><!-- /. contentBlock -->
        </div>

        <div class="section blog-listing-details">
            <div class="threeCols">

                <!-- get recent blog post -->
                  

                      <div class="column">
                        <div class="content">
                          <div class="thumb">
                              
                                
                                    <a href="https://www.zerodayinitiative.com/blog/2021/11/17/mindshare-using-io-ninja-to-analyze-npfs" style="background: url(&#39;https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1637178187892-UJSEMAP2T6RTXUHWUOQM/MindshaRE.jpg&#39;) no-repeat;"></a>
                                

                              
                          </div>
                        </div>
                        <h3 class="title" data-content-field="title">
                          
                            <a href="https://www.zerodayinitiative.com/blog/2021/11/17/mindshare-using-io-ninja-to-analyze-npfs">MindShaRE: Using IO Ninja to Analyze NPFS </a>
                          
                        </h3>
                         
                          <div class="listing-tags">
                            
                              <!--TAGS-->
                              
                                <a class="tag" href="https://www.zerodayinitiative.com/?tag=MindshaRE">MindshaRE</a>,
                              
                                <a class="tag" href="https://www.zerodayinitiative.com/?tag=IO+Ninja">IO Ninja</a>
                            
                          </div>
                        
                      </div>

                  

                      <div class="column">
                        <div class="content">
                          <div class="thumb">
                              
                                
                                    <a href="https://www.zerodayinitiative.com/blog/2021/11/9/the-november-2021-security-update-review" style="background: url(&#39;https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1636477385395-H64L80OUYGZUIXPDTB21/TitleCard.png&#39;) no-repeat;"></a>
                                

                              
                          </div>
                        </div>
                        <h3 class="title" data-content-field="title">
                          
                            <a href="https://www.zerodayinitiative.com/blog/2021/11/9/the-november-2021-security-update-review">The November 2021 Security Update Review</a>
                          
                        </h3>
                         
                          <div class="listing-tags">
                            
                              <!--TAGS-->
                              
                                <a class="tag" href="https://www.zerodayinitiative.com/?tag=Adobe">Adobe</a>,
                              
                                <a class="tag" href="https://www.zerodayinitiative.com/?tag=Microsoft">Microsoft</a>,
                              
                                <a class="tag" href="https://www.zerodayinitiative.com/?tag=Security+Patch">Security Patch</a>
                            
                          </div>
                        
                      </div>

                  

                      <div class="column">
                        <div class="content">
                          <div class="thumb">
                              
                                
                                    <a href="https://www.zerodayinitiative.com/blog/2021/11/1/pwn2ownaustin" style="background: url(&#39;https://images.squarespace-cdn.com/content/v1/5894c269e4fcb5e65a1ed623/1635624582038-MC1P37R1DIBYBG6TQ1WA/P2OAustin-02.jpg&#39;) no-repeat;"></a>
                                

                              
                          </div>
                        </div>
                        <h3 class="title" data-content-field="title">
                          
                            <a href="https://www.zerodayinitiative.com/blog/2021/11/1/pwn2ownaustin">Pwn2Own Austin 2021 - Schedule and Live Results</a>
                          
                        </h3>
                         
                          <div class="listing-tags">
                            
                              <!--TAGS-->
                              
                                <a class="tag" href="https://www.zerodayinitiative.com/?tag=Pwn2Own">Pwn2Own</a>,
                              
                                <a class="tag" href="https://www.zerodayinitiative.com/?tag=Western+Digital">Western Digital</a>,
                              
                                <a class="tag" href="https://www.zerodayinitiative.com/?tag=Synology">Synology</a>,
                              
                                <a class="tag" href="https://www.zerodayinitiative.com/?tag=Cisco">Cisco</a>,
                              
                                <a class="tag" href="https://www.zerodayinitiative.com/?tag=TPLink">TPLink</a>,
                              
                                <a class="tag" href="https://www.zerodayinitiative.com/?tag=NETGEAR">NETGEAR</a>,
                              
                                <a class="tag" href="https://www.zerodayinitiative.com/?tag=Samsung">Samsung</a>
                            
                          </div>
                        
                      </div>

                  

            </div>
        </div>
    </div><!-- /. blog-listing -->
</div>
          </div>
        </section>

        
        
        

        

        <!--FOOTER WITH OPEN BLOCK FIELD-->
        <footer id="footer">
          <div id="footerContact">
    <div class="content">
        <div class="footerContactBox">
            <h3>General Inquiries</h3>
            <a href="mailto:zdi@trendmicro.com">zdi@trendmicro.com</a>
        </div>
        <div class="footerContactBox">
            <h3>Find us on Twitter</h3>
            <a href="https://twitter.com/thezdi" target="_blank">@thezdi</a>
        </div>
        <div class="footerContactBox">
            <h3>Media Inquiries</h3>
            <a href="mailto:media_relations@trendmicro.com">media_relations@trendmicro.com</a>
        </div>
        <div class="footerContactBox">
            <h3>Sensitive Email Communications</h3>
            <a href="https://www.zerodayinitiative.com/documents/zdi-pgp-key.asc" target="_blank">PGP Key</a>
        </div>
    </div>
</div>

<div id="footerMenu">
    <div id="footerMiddleSection" class="group">
        <div id="footerLinks">
            <div class="content">
                <div class="footerLinkBox">
                            <a href="https://www.zerodayinitiative.com/about" class="footerTitleLink">WHO WE ARE</a>
                            <ul>
                                <li><a href="https://www.zerodayinitiative.com/about">Our Mission</a></li>
                                <li><a href="https://www.trendmicro.com/">Trend Micro</a></li>
                                <li><a href="https://www.trendmicro.com/en_us/business/products/network/integrated-atp/next-gen-intrusion-prevention-system.html">TippingPoint IPS</a></li>
                            </ul>
                        </div>
                        <div class="footerLinkBox">
                            <a href="https://www.zerodayinitiative.com/about/benefits" class="footerTitleLink">HOW IT WORKS</a>
                            <ul>
                                <li><a href="https://www.zerodayinitiative.com/about/benefits#process">Process</a></li>
                                <li><a href="https://www.zerodayinitiative.com/about/benefits#researcher-rewards">Researcher Rewards</a></li>
                                <li><a href="https://www.zerodayinitiative.com/about/faq">FAQS</a></li>
                                <li><a href="https://www.trendmicro.com/privacy">Privacy</a></li>
                            </ul>
                        </div>
                        <div class="footerLinkBox">
                            <a href="https://www.zerodayinitiative.com/advisories" class="footerTitleLink">ADVISORIES</a>
                            <ul>
                                <li><a href="https://www.zerodayinitiative.com/advisories/published">Published Advisories</a></li>
                                <li><a href="https://www.zerodayinitiative.com/advisories/upcoming">Upcoming Advisories</a></li>
                                <li><a href="https://www.zerodayinitiative.com/rss">RSS Feeds</a></li>
                            </ul>
                        </div>
                        <div class="footerLinkBox">
                            <a href="https://www.zerodayinitiative.com/blog" class="footerTitleLink">BLOG</a>
                        </div>

                        <div class="footerLogo">
                            <a href="https://www.zerodayinitiative.com/"><img src="./2021 - ZDI-20-1440 An Incorrect Calculation Bug in the Linux Kernel eBPF Verifier_files/logo-footer.svg" alt="thezdi"></a>
                        </div>
            </div>
        </div>
    </div>
</div>
        </footer>

        

    <!--INJECTION POINT FOR TRACKING SCRIPTS AND USER CONTENT FROM THE CODE INJECTION TAB-->

    <script type="text/javascript" data-sqs-type="imageloader-bootstrapper">(function() {if(window.ImageLoader) { window.ImageLoader.bootstrap({}, document); }})();</script><script>Squarespace.afterBodyLoad(Y);</script><svg xmlns="http://www.w3.org/2000/svg" version="1.1" style="display:none" data-usage="social-icons-svg"><symbol id="twitter-icon" viewBox="0 0 64 64"><path d="M48,22.1c-1.2,0.5-2.4,0.9-3.8,1c1.4-0.8,2.4-2.1,2.9-3.6c-1.3,0.8-2.7,1.3-4.2,1.6 C41.7,19.8,40,19,38.2,19c-3.6,0-6.6,2.9-6.6,6.6c0,0.5,0.1,1,0.2,1.5c-5.5-0.3-10.3-2.9-13.5-6.9c-0.6,1-0.9,2.1-0.9,3.3 c0,2.3,1.2,4.3,2.9,5.5c-1.1,0-2.1-0.3-3-0.8c0,0,0,0.1,0,0.1c0,3.2,2.3,5.8,5.3,6.4c-0.6,0.1-1.1,0.2-1.7,0.2c-0.4,0-0.8,0-1.2-0.1 c0.8,2.6,3.3,4.5,6.1,4.6c-2.2,1.8-5.1,2.8-8.2,2.8c-0.5,0-1.1,0-1.6-0.1c2.9,1.9,6.4,2.9,10.1,2.9c12.1,0,18.7-10,18.7-18.7 c0-0.3,0-0.6,0-0.8C46,24.5,47.1,23.4,48,22.1z"></path></symbol><symbol id="twitter-mask" viewBox="0 0 64 64"><path d="M0,0v64h64V0H0z M44.7,25.5c0,0.3,0,0.6,0,0.8C44.7,35,38.1,45,26.1,45c-3.7,0-7.2-1.1-10.1-2.9 c0.5,0.1,1,0.1,1.6,0.1c3.1,0,5.9-1,8.2-2.8c-2.9-0.1-5.3-2-6.1-4.6c0.4,0.1,0.8,0.1,1.2,0.1c0.6,0,1.2-0.1,1.7-0.2 c-3-0.6-5.3-3.3-5.3-6.4c0,0,0-0.1,0-0.1c0.9,0.5,1.9,0.8,3,0.8c-1.8-1.2-2.9-3.2-2.9-5.5c0-1.2,0.3-2.3,0.9-3.3 c3.2,4,8.1,6.6,13.5,6.9c-0.1-0.5-0.2-1-0.2-1.5c0-3.6,2.9-6.6,6.6-6.6c1.9,0,3.6,0.8,4.8,2.1c1.5-0.3,2.9-0.8,4.2-1.6 c-0.5,1.5-1.5,2.8-2.9,3.6c1.3-0.2,2.6-0.5,3.8-1C47.1,23.4,46,24.5,44.7,25.5z"></path></symbol><symbol id="youtube-icon" viewBox="0 0 64 64"><path d="M46.7,26c0,0-0.3-2.1-1.2-3c-1.1-1.2-2.4-1.2-3-1.3C38.3,21.4,32,21.4,32,21.4h0 c0,0-6.3,0-10.5,0.3c-0.6,0.1-1.9,0.1-3,1.3c-0.9,0.9-1.2,3-1.2,3S17,28.4,17,30.9v2.3c0,2.4,0.3,4.9,0.3,4.9s0.3,2.1,1.2,3 c1.1,1.2,2.6,1.2,3.3,1.3c2.4,0.2,10.2,0.3,10.2,0.3s6.3,0,10.5-0.3c0.6-0.1,1.9-0.1,3-1.3c0.9-0.9,1.2-3,1.2-3s0.3-2.4,0.3-4.9 v-2.3C47,28.4,46.7,26,46.7,26z M28.9,35.9l0-8.4l8.1,4.2L28.9,35.9z"></path></symbol><symbol id="youtube-mask" viewBox="0 0 64 64"><path d="M0,0v64h64V0H0z M47,33.1c0,2.4-0.3,4.9-0.3,4.9s-0.3,2.1-1.2,3c-1.1,1.2-2.4,1.2-3,1.3 C38.3,42.5,32,42.6,32,42.6s-7.8-0.1-10.2-0.3c-0.7-0.1-2.2-0.1-3.3-1.3c-0.9-0.9-1.2-3-1.2-3S17,35.6,17,33.1v-2.3 c0-2.4,0.3-4.9,0.3-4.9s0.3-2.1,1.2-3c1.1-1.2,2.4-1.2,3-1.3c4.2-0.3,10.5-0.3,10.5-0.3h0c0,0,6.3,0,10.5,0.3c0.6,0.1,1.9,0.1,3,1.3 c0.9,0.9,1.2,3,1.2,3s0.3,2.4,0.3,4.9V33.1z M28.9,35.9l8.1-4.2l-8.1-4.2L28.9,35.9z"></path></symbol></svg>
    </div> <!-- end #innerWrapper -->
    </div> <!-- end #outerWrapper -->
    <script src="./2021 - ZDI-20-1440 An Incorrect Calculation Bug in the Linux Kernel eBPF Verifier_files/main.js.下載">
  </body>

</html>
</script></body></html>