<!DOCTYPE html>
<!-- saved from url=(0117)https://blog.includesecurity.com/2014/06/exploiting-cve-2014-0196-a-walk-through-of-the-linux-pty-race-condition-poc/ -->
<html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	
	<link rel="profile" href="https://gmpg.org/xfn/11">
	<meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1">

	<!-- This site is optimized with the Yoast SEO plugin v17.7.1 - https://yoast.com/wordpress/plugins/seo/ -->
	<title>Exploiting CVE-2014-0196 a walk-through of the Linux pty race condition PoC - Include Security Research Blog</title>
	<link rel="canonical" href="https://blog.includesecurity.com/2014/06/exploiting-cve-2014-0196-a-walk-through-of-the-linux-pty-race-condition-poc/">
	<meta property="og:locale" content="en_US">
	<meta property="og:type" content="article">
	<meta property="og:title" content="Exploiting CVE-2014-0196 a walk-through of the Linux pty race condition PoC - Include Security Research Blog">
	<meta property="og:description" content="Introduction Recently a severe vulnerability in the Linux kernel was publicly disclosed and patched. In this post we’ll analyze what this particular security vulnerability looks like in the Linux kernel code and walk you through the publicly published proof-of-concept exploit code by Matthew Daley released May 12th 2014. The original post by the SUSE security team ... Read more">
	<meta property="og:url" content="https://blog.includesecurity.com/2014/06/exploiting-cve-2014-0196-a-walk-through-of-the-linux-pty-race-condition-poc/">
	<meta property="og:site_name" content="Include Security Research Blog">
	<meta property="article:published_time" content="2014-06-03T18:24:00+00:00">
	<meta property="article:modified_time" content="2021-02-18T16:22:12+00:00">
	<meta name="twitter:card" content="summary_large_image">
	<meta name="twitter:creator" content="@includesecurity">
	<meta name="twitter:site" content="@includesecurity">
	<meta name="twitter:label1" content="Written by">
	<meta name="twitter:data1" content="by Samuel Groß">
	<meta name="twitter:label2" content="Est. reading time">
	<meta name="twitter:data2" content="16 minutes">
	<script type="application/ld+json" class="yoast-schema-graph">{"@context":"https://schema.org","@graph":[{"@type":"Organization","@id":"https://blog.includesecurity.com/#organization","name":"Include Security","url":"https://blog.includesecurity.com/","sameAs":["https://www.linkedin.com/company/include-security-llc","https://www.youtube.com/user/IncludeSecurity","https://twitter.com/includesecurity"],"logo":{"@type":"ImageObject","@id":"https://blog.includesecurity.com/#logo","inLanguage":"en-US","url":"https://i2.wp.com/blog.includesecurity.com/wp-content/uploads/2021/02/includesec.png?fit=151%2C151&ssl=1","contentUrl":"https://i2.wp.com/blog.includesecurity.com/wp-content/uploads/2021/02/includesec.png?fit=151%2C151&ssl=1","width":151,"height":151,"caption":"Include Security"},"image":{"@id":"https://blog.includesecurity.com/#logo"}},{"@type":"WebSite","@id":"https://blog.includesecurity.com/#website","url":"https://blog.includesecurity.com/","name":"Include Security Research Blog","description":"Team Research blog","publisher":{"@id":"https://blog.includesecurity.com/#organization"},"potentialAction":[{"@type":"SearchAction","target":{"@type":"EntryPoint","urlTemplate":"https://blog.includesecurity.com/?s={search_term_string}"},"query-input":"required name=search_term_string"}],"inLanguage":"en-US"},{"@type":"WebPage","@id":"https://blog.includesecurity.com/2014/06/exploiting-cve-2014-0196-a-walk-through-of-the-linux-pty-race-condition-poc/#webpage","url":"https://blog.includesecurity.com/2014/06/exploiting-cve-2014-0196-a-walk-through-of-the-linux-pty-race-condition-poc/","name":"Exploiting CVE-2014-0196 a walk-through of the Linux pty race condition PoC - Include Security Research Blog","isPartOf":{"@id":"https://blog.includesecurity.com/#website"},"datePublished":"2014-06-03T18:24:00+00:00","dateModified":"2021-02-18T16:22:12+00:00","breadcrumb":{"@id":"https://blog.includesecurity.com/2014/06/exploiting-cve-2014-0196-a-walk-through-of-the-linux-pty-race-condition-poc/#breadcrumb"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://blog.includesecurity.com/2014/06/exploiting-cve-2014-0196-a-walk-through-of-the-linux-pty-race-condition-poc/"]}]},{"@type":"BreadcrumbList","@id":"https://blog.includesecurity.com/2014/06/exploiting-cve-2014-0196-a-walk-through-of-the-linux-pty-race-condition-poc/#breadcrumb","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https://blog.includesecurity.com/"},{"@type":"ListItem","position":2,"name":"Exploiting CVE-2014-0196 a walk-through of the Linux pty race condition PoC"}]},{"@type":"Article","@id":"https://blog.includesecurity.com/2014/06/exploiting-cve-2014-0196-a-walk-through-of-the-linux-pty-race-condition-poc/#article","isPartOf":{"@id":"https://blog.includesecurity.com/2014/06/exploiting-cve-2014-0196-a-walk-through-of-the-linux-pty-race-condition-poc/#webpage"},"author":{"@id":"https://blog.includesecurity.com/#/schema/person/57d4885372e70cdd2a6580c2b5b576b3"},"headline":"Exploiting CVE-2014-0196 a walk-through of the Linux pty race condition PoC","datePublished":"2014-06-03T18:24:00+00:00","dateModified":"2021-02-18T16:22:12+00:00","mainEntityOfPage":{"@id":"https://blog.includesecurity.com/2014/06/exploiting-cve-2014-0196-a-walk-through-of-the-linux-pty-race-condition-poc/#webpage"},"wordCount":3146,"commentCount":0,"publisher":{"@id":"https://blog.includesecurity.com/#organization"},"articleSection":["Exploit","Kernel Exploit","Linux","privilege escalation","pty","race condition","racecondition"],"inLanguage":"en-US","potentialAction":[{"@type":"CommentAction","name":"Comment","target":["https://blog.includesecurity.com/2014/06/exploiting-cve-2014-0196-a-walk-through-of-the-linux-pty-race-condition-poc/#respond"]}]},{"@type":"Person","@id":"https://blog.includesecurity.com/#/schema/person/57d4885372e70cdd2a6580c2b5b576b3","name":"IncludeSec","image":{"@type":"ImageObject","@id":"https://blog.includesecurity.com/#personlogo","inLanguage":"en-US","url":"https://secure.gravatar.com/avatar/c5332f443fa9b0340ef65a0360b974fa?s=96&d=identicon&r=g","contentUrl":"https://secure.gravatar.com/avatar/c5332f443fa9b0340ef65a0360b974fa?s=96&d=identicon&r=g","caption":"IncludeSec"},"description":"Hackin'","url":"https://blog.includesecurity.com/author/includesecsite/"}]}</script>
	<!-- / Yoast SEO plugin. -->


<link rel="dns-prefetch" href="https://secure.gravatar.com/">
<link rel="dns-prefetch" href="https://s.w.org/">
<link rel="dns-prefetch" href="https://widgets.wp.com/">
<link rel="dns-prefetch" href="https://s0.wp.com/">
<link rel="dns-prefetch" href="https://0.gravatar.com/">
<link rel="dns-prefetch" href="https://1.gravatar.com/">
<link rel="dns-prefetch" href="https://2.gravatar.com/">
<link rel="dns-prefetch" href="https://jetpack.wordpress.com/">
<link rel="dns-prefetch" href="https://s1.wp.com/">
<link rel="dns-prefetch" href="https://s2.wp.com/">
<link rel="dns-prefetch" href="https://public-api.wordpress.com/">
<link rel="dns-prefetch" href="https://i0.wp.com/">
<link rel="dns-prefetch" href="https://i1.wp.com/">
<link rel="dns-prefetch" href="https://i2.wp.com/">
<link rel="dns-prefetch" href="https://c0.wp.com/">
<link rel="alternate" type="application/rss+xml" title="Include Security Research Blog » Feed" href="https://blog.includesecurity.com/feed/">
<link rel="alternate" type="application/rss+xml" title="Include Security Research Blog » Comments Feed" href="https://blog.includesecurity.com/comments/feed/">
<link rel="alternate" type="application/rss+xml" title="Include Security Research Blog » Exploiting CVE-2014-0196 a walk-through of the Linux pty race condition PoC Comments Feed" href="https://blog.includesecurity.com/2014/06/exploiting-cve-2014-0196-a-walk-through-of-the-linux-pty-race-condition-poc/feed/">
		<script>
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.1.0\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/13.1.0\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/blog.includesecurity.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=5.8.2"}};
			!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){var a=String.fromCharCode;p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,e),0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(a.apply(this,t),0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(!p||!p.fillText)return!1;switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s([127987,65039,8205,9895,65039],[127987,65039,8203,9895,65039])?!1:!s([55356,56826,55356,56819],[55356,56826,8203,55356,56819])&&!s([55356,57332,56128,56423,56128,56418,56128,56421,56128,56430,56128,56423,56128,56447],[55356,57332,8203,56128,56423,8203,56128,56418,8203,56128,56421,8203,56128,56430,8203,56128,56423,8203,56128,56447]);case"emoji":return!s([10084,65039,8205,55357,56613],[10084,65039,8203,55357,56613])}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(n=t.source||{}).concatemoji?c(n.concatemoji):n.wpemoji&&n.twemoji&&(c(n.twemoji),c(n.wpemoji)))}(window,document,window._wpemojiSettings);
		</script><script src="./2014 - Exploiting CVE-2014-0196 a walk-through of the Linux pty race condition PoC_files/wp-emoji-release.min.js(1).下載" type="text/javascript" defer=""></script>
		<style>
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel="stylesheet" id="wp-block-library-css" href="./2014 - Exploiting CVE-2014-0196 a walk-through of the Linux pty race condition PoC_files/style.min.css" media="all">
<style id="wp-block-library-inline-css">
.has-text-align-justify{text-align:justify;}
</style>
<link rel="stylesheet" id="mediaelement-css" href="./2014 - Exploiting CVE-2014-0196 a walk-through of the Linux pty race condition PoC_files/mediaelementplayer-legacy.min.css" media="all">
<link rel="stylesheet" id="wp-mediaelement-css" href="./2014 - Exploiting CVE-2014-0196 a walk-through of the Linux pty race condition PoC_files/wp-mediaelement.min.css" media="all">
<link rel="stylesheet" id="generate-comments-css" href="./2014 - Exploiting CVE-2014-0196 a walk-through of the Linux pty race condition PoC_files/comments.min.css" media="all">
<link rel="stylesheet" id="generate-style-css" href="./2014 - Exploiting CVE-2014-0196 a walk-through of the Linux pty race condition PoC_files/main.min.css" media="all">
<style id="generate-style-inline-css">
body{background-color:#ffffff;color:#222222;}a{color:#1e73be;}a:hover, a:focus, a:active{color:#000000;}.wp-block-group__inner-container{max-width:1200px;margin-left:auto;margin-right:auto;}.site-header .header-image{width:270px;}body, button, input, select, textarea{font-family:-apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";}body{line-height:1.5;}.entry-content > [class*="wp-block-"]:not(:last-child){margin-bottom:1.5em;}.main-navigation .main-nav ul ul li a{font-size:14px;}.sidebar .widget, .footer-widgets .widget{font-size:17px;}h1{line-height:1em;}h2{line-height:1em;}h3{line-height:1em;}@media (max-width:768px){h1{font-size:31px;}h2{font-size:27px;}h3{font-size:24px;}h4{font-size:22px;}h5{font-size:19px;}}.top-bar{background-color:#636363;color:#ffffff;}.top-bar a{color:#ffffff;}.top-bar a:hover{color:#303030;}.site-header{background-color:#ffffff;}.main-title a,.main-title a:hover{color:#222222;}.site-description{color:#757575;}.mobile-menu-control-wrapper .menu-toggle,.mobile-menu-control-wrapper .menu-toggle:hover,.mobile-menu-control-wrapper .menu-toggle:focus,.has-inline-mobile-toggle #site-navigation.toggled{background-color:rgba(0, 0, 0, 0.02);}.main-navigation,.main-navigation ul ul{background-color:#ffffff;}.main-navigation .main-nav ul li a,.menu-toggle, .main-navigation .menu-bar-items{color:#515151;}.main-navigation .main-nav ul li:hover > a,.main-navigation .main-nav ul li:focus > a, .main-navigation .main-nav ul li.sfHover > a, .main-navigation .menu-bar-item:hover > a, .main-navigation .menu-bar-item.sfHover > a{color:#7a8896;background-color:#ffffff;}button.menu-toggle:hover,button.menu-toggle:focus{color:#515151;}.main-navigation .main-nav ul li[class*="current-menu-"] > a{color:#7a8896;background-color:#ffffff;}.main-navigation .main-nav ul li[class*="current-menu-"] > a:hover,.main-navigation .main-nav ul li[class*="current-menu-"].sfHover > a{color:#7a8896;background-color:#ffffff;}.navigation-search input[type="search"],.navigation-search input[type="search"]:active, .navigation-search input[type="search"]:focus, .main-navigation .main-nav ul li.search-item.active > a, .main-navigation .menu-bar-items .search-item.active > a{color:#7a8896;background-color:#ffffff;}.main-navigation ul ul{background-color:#eaeaea;}.main-navigation .main-nav ul ul li a{color:#515151;}.main-navigation .main-nav ul ul li:hover > a,.main-navigation .main-nav ul ul li:focus > a,.main-navigation .main-nav ul ul li.sfHover > a{color:#7a8896;background-color:#eaeaea;}.main-navigation .main-nav ul ul li[class*="current-menu-"] > a{color:#7a8896;background-color:#eaeaea;}.main-navigation .main-nav ul ul li[class*="current-menu-"] > a:hover,.main-navigation .main-nav ul ul li[class*="current-menu-"].sfHover > a{color:#7a8896;background-color:#eaeaea;}.separate-containers .inside-article, .separate-containers .comments-area, .separate-containers .page-header, .one-container .container, .separate-containers .paging-navigation, .inside-page-header{background-color:#ffffff;}.entry-title a{color:#1b1f35;}.entry-title a:hover{color:#55555e;}.entry-meta{color:#595959;}.sidebar .widget{background-color:#ffffff;}.footer-widgets{background-color:#ffffff;}.footer-widgets .widget-title{color:#000000;}.site-info{color:#ffffff;background-color:#55555e;}.site-info a{color:#ffffff;}.site-info a:hover{color:#d3d3d3;}.footer-bar .widget_nav_menu .current-menu-item a{color:#d3d3d3;}input[type="text"],input[type="email"],input[type="url"],input[type="password"],input[type="search"],input[type="tel"],input[type="number"],textarea,select{color:#666666;background-color:#fafafa;border-color:#cccccc;}input[type="text"]:focus,input[type="email"]:focus,input[type="url"]:focus,input[type="password"]:focus,input[type="search"]:focus,input[type="tel"]:focus,input[type="number"]:focus,textarea:focus,select:focus{color:#666666;background-color:#ffffff;border-color:#bfbfbf;}button,html input[type="button"],input[type="reset"],input[type="submit"],a.button,a.wp-block-button__link:not(.has-background){color:#ffffff;background-color:#55555e;}button:hover,html input[type="button"]:hover,input[type="reset"]:hover,input[type="submit"]:hover,a.button:hover,button:focus,html input[type="button"]:focus,input[type="reset"]:focus,input[type="submit"]:focus,a.button:focus,a.wp-block-button__link:not(.has-background):active,a.wp-block-button__link:not(.has-background):focus,a.wp-block-button__link:not(.has-background):hover{color:#ffffff;background-color:#3f4047;}a.generate-back-to-top{background-color:rgba( 0,0,0,0.4 );color:#ffffff;}a.generate-back-to-top:hover,a.generate-back-to-top:focus{background-color:rgba( 0,0,0,0.6 );color:#ffffff;}@media (max-width:768px){.main-navigation .menu-bar-item:hover > a, .main-navigation .menu-bar-item.sfHover > a{background:none;color:#515151;}}.nav-below-header .main-navigation .inside-navigation.grid-container, .nav-above-header .main-navigation .inside-navigation.grid-container{padding:0px 20px 0px 20px;}.separate-containers .paging-navigation{padding-top:20px;padding-bottom:20px;}.entry-content .alignwide, body:not(.no-sidebar) .entry-content .alignfull{margin-left:-40px;width:calc(100% + 80px);max-width:calc(100% + 80px);}.rtl .menu-item-has-children .dropdown-menu-toggle{padding-left:20px;}.rtl .main-navigation .main-nav ul li.menu-item-has-children > a{padding-right:20px;}@media (max-width:768px){.separate-containers .inside-article, .separate-containers .comments-area, .separate-containers .page-header, .separate-containers .paging-navigation, .one-container .site-content, .inside-page-header, .wp-block-group__inner-container{padding:30px;}.inside-top-bar{padding-right:30px;padding-left:30px;}.inside-header{padding-right:30px;padding-left:30px;}.widget-area .widget{padding-top:30px;padding-right:30px;padding-bottom:30px;padding-left:30px;}.footer-widgets-container{padding-top:30px;padding-right:30px;padding-bottom:30px;padding-left:30px;}.inside-site-info{padding-right:30px;padding-left:30px;}.entry-content .alignwide, body:not(.no-sidebar) .entry-content .alignfull{margin-left:-30px;width:calc(100% + 60px);max-width:calc(100% + 60px);}.one-container .site-main .paging-navigation{margin-bottom:20px;}}/* End cached CSS */.is-right-sidebar{width:30%;}.is-left-sidebar{width:30%;}.site-content .content-area{width:100%;}@media (max-width:768px){.main-navigation .menu-toggle,.sidebar-nav-mobile:not(#sticky-placeholder){display:block;}.main-navigation ul,.gen-sidebar-nav,.main-navigation:not(.slideout-navigation):not(.toggled) .main-nav > ul,.has-inline-mobile-toggle #site-navigation .inside-navigation > *:not(.navigation-search):not(.main-nav){display:none;}.nav-align-right .inside-navigation,.nav-align-center .inside-navigation{justify-content:space-between;}}
</style>
<link rel="stylesheet" id="enlighterjs-css" href="./2014 - Exploiting CVE-2014-0196 a walk-through of the Linux pty race condition PoC_files/enlighterjs.min.css" media="all">
<link rel="stylesheet" id="social-logos-css" href="./2014 - Exploiting CVE-2014-0196 a walk-through of the Linux pty race condition PoC_files/social-logos.min.css" media="all">
<link rel="stylesheet" id="jetpack_css-css" href="./2014 - Exploiting CVE-2014-0196 a walk-through of the Linux pty race condition PoC_files/jetpack.css" media="all">
<link rel="https://api.w.org/" href="https://blog.includesecurity.com/wp-json/"><link rel="alternate" type="application/json" href="https://blog.includesecurity.com/wp-json/wp/v2/posts/185"><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://blog.includesecurity.com/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://blog.includesecurity.com/wp-includes/wlwmanifest.xml"> 

<link rel="shortlink" href="https://wp.me/p9RwVC-2Z">
<link rel="alternate" type="application/json+oembed" href="https://blog.includesecurity.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fblog.includesecurity.com%2F2014%2F06%2Fexploiting-cve-2014-0196-a-walk-through-of-the-linux-pty-race-condition-poc%2F">
<link rel="alternate" type="text/xml+oembed" href="https://blog.includesecurity.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fblog.includesecurity.com%2F2014%2F06%2Fexploiting-cve-2014-0196-a-walk-through-of-the-linux-pty-race-condition-poc%2F&amp;format=xml">
<style type="text/css">img#wpstats{display:none}</style>
		<link rel="pingback" href="https://blog.includesecurity.com/xmlrpc.php">
<meta name="viewport" content="width=device-width, initial-scale=1"><link rel="amphtml" href="https://blog.includesecurity.com/2014/06/exploiting-cve-2014-0196-a-walk-through-of-the-linux-pty-race-condition-poc/amp/"><link rel="icon" href="https://blog.includesecurity.com/wp-content/uploads/2021/02/favicon.ico" sizes="32x32">
<link rel="icon" href="https://blog.includesecurity.com/wp-content/uploads/2021/02/favicon.ico" sizes="192x192">
<link rel="apple-touch-icon" href="https://blog.includesecurity.com/wp-content/uploads/2021/02/favicon.ico">
<meta name="msapplication-TileImage" content="https://blog.includesecurity.com/wp-content/uploads/2021/02/favicon.ico">
<style type="text/css" id="wp-custom-css">#page,#content,#primary,#main {
	max-width: 960px;
}
.site-header {
	background: #1b1f35;
	color: #fff;  
	margin-bottom: 0px;
}
.site-description {
	color: #9ed54d;
	font-variant: small-caps;
	text-transform: lowercase;
	font-size:2em;
	height:100%;
	vertical-align:bottom;
	line-height: 0.7em;
}
.main-title {
	color: #fff;
}
.main-navigation {
	padding: 0px;
	margin: 0px;
	line-height: 10px;
}
.main-navigation .main-nav ul li a, 
.main-navigation .menu-toggle {
	color: #1b1f35;
	font-weight: bold;
}


.comment { display: none; }</style><!-- Your Google Analytics Plugin is missing the tracking ID -->
</head>

<body class="post-template-default single single-post postid-185 single-format-standard wp-custom-logo wp-embed-responsive no-sidebar nav-below-header separate-containers header-aligned-center dropdown-hover" itemtype="https://schema.org/Blog" itemscope="">
	<a class="screen-reader-text skip-link" href="https://blog.includesecurity.com/2014/06/exploiting-cve-2014-0196-a-walk-through-of-the-linux-pty-race-condition-poc/#content" title="Skip to content">Skip to content</a>		<header id="masthead" class="site-header" itemtype="https://schema.org/WPHeader" itemscope="">
			<div class="inside-header grid-container">
				<div class="site-branding-container"><div class="site-logo">
					<a href="https://blog.includesecurity.com/" title="Include Security Research Blog" rel="home">
						<img class="header-image is-logo-image" alt="Include Security Research Blog" src="./2014 - Exploiting CVE-2014-0196 a walk-through of the Linux pty race condition PoC_files/logo.svg" title="Include Security Research Blog">
					</a>
				</div><div class="site-branding">
						
						<p class="site-description" itemprop="description">
					Team Research blog
				</p>
					</div></div>			</div>
		</header>
				<nav id="site-navigation" class="main-navigation nav-align-center sub-menu-right" itemtype="https://schema.org/SiteNavigationElement" itemscope="">
			<div class="inside-navigation grid-container">
								<button class="menu-toggle" aria-controls="primary-menu" aria-expanded="false">
					<span class="gp-icon icon-menu-bars"><svg viewBox="0 0 512 512" aria-hidden="true" role="img" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1em" height="1em">
						<path d="M0 96c0-13.255 10.745-24 24-24h464c13.255 0 24 10.745 24 24s-10.745 24-24 24H24c-13.255 0-24-10.745-24-24zm0 160c0-13.255 10.745-24 24-24h464c13.255 0 24 10.745 24 24s-10.745 24-24 24H24c-13.255 0-24-10.745-24-24zm0 160c0-13.255 10.745-24 24-24h464c13.255 0 24 10.745 24 24s-10.745 24-24 24H24c-13.255 0-24-10.745-24-24z"></path>
					</svg><svg viewBox="0 0 512 512" aria-hidden="true" role="img" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1em" height="1em">
						<path d="M71.029 71.029c9.373-9.372 24.569-9.372 33.942 0L256 222.059l151.029-151.03c9.373-9.372 24.569-9.372 33.942 0 9.372 9.373 9.372 24.569 0 33.942L289.941 256l151.03 151.029c9.372 9.373 9.372 24.569 0 33.942-9.373 9.372-24.569 9.372-33.942 0L256 289.941l-151.029 151.03c-9.373 9.372-24.569 9.372-33.942 0-9.372-9.373-9.372-24.569 0-33.942L222.059 256 71.029 104.971c-9.372-9.373-9.372-24.569 0-33.942z"></path>
					</svg></span><span class="mobile-menu">Menu</span>				</button>
				<div id="primary-menu" class="main-nav"><ul id="menu-primary" class=" menu sf-menu"><li id="menu-item-57" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-57"><a href="https://includesecurity.com/#home">Home</a></li>
<li id="menu-item-61" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-61"><a href="https://includesecurity.com/#careers">Careers</a></li>
<li id="menu-item-62" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-62"><a href="https://includesecurity.com/#contact">Contact Us</a></li>
<li id="menu-item-428" class="twitterIcon menu-item menu-item-type-custom menu-item-object-custom menu-item-428"><a href="https://twitter.com/includesecurity">Twitter</a></li>
</ul></div>			</div>
		</nav>
		
	<div id="page" class="site grid-container container hfeed">
				<div id="content" class="site-content">
			
	<div id="primary" class="content-area">
		<main id="main" class="site-main">
			
<article id="post-185" class="post-185 post type-post status-publish format-standard hentry category-exploit category-kernel-exploit category-linux category-privilege-escalation category-pty category-race-condition category-racecondition" itemtype="https://schema.org/CreativeWork" itemscope="">
	<div class="inside-article">
					<header class="entry-header">
				<h1 class="entry-title" itemprop="headline">Exploiting CVE-2014-0196 a walk-through of the Linux pty race condition PoC</h1>		<div class="entry-meta">
			<span class="posted-on"><time class="updated" datetime="2021-02-18T11:22:12-05:00" itemprop="dateModified">February 18, 2021</time><time class="entry-date published" datetime="2014-06-03T14:24:00-04:00" itemprop="datePublished">June 3, 2014</time></span> <span class="byline"> — <span class="author vcard" itemprop="author" itemtype="https://schema.org/Person" itemscope=""><span class="author-name" itemprop="name">by Samuel Groß</span></span></span> 		</div>
					</header>
			
		<div class="entry-content" itemprop="text">
			<h3>Introduction</h3>
<p>Recently a severe vulnerability in the Linux kernel was publicly disclosed and patched. In this post we’ll analyze what this particular security vulnerability looks like in the Linux kernel code and walk you through the <a href="http://bugfuzz.com/stuff/cve-2014-0196-md.c">publicly published proof-of-concept exploit code by Matthew Daley</a>&nbsp;released May 12th 2014.</p>
<p>The <a href="http://seclists.org/oss-sec/2014/q2/243">original post by the SUSE security team to oss-security</a> announced that the vuln was found accidentally by a customer in production! <a href="https://git.kernel.org/cgit/linux/kernel/git/gregkh/tty.git/commit/?h=tty-linus&amp;id=4291086b1f081b869c6d79e5b7441633dc3ace00">You can find the patch at this link.</a></p>
<p>The core issue is located in the pty subsystem of the kernel and has been there for about five years. There was about one year in the middle where the vuln was not present, we’ll talk about that a bit later in this post.</p>
<h3>Background on the pty/tty subsystem</h3>
<p>In order to fully understand the vuln we’ll have to dive into the pty/tty subsystem of the linux kernel so lets start there.</p>
<p>A tty is “..an electromechanical typewriter paired with a communication channel.” Back in the day a tty was made up of a keyboard for the input, a screen or similar display for the output and an OS process that was attached to this concept of tty. The process would then receive the input and it’s output would be redirected to the screen. Those days are long gone but command line applications are not (thankfully!) and today we mostly use pseudo terminals. The main difference here is that instead of a keyboard and screen another process sits at the master side of the pty (for example a terminal emulator). Think of a pty as a bidirectional pipe or socket with some additional hooks in place (for example if you type a ctrl-c on the master side the kernel will interpret it instead of sending it to the slave. In this case the kernel will send a SIGINT signal to the slave process which will often cause it to terminate execution).</p>
<p>It’s the pty subsystem’s job to take input from either side of the pty, look for specific bytes in the byte stream (e.g. a ctrl-c), process them and deliver everything else to the other side. There is additional logic involved here which is not present in other IPC concepts such as pipes or sockets. This logic takes care to ensure things like echoing characters you type at the master end are also written back to it, pressing the backspace key to remove previously typed characters actually works on display, or sending signals like SIGINT when ctrl-c is sent. This logic is called line discipline (ldisc in short). Upon receiving data from either side the kernel will store the data in a temporary buffer (struct tty_buffer) and queue a work item to process the incoming data (flush it to the line discipline) at a later point and deliver them to the client side (I assume this is mainly done for “real” terminals whose input arrives in interrupt context (i.e. keyboard press, USB packet, …) and should thus be handled as fast as possible). In this vuln we’ll be racing one of these worker processes while it processes data to find the exploitable condition.</p>
<p>You can learn more about the pty subsystem here: <a href="http://www.linusakesson.net/programming/tty/">http://www.linusakesson.net/programming/tty/</a></p>
<h3>The vulnerability</h3>
<p>For background we’ll first need to introduce some important structures from include/linux/tty.h. (all source code excerpts were taken from Linux 3.2.58 except if stated otherwise):</p>
<div class="enlighter-default enlighter-v-standard enlighter-t-droide "><div class="enlighter-toolbar-top enlighter-toolbar"><div class="enlighter-btn enlighter-btn-raw" title="Plain text"></div><div class="enlighter-btn enlighter-btn-copy" title="Copy to clipboard"></div><div class="enlighter-btn enlighter-btn-window" title="Open code in new window"></div><div class="enlighter-btn enlighter-btn-website" title="EnlighterJS 3 Syntax Highlighter"></div></div><div class="enlighter" style=""><div class=""><div><span class="enlighter-text">struct tty_buffer </span><span class="enlighter-g1">{</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">    struct tty_buffer *next;</span></div></div><div class=""><div><span class="enlighter-text">    char *char_buf_ptr;</span></div></div><div class=""><div><span class="enlighter-text">    unsigned char *flag_buf_ptr;</span></div></div><div class=""><div><span class="enlighter-text">    int used;</span></div></div><div class=""><div><span class="enlighter-text">    int size;</span></div></div><div class=""><div><span class="enlighter-text">    int commit;</span></div></div><div class=""><div><span class="enlighter-text">    int read;</span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-c1">/* Data points here */</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">    unsigned long data</span><span class="enlighter-g1">[</span><span class="enlighter-n1">0</span><span class="enlighter-g1">]</span><span class="enlighter-text">;</span></div></div><div class=""><div><span class="enlighter-text"></span><span class="enlighter-g1">}</span><span class="enlighter-text">;</span></div></div></div><div class="enlighter-raw">struct tty_buffer {
    struct tty_buffer *next;
    char *char_buf_ptr;
    unsigned char *flag_buf_ptr;
    int used;
    int size;
    int commit;
    int read;
    /* Data points here */
    unsigned long data[0];
};</div><div class="enlighter-toolbar-bottom enlighter-toolbar"></div></div><pre class="EnlighterJSRAW enlighter-origin" data-enlighter-language="generic">struct tty_buffer {
    struct tty_buffer *next;
    char *char_buf_ptr;
    unsigned char *flag_buf_ptr;
    int used;
    int size;
    int commit;
    int read;
    /* Data points here */
    unsigned long data[0];
};</pre>
<p>As seen above a tty_buffer data structure temporarily holds a fixed number (well under normal circumstances) of bytes that have arrived at one end of the tty and still need to be processed.<br>
tty_buffer is a dynamically sized object, so the char_buf_ptr will always point at the first byte right after the struct and flag_buf_ptr will point to that address plus ‘size’. tty_buffer.size (which is only the size of the char buffer) can be any of the following: 256, 512, 768, 1024, 1280, 1536 and 1792 (TTY_BUFFER_PAGE).</p>
<p>The actual size of the object is then calculated as follows: 2 x size (for characters + flags) + sizeof(tty_buffer) (for the header), causing the tty_buffer to live in one of the following three kernel heap slabs: kmalloc-1024, kmalloc-2048 or kmalloc-4096.</p>
<div class="enlighter-default enlighter-v-standard enlighter-t-droide "><div class="enlighter-toolbar-top enlighter-toolbar"><div class="enlighter-btn enlighter-btn-raw" title="Plain text"></div><div class="enlighter-btn enlighter-btn-copy" title="Copy to clipboard"></div><div class="enlighter-btn enlighter-btn-window" title="Open code in new window"></div><div class="enlighter-btn enlighter-btn-website" title="EnlighterJS 3 Syntax Highlighter"></div></div><div class="enlighter" style=""><div class=""><div><span class="enlighter-text">struct tty_bufhead </span><span class="enlighter-g1">{</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">    struct work_struct work;</span></div></div><div class=""><div><span class="enlighter-text">    spinlock_t lock;</span></div></div><div class=""><div><span class="enlighter-text">    struct tty_buffer *head;    </span><span class="enlighter-c1">/* Queue head */</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">    struct tty_buffer *tail;    </span><span class="enlighter-c1">/* Active buffer */</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">    struct tty_buffer *free;    </span><span class="enlighter-c1">/* Free queue head */</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">    int memory_used;        </span><span class="enlighter-c1">/* Buffer space used excluding free queue */</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text"></span><span class="enlighter-g1">}</span><span class="enlighter-text">;</span></div></div></div><div class="enlighter-raw">struct tty_bufhead {
    struct work_struct work;
    spinlock_t lock;
    struct tty_buffer *head;    /* Queue head */
    struct tty_buffer *tail;    /* Active buffer */
    struct tty_buffer *free;    /* Free queue head */
    int memory_used;        /* Buffer space used excluding free queue */
};</div><div class="enlighter-toolbar-bottom enlighter-toolbar"></div></div><pre class="EnlighterJSRAW enlighter-origin" data-enlighter-language="generic">struct tty_bufhead {
    struct work_struct work;
    spinlock_t lock;
    struct tty_buffer *head;    /* Queue head */
    struct tty_buffer *tail;    /* Active buffer */
    struct tty_buffer *free;    /* Free queue head */
    int memory_used;        /* Buffer space used excluding free queue */
};</pre>
<p>A tty_bufhead is, as the name implies, is the head (or first) data structure for tty_buffers. It keeps a list active buffers (head) while also storing a direct pointer to the last buffer (the currently active one) to improve performance. You will often see references to bufhead-&gt;tail in the kernel source code, meaning the currently active buffer is requested. It also keeps it’s own freelist for buffers smaller than 512 bytes (see drivers/tty/tty_buffer.c:tty_buffer_free()).</p>
<div class="enlighter-default enlighter-v-standard enlighter-t-droide "><div class="enlighter-toolbar-top enlighter-toolbar"><div class="enlighter-btn enlighter-btn-raw" title="Plain text"></div><div class="enlighter-btn enlighter-btn-copy" title="Copy to clipboard"></div><div class="enlighter-btn enlighter-btn-window" title="Open code in new window"></div><div class="enlighter-btn enlighter-btn-website" title="EnlighterJS 3 Syntax Highlighter"></div></div><div class="enlighter" style=""><div class=""><div><span class="enlighter-text">struct tty_struct </span><span class="enlighter-g1">{</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">    int magic;</span></div></div><div class=""><div><span class="enlighter-text">    struct kref kref;</span></div></div><div class=""><div><span class="enlighter-text">    struct device *dev;</span></div></div><div class=""><div><span class="enlighter-text">    struct tty_driver *driver;</span></div></div><div class=""><div><span class="enlighter-text">    const struct tty_operations *ops;</span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-c1">/* ... */</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">    struct tty_bufhead buf;  </span><span class="enlighter-c1">/* Locked internally */</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-c1">/* ... */</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text"></span><span class="enlighter-g1">}</span><span class="enlighter-text">;</span></div></div></div><div class="enlighter-raw">struct tty_struct {
    int magic;
    struct kref kref;
    struct device *dev;
    struct tty_driver *driver;
    const struct tty_operations *ops;
    /* ... */
    struct tty_bufhead buf;  /* Locked internally */
    /* ... */
};</div><div class="enlighter-toolbar-bottom enlighter-toolbar"></div></div><pre class="EnlighterJSRAW enlighter-origin" data-enlighter-language="generic">struct tty_struct {
    int magic;
    struct kref kref;
    struct device *dev;
    struct tty_driver *driver;
    const struct tty_operations *ops;
    /* ... */
    struct tty_bufhead buf;  /* Locked internally */
    /* ... */
};</pre>
<p>The tty_struct data structure represents a tty/pty in kernel space. For the sake of this post all you need to know is that it stores the tty_bufhead and thus the buffers.</p>
<p>Alright, let’s start with the function mentioned in <a href="https://git.kernel.org/cgit/linux/kernel/git/gregkh/tty.git/commit/?h=tty-linus&amp;id=4291086b1f081b869c6d79e5b7441633dc3ace00">the commit message</a>, tty_insert_flip_string_fixed_flag() in drivers/tty/tty_buffer.c.<br>
It is responsible for storing the given bytes in a tty_buffer of the tty device, allocating a new one if required:</p>
<p>The call chain leading up to this function roughly looks like this: write(pty_fd) in userspace -&gt; sys_write() in kernelspace -&gt; tty_write() -&gt; pty_write() -&gt; tty_insert_flip_string_fixed_flag()</p>
<div class="enlighter-default enlighter-v-standard enlighter-t-droide "><div class="enlighter-toolbar-top enlighter-toolbar"><div class="enlighter-btn enlighter-btn-raw" title="Plain text"></div><div class="enlighter-btn enlighter-btn-copy" title="Copy to clipboard"></div><div class="enlighter-btn enlighter-btn-window" title="Open code in new window"></div><div class="enlighter-btn enlighter-btn-website" title="EnlighterJS 3 Syntax Highlighter"></div></div><div class="enlighter" style=""><div class=""><div><span class="enlighter-text">int </span><span class="enlighter-m0">tty_insert_flip_string_fixed_flag</span><span class="enlighter-g1">(</span><span class="enlighter-text">struct tty_struct *tty,</span></div></div><div class=""><div><span class="enlighter-text">        const unsigned char *chars, char flag, size_t size</span><span class="enlighter-g1">)</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text"></span><span class="enlighter-g1">{</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">    int copied = </span><span class="enlighter-n1">0</span><span class="enlighter-text">;</span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-k1">do</span><span class="enlighter-text"> </span><span class="enlighter-g1">{</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">        int goal = </span><span class="enlighter-m0">min_t</span><span class="enlighter-g1">(</span><span class="enlighter-text">size_t, size - copied, TTY_BUFFER_PAGE</span><span class="enlighter-g1">)</span><span class="enlighter-text">;</span></div></div><div class=""><div><span class="enlighter-text">        int space = </span><span class="enlighter-m0">tty_buffer_request_room</span><span class="enlighter-g1">(</span><span class="enlighter-text">tty, goal</span><span class="enlighter-g1">)</span><span class="enlighter-text">;         </span><span class="enlighter-c1">/* -1- */</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">        struct tty_buffer *tb = tty-</span><span class="enlighter-g1">&gt;</span><span class="enlighter-text">buf.</span><span class="enlighter-m3">tail</span><span class="enlighter-text">;</span></div></div><div class=""><div><span class="enlighter-text">        </span><span class="enlighter-c1">/* If there is no space then tb may be NULL */</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">        </span><span class="enlighter-k1">if</span><span class="enlighter-text"> </span><span class="enlighter-g1">(</span><span class="enlighter-m0">unlikely</span><span class="enlighter-g1">(</span><span class="enlighter-text">space == </span><span class="enlighter-n1">0</span><span class="enlighter-g1">))</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">            break;</span></div></div><div class=""><div><span class="enlighter-text">        </span><span class="enlighter-m0">memcpy</span><span class="enlighter-g1">(</span><span class="enlighter-text">tb-</span><span class="enlighter-g1">&gt;</span><span class="enlighter-text">char_buf_ptr + tb-</span><span class="enlighter-g1">&gt;</span><span class="enlighter-text">used, chars, space</span><span class="enlighter-g1">)</span><span class="enlighter-text">;      </span><span class="enlighter-c1">/* -2- */</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">        </span><span class="enlighter-m0">memset</span><span class="enlighter-g1">(</span><span class="enlighter-text">tb-</span><span class="enlighter-g1">&gt;</span><span class="enlighter-text">flag_buf_ptr + tb-</span><span class="enlighter-g1">&gt;</span><span class="enlighter-text">used, flag, space</span><span class="enlighter-g1">)</span><span class="enlighter-text">;       </span></div></div><div class=""><div><span class="enlighter-text">        tb-</span><span class="enlighter-g1">&gt;</span><span class="enlighter-text">used += space;                                      </span><span class="enlighter-c1">/* -3- */</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">        copied += space;</span></div></div><div class=""><div><span class="enlighter-text">        chars += space;</span></div></div><div class=""><div><span class="enlighter-text">        </span><span class="enlighter-c1">/* There is a small chance that we need to split the data over</span></div></div><div class=""><div><span class="enlighter-c1">           several buffers. If this is the case we must loop */</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-g1">}</span><span class="enlighter-text"> </span><span class="enlighter-k1">while</span><span class="enlighter-text"> </span><span class="enlighter-g1">(</span><span class="enlighter-m0">unlikely</span><span class="enlighter-g1">(</span><span class="enlighter-text">size </span><span class="enlighter-g1">&gt;</span><span class="enlighter-text"> copied</span><span class="enlighter-g1">))</span><span class="enlighter-text">;</span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-k1">return</span><span class="enlighter-text"> copied;</span></div></div><div class=""><div><span class="enlighter-text"></span><span class="enlighter-g1">}</span></div></div></div><div class="enlighter-raw">int tty_insert_flip_string_fixed_flag(struct tty_struct *tty,
        const unsigned char *chars, char flag, size_t size)
{
    int copied = 0;
    do {
        int goal = min_t(size_t, size - copied, TTY_BUFFER_PAGE);
        int space = tty_buffer_request_room(tty, goal);         /* -1- */
        struct tty_buffer *tb = tty-&gt;buf.tail;
        /* If there is no space then tb may be NULL */
        if (unlikely(space == 0))
            break;
        memcpy(tb-&gt;char_buf_ptr + tb-&gt;used, chars, space);      /* -2- */
        memset(tb-&gt;flag_buf_ptr + tb-&gt;used, flag, space);       
        tb-&gt;used += space;                                      /* -3- */
        copied += space;
        chars += space;
        /* There is a small chance that we need to split the data over
           several buffers. If this is the case we must loop */
    } while (unlikely(size &gt; copied));
    return copied;
}</div><div class="enlighter-toolbar-bottom enlighter-toolbar"></div></div><pre class="EnlighterJSRAW enlighter-origin" data-enlighter-language="generic">int tty_insert_flip_string_fixed_flag(struct tty_struct *tty,
        const unsigned char *chars, char flag, size_t size)
{
    int copied = 0;
    do {
        int goal = min_t(size_t, size - copied, TTY_BUFFER_PAGE);
        int space = tty_buffer_request_room(tty, goal);         /* -1- */
        struct tty_buffer *tb = tty-&gt;buf.tail;
        /* If there is no space then tb may be NULL */
        if (unlikely(space == 0))
            break;
        memcpy(tb-&gt;char_buf_ptr + tb-&gt;used, chars, space);      /* -2- */
        memset(tb-&gt;flag_buf_ptr + tb-&gt;used, flag, space);       
        tb-&gt;used += space;                                      /* -3- */
        copied += space;
        chars += space;
        /* There is a small chance that we need to split the data over
           several buffers. If this is the case we must loop */
    } while (unlikely(size &gt; copied));
    return copied;
}</pre>
<p>This function is fairly straightforward: At -1- tty_buffer_request_room ensures that enough space is available in the currently active buffer (tty_bufhead-&gt;tail), allocating a new one if required. At -2- the incoming data is written to the active buffer and at -3- the ‘used’ member is incremented. Note that tb-&gt;used is used as an index into the buffer.</p>
<p>The commit message mentions that two separate processes (a kernel worker process echoing data previously written to the master end and the process at the slave end writing to the pty directly) can enter this function at the same time due to a missing lock, thus causing a race condition.<br>
So what could happen here? The commit message provides us with the following scenario:</p>
<pre style="font-family: monospace; font-size: 12px;">            A                                       B 
__tty_buffer_request_room               
                                        __tty_buffer_request_room 
memcpy(buf(tb-&gt;used), ...) 
tb-&gt;used += space; 
                                        memcpy(buf(tb-&gt;used), ...) -&gt;BOOM</pre>
<p>In here we see two processes (A and B) writing to the pty at the same time. Since the first process updates tb-&gt;used first the memcpy() of the second process will write past the end of the buffer (assuming the first write already filled the buffer) and thus causes the memory corruption.<br>
Now this looks reasonable at first but is actually only part of the story.<br>
Here are some observations that don’t quite fit with this scenario:<br>
– When running a simple PoC the kernel seems to crash very fast (on older kernels at least), while the scenario above seems relatively hard to achieve<br>
– Looking at the debugger shows that often multiple pages of kernel data have been overwritten upon crashing. This can hardly be the case when only sending e.g. 2 x 4096 bytes at once</p>
<p>Also take a look at the following (slightly shortened) stacktrace, produced by setting a breakpoint at tty_insert_flip_string_fixed_flag()</p>
<pre style="font-family: monospace; font-size: 10px;"> 
#0  tty_insert_flip_string_fixed_flag (tty=tty@entry=0xffff880107a82800, 
    chars=0x0, flag=flag@entry=0 '00', size=1)                      /* -1. */
#1  tty_insert_flip_string (size=&lt;optimized out&gt;, 
    chars=&lt;optimized out&gt;, tty=0xffff880107a82800)
#2  pty_write (tty=0xffff880117cd3800, buf=&lt;optimized out&gt;, c=&lt;optimized out&gt;)
#3  tty_put_char (tty=tty@entry=0xffff880117cd3800, ch=66 'B')        /* -2- */
#4  process_echoes (tty=0xffff880117cd3800)
#6  n_tty_receive_char (c=&lt;optimized out&gt;, tty=0xffff880117cd3800)
#7  n_tty_receive_buf (tty=0xffff880117cd3800, 
    cp=0xffff880117a78828 'B' ..., fp=0xffff880117a78a2d "", count=512)
#8  flush_to_ldisc (work=0xffff880117cd3910)
#9  process_one_work (worker=worker@entry=0xffff880118f507c0, 
    work=0xffff880117cd3910)
#10 worker_thread (__worker=__worker@entry=0xffff880118f507c0)
#11 kthread (_create=0xffff880118ed9d80)
#12 kernel_thread_helper ()</pre>
<p>This is the code path a worker process takes when performing a flush to the line discipline. As can be seen at -1- and -2- the echoing is actually done byte by byte.<br>
Clearly we can’t cause much harm by only overwriting a buffer with a single byte when the chunk still has unused space left (as will be the case for tty_buffer objects).</p>
<p>In the following we will now assume that the race went something like this: Process A wrote 256 bytes, process B (performing an echo) entered tty_buffer_request_room() before A updated tb-&gt;used, causing it to not allocate a fresh buffer. Afterwards B wrote another byte to the same buffer and incremented tb-&gt;used further.</p>
<p>To understand what is really causing the memory corruption take a look at the tty_buffer_request_room() function called by tty_insert_flip_string_fixed_flag().</p>
<div class="enlighter-default enlighter-v-standard enlighter-t-droide "><div class="enlighter-toolbar-top enlighter-toolbar"><div class="enlighter-btn enlighter-btn-raw" title="Plain text"></div><div class="enlighter-btn enlighter-btn-copy" title="Copy to clipboard"></div><div class="enlighter-btn enlighter-btn-window" title="Open code in new window"></div><div class="enlighter-btn enlighter-btn-website" title="EnlighterJS 3 Syntax Highlighter"></div></div><div class="enlighter" style=""><div class=""><div><span class="enlighter-text">int </span><span class="enlighter-m0">tty_buffer_request_room</span><span class="enlighter-g1">(</span><span class="enlighter-text">struct tty_struct *tty, size_t size</span><span class="enlighter-g1">)</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text"></span><span class="enlighter-g1">{</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">    struct tty_buffer *b, *n;</span></div></div><div class=""><div><span class="enlighter-text">    int left;                                   </span><span class="enlighter-c1">/* -1- */</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">    unsigned long flags;</span></div></div><div class=""><div><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-m0">spin_lock_irqsave</span><span class="enlighter-g1">(</span><span class="enlighter-text">&amp;tty-</span><span class="enlighter-g1">&gt;</span><span class="enlighter-text">buf.</span><span class="enlighter-m3">lock</span><span class="enlighter-text">, flags</span><span class="enlighter-g1">)</span><span class="enlighter-text">;   </span><span class="enlighter-c1">/* -2- */</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-c1">/* OPTIMISATION: We could keep a per tty "zero" sized buffer to</span></div></div><div class=""><div><span class="enlighter-c1">       remove this conditional if its worth it. This would be invisible</span></div></div><div class=""><div><span class="enlighter-c1">       to the callers */</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-k1">if</span><span class="enlighter-text"> </span><span class="enlighter-g1">((</span><span class="enlighter-text">b = tty-</span><span class="enlighter-g1">&gt;</span><span class="enlighter-text">buf.</span><span class="enlighter-m3">tail</span><span class="enlighter-g1">)</span><span class="enlighter-text"> != </span><span class="enlighter-k1">NULL</span><span class="enlighter-g1">)</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">        left = b-</span><span class="enlighter-g1">&gt;</span><span class="enlighter-text">size - b-</span><span class="enlighter-g1">&gt;</span><span class="enlighter-text">used;               </span><span class="enlighter-c1">/* -3- */</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-k1">else</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">        left = </span><span class="enlighter-n1">0</span><span class="enlighter-text">;</span></div></div><div class=""><div><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-k1">if</span><span class="enlighter-text"> </span><span class="enlighter-g1">(</span><span class="enlighter-text">left </span><span class="enlighter-g1">&lt;</span><span class="enlighter-text"> size</span><span class="enlighter-g1">)</span><span class="enlighter-text"> </span><span class="enlighter-g1">{</span><span class="enlighter-text">                          </span><span class="enlighter-c1">/* -4- */</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">        </span><span class="enlighter-c1">/* This is the slow path - looking for new buffers to use */</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">        </span><span class="enlighter-k1">if</span><span class="enlighter-text"> </span><span class="enlighter-g1">((</span><span class="enlighter-text">n = </span><span class="enlighter-m0">tty_buffer_find</span><span class="enlighter-g1">(</span><span class="enlighter-text">tty, size</span><span class="enlighter-g1">))</span><span class="enlighter-text"> != </span><span class="enlighter-k1">NULL</span><span class="enlighter-g1">)</span><span class="enlighter-text"> </span><span class="enlighter-g1">{</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">            </span><span class="enlighter-k1">if</span><span class="enlighter-text"> </span><span class="enlighter-g1">(</span><span class="enlighter-text">b != </span><span class="enlighter-k1">NULL</span><span class="enlighter-g1">)</span><span class="enlighter-text"> </span><span class="enlighter-g1">{</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">                b-</span><span class="enlighter-g1">&gt;</span><span class="enlighter-text">next = n;</span></div></div><div class=""><div><span class="enlighter-text">                b-</span><span class="enlighter-g1">&gt;</span><span class="enlighter-text">commit = b-</span><span class="enlighter-g1">&gt;</span><span class="enlighter-text">used;</span></div></div><div class=""><div><span class="enlighter-text">            </span><span class="enlighter-g1">}</span><span class="enlighter-text"> </span><span class="enlighter-k1">else</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">                tty-</span><span class="enlighter-g1">&gt;</span><span class="enlighter-text">buf.</span><span class="enlighter-m3">head</span><span class="enlighter-text"> = n;</span></div></div><div class=""><div><span class="enlighter-text">            tty-</span><span class="enlighter-g1">&gt;</span><span class="enlighter-text">buf.</span><span class="enlighter-m3">tail</span><span class="enlighter-text"> = n;</span></div></div><div class=""><div><span class="enlighter-text">        </span><span class="enlighter-g1">}</span><span class="enlighter-text"> </span><span class="enlighter-k1">else</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">            size = left;</span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-g1">}</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-m0">spin_unlock_irqrestore</span><span class="enlighter-g1">(</span><span class="enlighter-text">&amp;tty-</span><span class="enlighter-g1">&gt;</span><span class="enlighter-text">buf.</span><span class="enlighter-m3">lock</span><span class="enlighter-text">, flags</span><span class="enlighter-g1">)</span><span class="enlighter-text">;</span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-k1">return</span><span class="enlighter-text"> size;</span></div></div><div class=""><div><span class="enlighter-text"></span><span class="enlighter-g1">}</span></div></div></div><div class="enlighter-raw">int tty_buffer_request_room(struct tty_struct *tty, size_t size)
{
    struct tty_buffer *b, *n;
    int left;                                   /* -1- */
    unsigned long flags;

    spin_lock_irqsave(&amp;tty-&gt;buf.lock, flags);   /* -2- */

    /* OPTIMISATION: We could keep a per tty "zero" sized buffer to
       remove this conditional if its worth it. This would be invisible
       to the callers */
    if ((b = tty-&gt;buf.tail) != NULL)
        left = b-&gt;size - b-&gt;used;               /* -3- */
    else
        left = 0;

    if (left &lt; size) {                          /* -4- */
        /* This is the slow path - looking for new buffers to use */
        if ((n = tty_buffer_find(tty, size)) != NULL) {
            if (b != NULL) {
                b-&gt;next = n;
                b-&gt;commit = b-&gt;used;
            } else
                tty-&gt;buf.head = n;
            tty-&gt;buf.tail = n;
        } else
            size = left;
    }

    spin_unlock_irqrestore(&amp;tty-&gt;buf.lock, flags);
    return size;
}</div><div class="enlighter-toolbar-bottom enlighter-toolbar"></div></div><pre class="EnlighterJSRAW enlighter-origin" data-enlighter-language="generic">int tty_buffer_request_room(struct tty_struct *tty, size_t size)
{
    struct tty_buffer *b, *n;
    int left;                                   /* -1- */
    unsigned long flags;

    spin_lock_irqsave(&amp;tty-&gt;buf.lock, flags);   /* -2- */

    /* OPTIMISATION: We could keep a per tty "zero" sized buffer to
       remove this conditional if its worth it. This would be invisible
       to the callers */
    if ((b = tty-&gt;buf.tail) != NULL)
        left = b-&gt;size - b-&gt;used;               /* -3- */
    else
        left = 0;

    if (left &lt; size) {                          /* -4- */
        /* This is the slow path - looking for new buffers to use */
        if ((n = tty_buffer_find(tty, size)) != NULL) {
            if (b != NULL) {
                b-&gt;next = n;
                b-&gt;commit = b-&gt;used;
            } else
                tty-&gt;buf.head = n;
            tty-&gt;buf.tail = n;
        } else
            size = left;
    }

    spin_unlock_irqrestore(&amp;tty-&gt;buf.lock, flags);
    return size;
}</pre>
<p>Now things start to get interesting, note how at -1- ‘left’ has type int while ‘size’ is of type size_t (aka unsigned long). Assuming we previously won the race and have written 257 bytes while the buffer was only 256 bytes large then we now have the following situation:<br>
<span style="font-family: Courier New, Courier, monospace;">b-&gt;size is 256</span><br>
<span style="font-family: Courier New, Courier, monospace;">b-&gt;used is 257</span></p>
<p>Looking at the code above, at -3- ‘left’ will now equal -1 and at -4- will be casted to an unsigned value, resulting in 18446744073709551615 (assuming 64 bit long) which is definitely larger then the given size. The following block will be skipped and no new buffer will be allocated for the current request even though the current buffer is more than full.<br>
At this point sending more data to the pty will result in the data being put into the same buffer, overflowing it further (remember ‘used’ is used as an index into the buffer). Since <span style="font-family: Courier New, Courier, monospace;">b-&gt;used</span> will still be incremented for each byte we can now overflow as much data as we want.<br>
Also note that this function is locked internally (at -2-), thus serializing access to it.</p>
<p>Now we are ready to draw an updated scenario that leads to an overflow:</p>
<pre style="font-family: monospace; font-size: 12px;">        A (Slave)                          B (Echo)

tty_buffer_request_room                 
        |                     // waiting for A to release the lock
                              tty_buffer_request_room 
                              // tb-&gt;used &lt; tb-&gt;size,
                              // no new buffer is allocated
memcpy(.., 256);
                                        
                              memcpy(.., 1);

tb-&gt;used += space; 
                              tb-&gt;used += space;    
                              // tb-&gt;used is now larger than tb-&gt;size

</pre>
<p>Note that we will win the race as soon as the echoing process enters tty_buffer_request_room and calculates ‘left’ before the first process gets to update tb-&gt;used. Since the whole memcpy() operation is in between, that time frame is relatively large.</p>
<p>So as far as race condition scenarios go, the single case mentioned in the commit message is only one possible way that can result in memory corruption (and only if A fills the buffer completely).<br>
In general any sequence that results in tb-&gt;used being larger than tb-&gt;size will result in a memory corruption later on. For that to happen the first process must send data to completely fill a buffer (i.e. sending tb-&gt;size bytes in total) while the echoing process must enter tty_buffer_request_room() before the first process updates tb-&gt;used (this leads to tty_buffer_request_room() not allocating a fresh buffer). The corruption is then caused by sending more data to the pty which will continue to overflow the same buffer.</p>
<p>At this point the vuln turns into a standard kernel heap overflow.</p>
<p>And we’ll conclude this section with fun fact: The race in this vuln can actually be won by using just one process. This stems from the fact that we are racing a kernel worker process and not a second user-land process.</p>
<h3>Getting to root – The exploit</h3>
<p>Here we want to quickly analyze the published exploit code which will hopefully be easy to understand now that the details of the vuln are known.</p>
<p>Going step-by-step with PoC’s console output we see…</p>
<h4>[+] Resolving symbols</h4>
<p>Yep, that’s what it’s doing. Note that some modern distributions (notably Ubuntu) set /proc/sys/kernel/kptr_restrict to 1, thus disabling /proc/kallsyms. For repository kernels this is merely an inconvenience though since the kernel image (and System.map) can be downloaded locally and the addresses taken from there.</p>
<h4>[+] Doing once-off allocations</h4>
<p>Stabilizing the heap. We need to make sure existing holes are filled to maximize the chances of getting objects laid out linear in the address space. We want our target buffer to be followed by one of our target objects (struct tty_struct).</p>
<h4>[+] Attempting to overflow into a tty_struct…</h4>
<p>Now we are racing.</p>
<p>This is fairly straightforward, open a pty, spawn a new thread and write to both ends at the same time. Afterwards the child thread will send the data needed to overflow into the adjacent chunk. Assuming the race has been won at the start then there is no time pressure on these operations as discussed above.<br>
Also note that only one byte is sent to the master end, this is done so the number of bytes that has yet to be sent can be calculated.</p>
<p>The exploit targets tty_struct structures which end up in the kmalloc-1024 slab cache. The buffer we will overflow will thus have to be in that cache as well (so tb-&gt;size = 256 which is also the minimum size). Before writing to the slave end the first time (to allocate a fresh buffer) the exploit creates a bunch of new pty’s, thus allocating tty_structs in kernel space. It will then close one of them in hopes that the newly allocated buffer will end up in the freed chunk. If this works out we will have a bunch of tty_structs, followed by the buffer followed by more tty_structs in the kernel address space.</p>
<p>Let’s take a quick look at the function executed by the new thread to overflow into the following chunk:</p>
<div class="enlighter-default enlighter-v-standard enlighter-t-droide "><div class="enlighter-toolbar-top enlighter-toolbar"><div class="enlighter-btn enlighter-btn-raw" title="Plain text"></div><div class="enlighter-btn enlighter-btn-copy" title="Copy to clipboard"></div><div class="enlighter-btn enlighter-btn-window" title="Open code in new window"></div><div class="enlighter-btn enlighter-btn-website" title="EnlighterJS 3 Syntax Highlighter"></div></div><div class="enlighter" style=""><div class=""><div><span class="enlighter-text">void *</span><span class="enlighter-m0">overwrite_thread_fn</span><span class="enlighter-g1">(</span><span class="enlighter-k1">void</span><span class="enlighter-text"> *p</span><span class="enlighter-g1">)</span><span class="enlighter-text"> </span><span class="enlighter-g1">{</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-m0">write</span><span class="enlighter-g1">(</span><span class="enlighter-text">slave_fd, buf, </span><span class="enlighter-n1">511</span><span class="enlighter-g1">)</span><span class="enlighter-text">;</span></div></div><div class=""><div><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-m0">write</span><span class="enlighter-g1">(</span><span class="enlighter-text">slave_fd, buf, </span><span class="enlighter-n1">1024</span><span class="enlighter-text"> - </span><span class="enlighter-n1">32</span><span class="enlighter-text"> - </span><span class="enlighter-g1">(</span><span class="enlighter-n1">1</span><span class="enlighter-text"> + </span><span class="enlighter-n1">511</span><span class="enlighter-text"> + </span><span class="enlighter-n1">1</span><span class="enlighter-g1">))</span><span class="enlighter-text">;</span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-m0">write</span><span class="enlighter-g1">(</span><span class="enlighter-text">slave_fd, &amp;overwrite, </span><span class="enlighter-m0">sizeof</span><span class="enlighter-g1">(</span><span class="enlighter-text">overwrite</span><span class="enlighter-g1">))</span><span class="enlighter-text">;</span></div></div><div class=""><div><span class="enlighter-text"></span><span class="enlighter-g1">}</span></div></div></div><div class="enlighter-raw">void *overwrite_thread_fn(void *p) {
    write(slave_fd, buf, 511);

    write(slave_fd, buf, 1024 - 32 - (1 + 511 + 1));
    write(slave_fd, &amp;overwrite, sizeof(overwrite));
}</div><div class="enlighter-toolbar-bottom enlighter-toolbar"></div></div><pre class="EnlighterJSRAW enlighter-origin" data-enlighter-language="generic">void *overwrite_thread_fn(void *p) {
    write(slave_fd, buf, 511);

    write(slave_fd, buf, 1024 - 32 - (1 + 511 + 1));
    write(slave_fd, &amp;overwrite, sizeof(overwrite));
}</pre>
<p>The first write here will fill the previously allocated buffer (right after closing one of the pty’s we allocated a new buffer by writing one byte to the slave fd). Note that the author assumes the buffer to hold 512 bytes while it’s size is 256 (MIN_TTYB_SIZE). The reason for that is that on newer releases the kernel can use the flag buffer for data as well (if it knows the flags won’t be needed), so the usable size of the buffer is doubled.</p>
<p>The next write fills the memory chunk of the buffer completely. The chunk is 1024 bytes large and so far we have written 32 bytes (sizeof(struct tty_buffer)) + 511 + 1 (the first write to the slave fd) + 1 (the echoed byte from the master fd).</p>
<p>The final write overwrites into the next heap chunk with a fake tty_structure previously created.</p>
<p>Now remember that tty_struct has a member ‘ops’ that is a pointer to a tty_operations struct? Well those ops members in the linux kernel are always pointers to structures holding function pointers themselves (if you’re familiar with C++ this is similar to the vtable pointer of C++ objects). These function pointers correspond to actions performed on the device, there’s one for open(), one for close() one for ioctl() and so on. Now assuming we have overwritten the object then ‘ops’ will now be under our control, pointing into user space. There we have prepared an array of function pointers pointing to our kernel payload.</p>
<p>Now as soon as we perform an ioctl on the tty device we will hijack the kernel control flow and redirect it into the payload. There we’ll execute the standard prepare_kernel_cred(0) followed by commit_creds(), elevating our privileges to root:</p>
<h4><span style="font-weight: normal;">[+] Got it <img draggable="false" role="img" class="emoji" alt="🙂" src="./2014 - Exploiting CVE-2014-0196 a walk-through of the Linux pty race condition PoC_files/1f642.svg"></span></h4>
<pre><span style="font-family: Helvetica Neue, Arial, Helvetica, sans-serif;"># id</span>
<span style="font-family: Helvetica Neue, Arial, Helvetica, sans-serif;">&nbsp;uid=0(root) gid=0(root) groups=0(root)</span></pre>
<p>Note that SMEP/SMAP will prevent this exploit (as well as the grsecurity system) as they prevent the kernel from accessing user-land data (SMAP) and code (SMEP).</p>
<h3>Limitations</h3>
<p>Unlike most other race conditions, in the case of this vuln the attacker is only able to control one of the two processes. Kernel worker processes will check for new work items regularly but can’t really be affected by user space. This seems to make a huge difference for different kernel versions, on 3.2 it usually only takes a couple seconds to win the race while on 3.14 it can take multiple minutes.</p>
<p>As mentioned in the PoC code another thing that limits the reliability is the slab cache size in use. As previously discussed the buffer can only be in one of the following slabs: kmalloc-1024, kmalloc-2048 and kmalloc-4096. At sizes this big the chance of hitting the last chunk in the last page of a slab becomes more likely, further limiting the reliability. When that happens the code will overflow into uncontrolled data. This might have no consequences (no important data has been overwritten), lead to a crash later on (some object has been overwritten that is referenced at some point in the future) or even lead to an immediate panic/Oops (for example when the next page is mapped read only).</p>
<p>As also mentioned in the PoC exploit the flags cause some trouble on older kernels (before the commit acc0f67f307f52f7aec1cffdc40a786c15dd21d9) as b-&gt;size bytes following the overwritten part will always be cleared to zero. Thus when overwriting a controlled object either the whole objects needs to be restored (and the zeros written into unused space before the end of the chunk) or an object needs to be found where parts of it can safely be overwritten with zeros.</p>
<p>For the last part it might be possible to target tty_buffer objects when exploiting the vuln on pre 3.14 kernels. Here the header can be overwritten, yielding an arbitrary write (overwrite char_buf_ptr and afterwards send data to the pty) while the zeroes can safely be written into the buffer space and won’t cause any trouble.</p>
<h3>Is Android vulnerable?</h3>
<div>As stated in the advisory the vulnerability dates back to 2.6.x kernels, roughly 5 years old. That would imply that pretty much every android device out there is vulnerable to this issue. Running a quick PoC on a newer device (for example the Nexus 5, HTC One or Galaxy S4) it seems the race can never be won there though. Let’s again take a look at some kernel source code, this time from the HTC One (m7) Cyanogenmod kernel source.</div>
<div class="enlighter-default enlighter-v-standard enlighter-t-droide "><div class="enlighter-toolbar-top enlighter-toolbar"><div class="enlighter-btn enlighter-btn-raw" title="Plain text"></div><div class="enlighter-btn enlighter-btn-copy" title="Copy to clipboard"></div><div class="enlighter-btn enlighter-btn-window" title="Open code in new window"></div><div class="enlighter-btn enlighter-btn-website" title="EnlighterJS 3 Syntax Highlighter"></div></div><div class="enlighter" style=""><div class=""><div><span class="enlighter-text">int </span><span class="enlighter-m0">tty_insert_flip_string_fixed_flag</span><span class="enlighter-g1">(</span><span class="enlighter-text">struct tty_struct *tty,</span></div></div><div class=""><div><span class="enlighter-text">        const unsigned char *chars, char flag, size_t size</span><span class="enlighter-g1">)</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text"></span><span class="enlighter-g1">{</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">    int copied = </span><span class="enlighter-n1">0</span><span class="enlighter-text">;</span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-k1">do</span><span class="enlighter-text"> </span><span class="enlighter-g1">{</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">        int goal = </span><span class="enlighter-m0">min_t</span><span class="enlighter-g1">(</span><span class="enlighter-text">size_t, size - copied, TTY_BUFFER_PAGE</span><span class="enlighter-g1">)</span><span class="enlighter-text">;</span></div></div><div class=""><div><span class="enlighter-text">        int space;</span></div></div><div class=""><div><span class="enlighter-text">        unsigned long flags;</span></div></div><div class=""><div><span class="enlighter-text">        struct tty_buffer *tb;</span></div></div><div class=""><div><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">        </span><span class="enlighter-m0">spin_lock_irqsave</span><span class="enlighter-g1">(</span><span class="enlighter-text">&amp;tty-</span><span class="enlighter-g1">&gt;</span><span class="enlighter-text">buf.</span><span class="enlighter-m3">lock</span><span class="enlighter-text">, flags</span><span class="enlighter-g1">)</span><span class="enlighter-text">;       </span><span class="enlighter-c1">/* -1- */</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">        space = </span><span class="enlighter-m0">__tty_buffer_request_room</span><span class="enlighter-g1">(</span><span class="enlighter-text">tty, goal</span><span class="enlighter-g1">)</span><span class="enlighter-text">;</span></div></div><div class=""><div><span class="enlighter-text">        tb = tty-</span><span class="enlighter-g1">&gt;</span><span class="enlighter-text">buf.</span><span class="enlighter-m3">tail</span><span class="enlighter-text">;</span></div></div><div class=""><div><span class="enlighter-text">        </span></div></div><div class=""><div><span class="enlighter-text">        </span><span class="enlighter-k1">if</span><span class="enlighter-text"> </span><span class="enlighter-g1">(</span><span class="enlighter-m0">unlikely</span><span class="enlighter-g1">(</span><span class="enlighter-text">space == </span><span class="enlighter-n1">0</span><span class="enlighter-g1">))</span><span class="enlighter-text"> </span><span class="enlighter-g1">{</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">            </span><span class="enlighter-m0">spin_unlock_irqrestore</span><span class="enlighter-g1">(</span><span class="enlighter-text">&amp;tty-</span><span class="enlighter-g1">&gt;</span><span class="enlighter-text">buf.</span><span class="enlighter-m3">lock</span><span class="enlighter-text">, flags</span><span class="enlighter-g1">)</span><span class="enlighter-text">;</span></div></div><div class=""><div><span class="enlighter-text">            break;</span></div></div><div class=""><div><span class="enlighter-text">        </span><span class="enlighter-g1">}</span><span class="enlighter-text"></span></div></div><div class=""><div><span class="enlighter-text">        </span><span class="enlighter-m0">memcpy</span><span class="enlighter-g1">(</span><span class="enlighter-text">tb-</span><span class="enlighter-g1">&gt;</span><span class="enlighter-text">char_buf_ptr + tb-</span><span class="enlighter-g1">&gt;</span><span class="enlighter-text">used, chars, space</span><span class="enlighter-g1">)</span><span class="enlighter-text">;</span></div></div><div class=""><div><span class="enlighter-text">        </span><span class="enlighter-m0">memset</span><span class="enlighter-g1">(</span><span class="enlighter-text">tb-</span><span class="enlighter-g1">&gt;</span><span class="enlighter-text">flag_buf_ptr + tb-</span><span class="enlighter-g1">&gt;</span><span class="enlighter-text">used, flag, space</span><span class="enlighter-g1">)</span><span class="enlighter-text">;</span></div></div><div class=""><div><span class="enlighter-text">        tb-</span><span class="enlighter-g1">&gt;</span><span class="enlighter-text">used += space;</span></div></div><div class=""><div><span class="enlighter-text">        </span><span class="enlighter-m0">spin_unlock_irqrestore</span><span class="enlighter-g1">(</span><span class="enlighter-text">&amp;tty-</span><span class="enlighter-g1">&gt;</span><span class="enlighter-text">buf.</span><span class="enlighter-m3">lock</span><span class="enlighter-text">, flags</span><span class="enlighter-g1">)</span><span class="enlighter-text">;</span></div></div><div class=""><div><span class="enlighter-text">        copied += space;</span></div></div><div class=""><div><span class="enlighter-text">        chars += space;</span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-g1">}</span><span class="enlighter-text"> </span><span class="enlighter-k1">while</span><span class="enlighter-text"> </span><span class="enlighter-g1">(</span><span class="enlighter-m0">unlikely</span><span class="enlighter-g1">(</span><span class="enlighter-text">size </span><span class="enlighter-g1">&gt;</span><span class="enlighter-text"> copied</span><span class="enlighter-g1">))</span><span class="enlighter-text">;</span></div></div><div class=""><div><span class="enlighter-text">    </span><span class="enlighter-k1">return</span><span class="enlighter-text"> copied;</span></div></div><div class=""><div><span class="enlighter-text"></span><span class="enlighter-g1">}</span></div></div></div><div class="enlighter-raw">int tty_insert_flip_string_fixed_flag(struct tty_struct *tty,
        const unsigned char *chars, char flag, size_t size)
{
    int copied = 0;
    do {
        int goal = min_t(size_t, size - copied, TTY_BUFFER_PAGE);
        int space;
        unsigned long flags;
        struct tty_buffer *tb;

        spin_lock_irqsave(&amp;tty-&gt;buf.lock, flags);       /* -1- */
        space = __tty_buffer_request_room(tty, goal);
        tb = tty-&gt;buf.tail;
        
        if (unlikely(space == 0)) {
            spin_unlock_irqrestore(&amp;tty-&gt;buf.lock, flags);
            break;
        }
        memcpy(tb-&gt;char_buf_ptr + tb-&gt;used, chars, space);
        memset(tb-&gt;flag_buf_ptr + tb-&gt;used, flag, space);
        tb-&gt;used += space;
        spin_unlock_irqrestore(&amp;tty-&gt;buf.lock, flags);
        copied += space;
        chars += space;
    } while (unlikely(size &gt; copied));
    return copied;
}</div><div class="enlighter-toolbar-bottom enlighter-toolbar"></div></div><pre class="EnlighterJSRAW enlighter-origin" data-enlighter-language="generic">int tty_insert_flip_string_fixed_flag(struct tty_struct *tty,
        const unsigned char *chars, char flag, size_t size)
{
    int copied = 0;
    do {
        int goal = min_t(size_t, size - copied, TTY_BUFFER_PAGE);
        int space;
        unsigned long flags;
        struct tty_buffer *tb;

        spin_lock_irqsave(&amp;tty-&gt;buf.lock, flags);       /* -1- */
        space = __tty_buffer_request_room(tty, goal);
        tb = tty-&gt;buf.tail;
        
        if (unlikely(space == 0)) {
            spin_unlock_irqrestore(&amp;tty-&gt;buf.lock, flags);
            break;
        }
        memcpy(tb-&gt;char_buf_ptr + tb-&gt;used, chars, space);
        memset(tb-&gt;flag_buf_ptr + tb-&gt;used, flag, space);
        tb-&gt;used += space;
        spin_unlock_irqrestore(&amp;tty-&gt;buf.lock, flags);
        copied += space;
        chars += space;
    } while (unlikely(size &gt; copied));
    return copied;
}</pre>
<p>The Interesting difference is that at -1- we see that the function here is actually locked internally. Now as stated above to win the race the second process needs to enter&nbsp;<span style="font-family: monospace;">__tty_buffer_request_room()&nbsp;</span><b><i>before</i></b> the first process updated tb-&gt;used. This is not possible if the function is locked like this.</p>
<p>Taking a look at the git history of the Linux kernel it turns out that all kernels between <a href="http://git.kernel.org/cgit/linux/kernel/git/stable/linux-stable.git/commit/?id=c56a00a165712fd73081f40044b1e64407bb1875">c56a00a165712fd73081f40044b1e64407bb1875 (march 2012)</a> and <a href="http://git.kernel.org/cgit/linux/kernel/git/stable/linux-stable.git/commit/?id=64325a3be08d364a62ee8f84b2cf86934bc2544a">64325a3be08d364a62ee8f84b2cf86934bc2544a (january 2013)</a> are not affected by this vuln as&nbsp;<span style="font-family: monospace;">tty_insert_flip_string_fixed_flag()&nbsp;</span>was internally locked there.</p>
<p>For Android that means quite a few of the newer devices are not vulnerable to this issue, most of the older ones are though and there are some newer ones integrated the&nbsp;<a href="http://git.kernel.org/cgit/linux/kernel/git/stable/linux-stable.git/commit/?id=64325a3be08d364a62ee8f84b2cf86934bc2544a">64325a3be08d364a62ee8f84b2cf86934bc2544a</a>&nbsp;Linux kernel&nbsp;patch, making them vulnerable&nbsp;again.</p>
<h3>Conclusion</h3>
<div>Kernel exploits are hard, getting them reliable is even harder! This concludes our analysis of CVE-2014-0196, we hope you have gained some deeper understanding of this vuln and kernel level security in general. For more details on linux kernel exploitation you can take a look at our last post:&nbsp;<a href="https://blog.includesecurity.com/2014/03/06/how-to-exploit-the-x32-recvmmsg-kernel-vulnerability-cve-2014-0038-2/">How to exploit the x32 recvmmsg() kernel vulnerability CVE 2014-0038</a><p></p>
<p>If you have feedback or have worked on something similar let us know, you can email us at: info@includesecurity.com</p>
</div>
<div></div>
<div class="sharedaddy sd-sharing-enabled"><div class="robots-nocontent sd-block sd-social sd-social-icon-text sd-sharing"><h3 class="sd-title">Share this:</h3><div class="sd-content"><ul data-sharing-events-added="true"><li class="share-twitter"><a rel="nofollow noopener noreferrer" data-shared="sharing-twitter-185" class="share-twitter sd-button share-icon" href="https://blog.includesecurity.com/2014/06/exploiting-cve-2014-0196-a-walk-through-of-the-linux-pty-race-condition-poc/?share=twitter&amp;nb=1" target="_blank" title="Click to share on Twitter"><span>Twitter</span></a></li><li class="share-facebook"><a rel="nofollow noopener noreferrer" data-shared="sharing-facebook-185" class="share-facebook sd-button share-icon" href="https://blog.includesecurity.com/2014/06/exploiting-cve-2014-0196-a-walk-through-of-the-linux-pty-race-condition-poc/?share=facebook&amp;nb=1" target="_blank" title="Click to share on Facebook"><span>Facebook</span></a></li><li class="share-end"></li></ul></div></div></div><div class="sharedaddy sd-block sd-like jetpack-likes-widget-wrapper jetpack-likes-widget-unloaded" id="like-post-wrapper-145744988-185-61a901a145014" data-src="https://widgets.wp.com/likes/#blog_id=145744988&amp;post_id=185&amp;origin=blog.includesecurity.com&amp;obj_id=145744988-185-61a901a145014" data-name="like-post-frame-145744988-185-61a901a145014" data-title="Like or Reblog"><h3 class="sd-title">Like this:</h3><div class="likes-widget-placeholder post-likes-widget-placeholder" style="height: 55px;"><span class="button"><span>Like</span></span> <span class="loading">Loading...</span></div><span class="sd-text-color"></span><a class="sd-link-color"></a></div>		</div>

				<footer class="entry-meta">
			<span class="cat-links"><span class="gp-icon icon-categories"><svg viewBox="0 0 512 512" aria-hidden="true" role="img" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="1em" height="1em">
						<path d="M0 112c0-26.51 21.49-48 48-48h110.014a48 48 0 0 1 43.592 27.907l12.349 26.791A16 16 0 0 0 228.486 128H464c26.51 0 48 21.49 48 48v224c0 26.51-21.49 48-48 48H48c-26.51 0-48-21.49-48-48V112z" fill-rule="nonzero"></path>
					</svg></span><span class="screen-reader-text">Categories </span><a href="https://blog.includesecurity.com/category/exploit/" rel="category tag">Exploit</a>, <a href="https://blog.includesecurity.com/category/kernel-exploit/" rel="category tag">Kernel Exploit</a>, <a href="https://blog.includesecurity.com/category/linux/" rel="category tag">Linux</a>, <a href="https://blog.includesecurity.com/category/privilege-escalation/" rel="category tag">privilege escalation</a>, <a href="https://blog.includesecurity.com/category/pty/" rel="category tag">pty</a>, <a href="https://blog.includesecurity.com/category/race-condition/" rel="category tag">race condition</a>, <a href="https://blog.includesecurity.com/category/racecondition/" rel="category tag">racecondition</a></span> 		<nav id="nav-below" class="post-navigation">
			<span class="screen-reader-text">Post navigation</span>

			<div class="nav-previous"><span class="gp-icon icon-arrow-left"><svg viewBox="0 0 192 512" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="1.414">
						<path d="M178.425 138.212c0 2.265-1.133 4.813-2.832 6.512L64.276 256.001l111.317 111.277c1.7 1.7 2.832 4.247 2.832 6.513 0 2.265-1.133 4.813-2.832 6.512L161.43 394.46c-1.7 1.7-4.249 2.832-6.514 2.832-2.266 0-4.816-1.133-6.515-2.832L16.407 262.514c-1.699-1.7-2.832-4.248-2.832-6.513 0-2.265 1.133-4.813 2.832-6.512l131.994-131.947c1.7-1.699 4.249-2.831 6.515-2.831 2.265 0 4.815 1.132 6.514 2.831l14.163 14.157c1.7 1.7 2.832 3.965 2.832 6.513z" fill-rule="nonzero"></path>
					</svg></span><span class="prev" title="Previous"><a href="https://blog.includesecurity.com/2014/05/mobile-app-data-privacy-the-outlook-com-example/" rel="prev">Mobile App Data Privacy – the Outlook.com Example</a></span></div><div class="nav-next"><span class="gp-icon icon-arrow-right"><svg viewBox="0 0 192 512" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="1.414">
						<path d="M178.425 256.001c0 2.266-1.133 4.815-2.832 6.515L43.599 394.509c-1.7 1.7-4.248 2.833-6.514 2.833s-4.816-1.133-6.515-2.833l-14.163-14.162c-1.699-1.7-2.832-3.966-2.832-6.515 0-2.266 1.133-4.815 2.832-6.515l111.317-111.316L16.407 144.685c-1.699-1.7-2.832-4.249-2.832-6.515s1.133-4.815 2.832-6.515l14.163-14.162c1.7-1.7 4.249-2.833 6.515-2.833s4.815 1.133 6.514 2.833l131.994 131.993c1.7 1.7 2.832 4.249 2.832 6.515z" fill-rule="nonzero"></path>
					</svg></span><span class="next" title="Next"><a href="https://blog.includesecurity.com/2014/07/hacking-your-hacking-tools-when-you-absolutely-must-decode-protobuf/" rel="next">Hacking your hacking tools: When you absolutely must decode ProtoBuf</a></span></div>		</nav>
				</footer>
			</div>
</article>

			<div class="comments-area">
				<div id="comments">

	
		<div id="respond" class="comment-respond">
							<h3 id="reply-title" class="comment-reply-title">Leave a Reply					<small><a rel="nofollow" id="cancel-comment-reply-link" href="https://blog.includesecurity.com/2014/06/exploiting-cve-2014-0196-a-walk-through-of-the-linux-pty-race-condition-poc/#respond" style="display:none;">Cancel reply</a></small>
				</h3>
						<form id="commentform" class="comment-form">
				<iframe title="Comment Form" src="./2014 - Exploiting CVE-2014-0196 a walk-through of the Linux pty race condition PoC_files/saved_resource(5).html" name="jetpack_remote_comment" style="width: 100%; height: 58.2px; border: 0px;" class="jetpack_remote_comment" id="jetpack_remote_comment" sandbox="allow-same-origin allow-top-navigation allow-scripts allow-forms allow-popups" scrolling="no">
									</iframe>
									<!--[if !IE]><!-->
					<script>
						document.addEventListener('DOMContentLoaded', function () {
							var commentForms = document.getElementsByClassName('jetpack_remote_comment');
							for (var i = 0; i < commentForms.length; i++) {
								commentForms[i].allowTransparency = false;
								commentForms[i].scrolling = 'no';
							}
						});
					</script>
					<!--<![endif]-->
							</form>
		</div>

		
		<input type="hidden" name="comment_parent" id="comment_parent" value="">

		
</div><!-- #comments -->
			</div>

					</main>
	</div>

	
	</div>
</div>



<!--  -->
<script defer="" id="bilmur" data-provider="wordpress.com" data-service="atomic" src="./2014 - Exploiting CVE-2014-0196 a walk-through of the Linux pty race condition PoC_files/bilmur.min.js.下載"></script>

	<script type="text/javascript">
		window.WPCOM_sharing_counts = {"https:\/\/blog.includesecurity.com\/2014\/06\/exploiting-cve-2014-0196-a-walk-through-of-the-linux-pty-race-condition-poc\/":185};
	</script>
				<script src="./2014 - Exploiting CVE-2014-0196 a walk-through of the Linux pty race condition PoC_files/photon.min.js.下載" id="jetpack-photon-js"></script>
<!--[if lte IE 11]>
<script src='https://blog.includesecurity.com/wp-content/themes/generatepress/assets/js/classList.min.js?ver=3.0.2' id='generate-classlist-js'></script>
<![endif]-->
<script id="generate-main-js-extra">
var generatepressMenu = {"toggleOpenedSubMenus":"1","openSubMenuLabel":"Open Sub-Menu","closeSubMenuLabel":"Close Sub-Menu"};
</script>
<script src="./2014 - Exploiting CVE-2014-0196 a walk-through of the Linux pty race condition PoC_files/main.min.js.下載" id="generate-main-js"></script>
<script src="./2014 - Exploiting CVE-2014-0196 a walk-through of the Linux pty race condition PoC_files/comment-reply.min.js.下載" id="comment-reply-js"></script>
<script src="./2014 - Exploiting CVE-2014-0196 a walk-through of the Linux pty race condition PoC_files/queuehandler.min.js.下載" id="jetpack_likes_queuehandler-js"></script>
<script src="./2014 - Exploiting CVE-2014-0196 a walk-through of the Linux pty race condition PoC_files/enlighterjs.min.js.下載" id="enlighterjs-js"></script>
<script id="enlighterjs-js-after">
!function(e,n){if("undefined"!=typeof EnlighterJS){var o={"selectors":{"block":"pre.EnlighterJSRAW","inline":"code.EnlighterJSRAW"},"options":{"indent":4,"ampersandCleanup":true,"linehover":false,"rawcodeDbclick":false,"textOverflow":"break","linenumbers":false,"theme":"droide","language":"generic","retainCssClasses":false,"collapse":false,"toolbarOuter":"","toolbarTop":"{BTN_RAW}{BTN_COPY}{BTN_WINDOW}{BTN_WEBSITE}","toolbarBottom":""}};(e.EnlighterJSINIT=function(){EnlighterJS.init(o.selectors.block,o.selectors.inline,o.options)})()}else{(n&&(n.error||n.log)||function(){})("Error: EnlighterJS resources not loaded yet!")}}(window,console);
</script>
<script src="./2014 - Exploiting CVE-2014-0196 a walk-through of the Linux pty race condition PoC_files/wp-embed.min.js.下載" id="wp-embed-js"></script>
<script id="sharing-js-js-extra">
var sharing_js_options = {"lang":"en","counts":"1","is_stats_active":"1"};
</script>
<script async="true" src="./2014 - Exploiting CVE-2014-0196 a walk-through of the Linux pty race condition PoC_files/saved_resource(3)"></script><script src="./2014 - Exploiting CVE-2014-0196 a walk-through of the Linux pty race condition PoC_files/sharing.min.js.下載" id="sharing-js-js"></script>
<script id="sharing-js-js-after">
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-twitter' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-twitter' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcomtwitter', 'menubar=1,resizable=1,width=600,height=350' );
						return false;
					}
				} );
			} )();
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-facebook' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-facebook' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcomfacebook', 'menubar=1,resizable=1,width=600,height=400' );
						return false;
					}
				} );
			} )();
</script>
	<iframe src="./2014 - Exploiting CVE-2014-0196 a walk-through of the Linux pty race condition PoC_files/master.html" scrolling="no" id="likes-master" name="likes-master" style="display:none;"></iframe>
	<div id="likes-other-gravatars"><div class="likes-text"><span>%d</span> bloggers like this:</div><ul class="wpl-avatars sd-like-gravatars"></ul></div>
	
		<!--[if IE]>
		<script type="text/javascript">
			if ( 0 === window.location.hash.indexOf( '#comment-' ) ) {
				// window.location.reload() doesn't respect the Hash in IE
				window.location.hash = window.location.hash;
			}
		</script>
		<![endif]-->
		<script type="text/javascript">
			(function () {
				var comm_par_el = document.getElementById( 'comment_parent' ),
					comm_par = ( comm_par_el && comm_par_el.value ) ? comm_par_el.value : '',
					frame = document.getElementById( 'jetpack_remote_comment' ),
					tellFrameNewParent;

				tellFrameNewParent = function () {
					if ( comm_par ) {
						frame.src = "https://jetpack.wordpress.com/jetpack-comment/?blogid=145744988&postid=185&comment_registration=0&require_name_email=1&stc_enabled=1&stb_enabled=1&show_avatars=1&avatar_default=identicon&greeting=Leave+a+Reply&greeting_reply=Leave+a+Reply+to+%25s&color_scheme=light&lang=en_US&jetpack_version=10.4-beta&show_cookie_consent=10&has_cookie_consent=0&token_key=%3Bnormal%3B&sig=e48bb6eb4533613d2fccd980e3cf5c21a4e70afd#parent=https%3A%2F%2Fblog.includesecurity.com%2F2014%2F06%2Fexploiting-cve-2014-0196-a-walk-through-of-the-linux-pty-race-condition-poc%2F" + '&replytocom=' + parseInt( comm_par, 10 ).toString();
					} else {
						frame.src = "https://jetpack.wordpress.com/jetpack-comment/?blogid=145744988&postid=185&comment_registration=0&require_name_email=1&stc_enabled=1&stb_enabled=1&show_avatars=1&avatar_default=identicon&greeting=Leave+a+Reply&greeting_reply=Leave+a+Reply+to+%25s&color_scheme=light&lang=en_US&jetpack_version=10.4-beta&show_cookie_consent=10&has_cookie_consent=0&token_key=%3Bnormal%3B&sig=e48bb6eb4533613d2fccd980e3cf5c21a4e70afd#parent=https%3A%2F%2Fblog.includesecurity.com%2F2014%2F06%2Fexploiting-cve-2014-0196-a-walk-through-of-the-linux-pty-race-condition-poc%2F";
					}
				};

				
				if ( 'undefined' !== typeof addComment ) {
					addComment._Jetpack_moveForm = addComment.moveForm;

					addComment.moveForm = function ( commId, parentId, respondId, postId ) {
						var returnValue = addComment._Jetpack_moveForm( commId, parentId, respondId, postId ),
							cancelClick, cancel;

						if ( false === returnValue ) {
							cancel = document.getElementById( 'cancel-comment-reply-link' );
							cancelClick = cancel.onclick;
							cancel.onclick = function () {
								var cancelReturn = cancelClick.call( this );
								if ( false !== cancelReturn ) {
									return cancelReturn;
								}

								if ( ! comm_par ) {
									return cancelReturn;
								}

								comm_par = 0;

								tellFrameNewParent();

								return cancelReturn;
							};
						}

						if ( comm_par == parentId ) {
							return returnValue;
						}

						comm_par = parentId;

						tellFrameNewParent();

						return returnValue;
					};
				}

				
				// Do the post message bit after the dom has loaded.
				document.addEventListener( 'DOMContentLoaded', function () {
					var iframe_url = "https:\/\/jetpack.wordpress.com";
					if ( window.postMessage ) {
						if ( document.addEventListener ) {
							window.addEventListener( 'message', function ( event ) {
								var origin = event.origin.replace( /^http:\/\//i, 'https://' );
								if ( iframe_url.replace( /^http:\/\//i, 'https://' ) !== origin ) {
									return;
								}
								frame.style.height = event.data + 'px';
							});
						} else if ( document.attachEvent ) {
							window.attachEvent( 'message', function ( event ) {
								var origin = event.origin.replace( /^http:\/\//i, 'https://' );
								if ( iframe_url.replace( /^http:\/\//i, 'https://' ) !== origin ) {
									return;
								}
								frame.style.height = event.data + 'px';
							});
						}
					}
				})

			})();
		</script>

		<script src="./2014 - Exploiting CVE-2014-0196 a walk-through of the Linux pty race condition PoC_files/e-202148.js.下載" defer=""></script>
<script>
	_stq = window._stq || [];
	_stq.push([ 'view', {v:'ext',j:'1:10.4-beta',blog:'145744988',post:'185',tz:'-5',srv:'blog.includesecurity.com'} ]);
	_stq.push([ 'clickTrackerInit', '145744988', '185' ]);
</script>



<img src="./2014 - Exploiting CVE-2014-0196 a walk-through of the Linux pty race condition PoC_files/g.gif" alt="" width="6" height="5" id="wpstats"></body></html>