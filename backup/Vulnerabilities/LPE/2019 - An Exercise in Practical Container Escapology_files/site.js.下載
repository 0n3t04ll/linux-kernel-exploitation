(function($){


  var capsule = {

    init: function(){
      
      $('body').addClass('loaded');
      capsule.linkHandler();
      capsule.navHandler();
      
      if($('.switcher').length){
        capsule.switcher();
      }
      if($('.video-lightbox-wrap').length){
        capsule.videoLightbox();
      }
      if($('.progressive').length){
        capsule.progressiveShowPosts();
      }
      if($('iframe').length){
        capsule.wrapiFrames();
      }
      if($('.testimonials-wrap').length){
        capsule.testimonials();
      }
      if($('.use-nav-arrows').length){
        capsule.resourcesSlide();
      }
    },
    resourcesSlide: function(){

      // generic counter
      var i;
        
      
      // initialize
      var visibleposts;
      // get window width
      var w = window.innerWidth;
      // count items
      var postscount = $('.use-nav-arrows .simple-resource').length;
      // visibleposts = 3 else 2
      if(w > 700){
        visibleposts = 3;
        // use the built-in spacing for three-wide
        $('.simple-resources.use-nav-arrows').addClass('triple');
      } else {
        visibleposts = 2;
      }

      // add a class to hide descendents then
      // show the first number of visibleposts
      $('.simple-resources.use-nav-arrows').addClass('now-active');
      for (i = 0; i < visibleposts; i++) { 
        $('.use-nav-arrows .simple-resource:eq(' + [i] + ')').addClass('active');
      }        

      // if count > visibleposts enable right button
      if(postscount > visibleposts) {
        $('.arrow-nav.right').addClass('active');
      }
      
      
      
      // listen for active right click
      $('.arrow-nav.right').on('click', function(){
        // check the index of the last active
        var lastactive = $('.simple-resource.active').last().index();
        if((postscount - lastactive) > visibleposts){          
          // clear and then show new set
          $('.use-nav-arrows .simple-resource').removeClass('active');
          var startactive = lastactive + 1;
          for (i = 0; i < visibleposts; i++) {
            $('.use-nav-arrows .simple-resource:eq(' + [startactive + i] + ')').addClass('active');
          }
          $('.arrow-nav.left').addClass('active');
          // if happens to end perfectly
          if($('.use-nav-arrows .simple-resource').last().hasClass('active')){
            $('.arrow-nav.right').removeClass('active');
          }
        } else {
          $('.use-nav-arrows .simple-resource').removeClass('active');
          var endingactive = postscount - 1;
          for (i = 0; i < visibleposts; i++) {
            $('.use-nav-arrows .simple-resource:eq(' + [endingactive - i] + ')').addClass('active');
          }
          $('.arrow-nav.right').removeClass('active');
        }
      });

      // listen for active left click
      $('.arrow-nav.left').on('click', function(){
        // check the index of the last active
        var firstactive = $('.simple-resource.active').first().index();
        if(firstactive > visibleposts){
          
          // clear and then show new set
          $('.use-nav-arrows .simple-resource').removeClass('active');
          var endingactive = firstactive - 1;
          for (i = 0; i < visibleposts; i++) {
            $('.use-nav-arrows .simple-resource:eq(' + [endingactive - i] + ')').addClass('active');
          }
          $('.arrow-nav.right').addClass('active');
          
        } else {
          $('.use-nav-arrows .simple-resource').removeClass('active');
          var startactive = 0;
          for (i = 0; i < visibleposts; i++) {
            $('.use-nav-arrows .simple-resource:eq(' + [startactive + i] + ')').addClass('active');
          }
          $('.arrow-nav.left').removeClass('active');          
        }
      });
      
    },
    progressiveShowPosts: function(){
      
      var postcount = $('.simple-resource').length;
      var showmore = '<div class="show-more-posts"></div>';
      
      if(postcount > 21){
        $('.simple-resources.progressive').addClass('show-some').append(showmore);
      }
      
      $(document).on('click', '.show-more-posts', function(){
        $('.simple-resources.progressive').removeClass('show-some');
        $('.show-more-posts').remove();
      });
      
    },
    navHandler: function(){
      
      $('.ham-nav-trigger').on('click', function(){
        $('body').toggleClass('nav-open');
      });
      
    },
    linkHandler: function(){
      
      $('.inactive-label a').on('click', function(e){
        e.preventDefault();
      });
      
    },
    switcher: function(){
      
      // initial setup
      $('.switcher:first-of-type').addClass('active');
      $('.switcher-description:first-of-type').addClass('active');
      
      // listen for clicks
      $('.switcher').on('click', function(){
        // clear actives
        $('.switcher, .switcher-description').removeClass('active');
        
        // add new actives
        var position = $(this).index();
        $(this).addClass('active');
        $('.switcher-description').eq(position).addClass('active');
        
      });
      
    },
    testimonials: function(){
      
      // initialize
      // set first logo and first testimonial to active
      $('.t-logo-plus:first-of-type').addClass('active');
      $('.testimonial:first-of-type').addClass('active');
      
      // listen for logo clicks
        // set to active & find index position; clear siblings
        // set eq testimonial to active; clear siblings
      $('.t-logo-plus').on('click', function(){
        $(this).addClass('active').siblings().removeClass('active');
        var position = $(this).index();
        console.log(position);
        $('.testimonial:eq(' + position + ')').addClass('active').siblings().removeClass('active');
      });
      
    },
    videoLightbox: function(){
      
      $('.video-trigger').on('click', function(){
        var vidtype = $(this).data('vidtype');
        if(vidtype == 'yt'){
          // nothing for now
          $('.video-for-lightbox').clone().appendTo('#video-lightbox-content');
          var youtubeembed = $('#video-lightbox-content iframe').data('toload');
          $('#video-lightbox-content iframe').attr('src',youtubeembed);
          $('body').addClass('active-lightbox');
          
        } else if(vidtype == 'wistia') {
          // move wistia block into lightbox
            // then move data-load to src
          // activate the page
          $('.video-for-lightbox').clone().appendTo('#video-lightbox-content');
          var wistiaembed = $('#video-lightbox-content iframe').data('toload');
          
          $('#video-lightbox-content iframe').attr('src',wistiaembed);
          
          $('body').addClass('active-lightbox');
        }
      });
      
      // close
      $('.video-lightbox-shade').on('click', function(){
        $('#video-lightbox-content').html('');
        $('body').removeClass('active-lightbox');
      });
      
    },
    wrapiFrames: function(){
      
      var iframewrap = '<div class="embed-post-iframe"></div>';
      
      $('.single-post-wrap iframe').each(function(){
        $(this).wrap(iframewrap);
      });
      
    }

  };


  $(window).load(function() {

    capsule.init();
    
  });

  $(window).resize(function() {

  });


})(window.jQuery);